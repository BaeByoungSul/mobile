import{$ as sd,$a as Kp,$b as na,A as He,Aa as pd,Ab as sg,Ac as kg,B as St,Bb as dg,C as Dp,Ca as Rp,Cb as gt,D as Pr,Da as Np,Db as bn,E as ut,Eb as Ad,F as Ir,Fa as Op,Fb as vo,G as qn,Gb as Qr,H as Bp,Ha as Fr,Hb as lg,I as xe,Ia as zp,Ib as cg,J as kr,Ja as Hp,Jb as ug,K as it,Ka as jp,Kb as hg,L as Gn,La as Up,Lb as bo,M as go,Mb as je,N as Wn,Na as Qp,Nb as qr,O as nd,Ob as Ye,P as Zn,Pa as gd,Pb as Gr,Q as id,Qa as mo,Qb as Wr,R as od,Ra as fd,Rb as Zr,S as Ke,Sa as qp,Sb as Kr,T as fo,Ta as Gp,Tb as Yr,U as pn,Ua as Wp,Ub as Jr,V as Dr,Va as Rr,Vb as ft,W as rd,Wa as md,Wb as Xr,X as Vp,Xa as Zp,Xb as $r,Y as ad,Yb as ea,Z as gn,Za as vd,Zb as ta,_ as fn,_a as vn,_b as rt,a as Oe,aa as dd,ac as ia,b as co,ba as Br,bb as Nr,bc as pg,c as B,ca as de,cb as bd,cc as gg,d as _p,da as le,db as Yp,dc as oa,e as Sp,ea as mn,eb as Jp,ec as fg,f as qe,fa as Mp,fb as Xp,fc as mg,ga as Lp,gb as $p,gc as ra,h as Sr,hb as M,hc as vg,i as uo,ia as Kn,ib as Jn,ic as bg,j as Ep,ja as ht,jb as eg,jc as wg,k as Tp,ka as ot,kb as tg,kc as xg,l as Pp,la as Vr,lb as ng,lc as Ag,m as Ip,ma as Mr,mb as Or,mc as yd,n as ze,na as Lr,nb as wd,nc as yg,o as ho,ob as Xn,oc as Cg,p as Ut,pb as zr,pc as _g,q as _t,qa as Yn,qb as Hr,qc as Cd,r as J,rb as jr,rc as Sg,s as Er,sa as pe,sb as ig,sc as Eg,t as kp,ta as ld,tb as xd,tc as Tg,u as Tr,ua as Qt,ub as og,uc as aa,v as po,va as cd,vb as pt,vc as Pg,w as un,wa as ud,wb as rg,x as hn,xb as ag,xc as Ig,ya as Fp,yb as Ur,za as hd,zb as Ae}from"./chunk-RV4YU4FJ.js";var sa=class i{static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Ke({type:i,selectors:[["app-file-viewer"]],decls:2,vars:0,template:function(t,n){t&1&&(Mp(0,"p"),pe(1,"file-viewer works!"),Lp())},encapsulation:2})};var Bg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vg={};var Et,_d;(function(){var i;function e(A,m){function b(){}b.prototype=m.prototype,A.D=m.prototype,A.prototype=new b,A.prototype.constructor=A,A.C=function(x,y,S){for(var w=Array(arguments.length-2),At=2;At<arguments.length;At++)w[At-2]=arguments[At];return m.prototype[y].apply(x,w)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function o(A,m,b){b||(b=0);var x=Array(16);if(typeof m=="string")for(var y=0;16>y;++y)x[y]=m.charCodeAt(b++)|m.charCodeAt(b++)<<8|m.charCodeAt(b++)<<16|m.charCodeAt(b++)<<24;else for(y=0;16>y;++y)x[y]=m[b++]|m[b++]<<8|m[b++]<<16|m[b++]<<24;m=A.g[0],b=A.g[1],y=A.g[2];var S=A.g[3],w=m+(S^b&(y^S))+x[0]+3614090360&4294967295;m=b+(w<<7&4294967295|w>>>25),w=S+(y^m&(b^y))+x[1]+3905402710&4294967295,S=m+(w<<12&4294967295|w>>>20),w=y+(b^S&(m^b))+x[2]+606105819&4294967295,y=S+(w<<17&4294967295|w>>>15),w=b+(m^y&(S^m))+x[3]+3250441966&4294967295,b=y+(w<<22&4294967295|w>>>10),w=m+(S^b&(y^S))+x[4]+4118548399&4294967295,m=b+(w<<7&4294967295|w>>>25),w=S+(y^m&(b^y))+x[5]+1200080426&4294967295,S=m+(w<<12&4294967295|w>>>20),w=y+(b^S&(m^b))+x[6]+2821735955&4294967295,y=S+(w<<17&4294967295|w>>>15),w=b+(m^y&(S^m))+x[7]+4249261313&4294967295,b=y+(w<<22&4294967295|w>>>10),w=m+(S^b&(y^S))+x[8]+1770035416&4294967295,m=b+(w<<7&4294967295|w>>>25),w=S+(y^m&(b^y))+x[9]+2336552879&4294967295,S=m+(w<<12&4294967295|w>>>20),w=y+(b^S&(m^b))+x[10]+4294925233&4294967295,y=S+(w<<17&4294967295|w>>>15),w=b+(m^y&(S^m))+x[11]+2304563134&4294967295,b=y+(w<<22&4294967295|w>>>10),w=m+(S^b&(y^S))+x[12]+1804603682&4294967295,m=b+(w<<7&4294967295|w>>>25),w=S+(y^m&(b^y))+x[13]+4254626195&4294967295,S=m+(w<<12&4294967295|w>>>20),w=y+(b^S&(m^b))+x[14]+2792965006&4294967295,y=S+(w<<17&4294967295|w>>>15),w=b+(m^y&(S^m))+x[15]+1236535329&4294967295,b=y+(w<<22&4294967295|w>>>10),w=m+(y^S&(b^y))+x[1]+4129170786&4294967295,m=b+(w<<5&4294967295|w>>>27),w=S+(b^y&(m^b))+x[6]+3225465664&4294967295,S=m+(w<<9&4294967295|w>>>23),w=y+(m^b&(S^m))+x[11]+643717713&4294967295,y=S+(w<<14&4294967295|w>>>18),w=b+(S^m&(y^S))+x[0]+3921069994&4294967295,b=y+(w<<20&4294967295|w>>>12),w=m+(y^S&(b^y))+x[5]+3593408605&4294967295,m=b+(w<<5&4294967295|w>>>27),w=S+(b^y&(m^b))+x[10]+38016083&4294967295,S=m+(w<<9&4294967295|w>>>23),w=y+(m^b&(S^m))+x[15]+3634488961&4294967295,y=S+(w<<14&4294967295|w>>>18),w=b+(S^m&(y^S))+x[4]+3889429448&4294967295,b=y+(w<<20&4294967295|w>>>12),w=m+(y^S&(b^y))+x[9]+568446438&4294967295,m=b+(w<<5&4294967295|w>>>27),w=S+(b^y&(m^b))+x[14]+3275163606&4294967295,S=m+(w<<9&4294967295|w>>>23),w=y+(m^b&(S^m))+x[3]+4107603335&4294967295,y=S+(w<<14&4294967295|w>>>18),w=b+(S^m&(y^S))+x[8]+1163531501&4294967295,b=y+(w<<20&4294967295|w>>>12),w=m+(y^S&(b^y))+x[13]+2850285829&4294967295,m=b+(w<<5&4294967295|w>>>27),w=S+(b^y&(m^b))+x[2]+4243563512&4294967295,S=m+(w<<9&4294967295|w>>>23),w=y+(m^b&(S^m))+x[7]+1735328473&4294967295,y=S+(w<<14&4294967295|w>>>18),w=b+(S^m&(y^S))+x[12]+2368359562&4294967295,b=y+(w<<20&4294967295|w>>>12),w=m+(b^y^S)+x[5]+4294588738&4294967295,m=b+(w<<4&4294967295|w>>>28),w=S+(m^b^y)+x[8]+2272392833&4294967295,S=m+(w<<11&4294967295|w>>>21),w=y+(S^m^b)+x[11]+1839030562&4294967295,y=S+(w<<16&4294967295|w>>>16),w=b+(y^S^m)+x[14]+4259657740&4294967295,b=y+(w<<23&4294967295|w>>>9),w=m+(b^y^S)+x[1]+2763975236&4294967295,m=b+(w<<4&4294967295|w>>>28),w=S+(m^b^y)+x[4]+1272893353&4294967295,S=m+(w<<11&4294967295|w>>>21),w=y+(S^m^b)+x[7]+4139469664&4294967295,y=S+(w<<16&4294967295|w>>>16),w=b+(y^S^m)+x[10]+3200236656&4294967295,b=y+(w<<23&4294967295|w>>>9),w=m+(b^y^S)+x[13]+681279174&4294967295,m=b+(w<<4&4294967295|w>>>28),w=S+(m^b^y)+x[0]+3936430074&4294967295,S=m+(w<<11&4294967295|w>>>21),w=y+(S^m^b)+x[3]+3572445317&4294967295,y=S+(w<<16&4294967295|w>>>16),w=b+(y^S^m)+x[6]+76029189&4294967295,b=y+(w<<23&4294967295|w>>>9),w=m+(b^y^S)+x[9]+3654602809&4294967295,m=b+(w<<4&4294967295|w>>>28),w=S+(m^b^y)+x[12]+3873151461&4294967295,S=m+(w<<11&4294967295|w>>>21),w=y+(S^m^b)+x[15]+530742520&4294967295,y=S+(w<<16&4294967295|w>>>16),w=b+(y^S^m)+x[2]+3299628645&4294967295,b=y+(w<<23&4294967295|w>>>9),w=m+(y^(b|~S))+x[0]+4096336452&4294967295,m=b+(w<<6&4294967295|w>>>26),w=S+(b^(m|~y))+x[7]+1126891415&4294967295,S=m+(w<<10&4294967295|w>>>22),w=y+(m^(S|~b))+x[14]+2878612391&4294967295,y=S+(w<<15&4294967295|w>>>17),w=b+(S^(y|~m))+x[5]+4237533241&4294967295,b=y+(w<<21&4294967295|w>>>11),w=m+(y^(b|~S))+x[12]+1700485571&4294967295,m=b+(w<<6&4294967295|w>>>26),w=S+(b^(m|~y))+x[3]+2399980690&4294967295,S=m+(w<<10&4294967295|w>>>22),w=y+(m^(S|~b))+x[10]+4293915773&4294967295,y=S+(w<<15&4294967295|w>>>17),w=b+(S^(y|~m))+x[1]+2240044497&4294967295,b=y+(w<<21&4294967295|w>>>11),w=m+(y^(b|~S))+x[8]+1873313359&4294967295,m=b+(w<<6&4294967295|w>>>26),w=S+(b^(m|~y))+x[15]+4264355552&4294967295,S=m+(w<<10&4294967295|w>>>22),w=y+(m^(S|~b))+x[6]+2734768916&4294967295,y=S+(w<<15&4294967295|w>>>17),w=b+(S^(y|~m))+x[13]+1309151649&4294967295,b=y+(w<<21&4294967295|w>>>11),w=m+(y^(b|~S))+x[4]+4149444226&4294967295,m=b+(w<<6&4294967295|w>>>26),w=S+(b^(m|~y))+x[11]+3174756917&4294967295,S=m+(w<<10&4294967295|w>>>22),w=y+(m^(S|~b))+x[2]+718787259&4294967295,y=S+(w<<15&4294967295|w>>>17),w=b+(S^(y|~m))+x[9]+3951481745&4294967295,A.g[0]=A.g[0]+m&4294967295,A.g[1]=A.g[1]+(y+(w<<21&4294967295|w>>>11))&4294967295,A.g[2]=A.g[2]+y&4294967295,A.g[3]=A.g[3]+S&4294967295}n.prototype.u=function(A,m){m===void 0&&(m=A.length);for(var b=m-this.blockSize,x=this.B,y=this.h,S=0;S<m;){if(y==0)for(;S<=b;)o(this,A,S),S+=this.blockSize;if(typeof A=="string"){for(;S<m;)if(x[y++]=A.charCodeAt(S++),y==this.blockSize){o(this,x),y=0;break}}else for(;S<m;)if(x[y++]=A[S++],y==this.blockSize){o(this,x),y=0;break}}this.h=y,this.o+=m},n.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var m=1;m<A.length-8;++m)A[m]=0;var b=8*this.o;for(m=A.length-8;m<A.length;++m)A[m]=b&255,b/=256;for(this.u(A),A=Array(16),m=b=0;4>m;++m)for(var x=0;32>x;x+=8)A[b++]=this.g[m]>>>x&255;return A};function r(A,m){var b=d;return Object.prototype.hasOwnProperty.call(b,A)?b[A]:b[A]=m(A)}function s(A,m){this.h=m;for(var b=[],x=!0,y=A.length-1;0<=y;y--){var S=A[y]|0;x&&S==m||(b[y]=S,x=!1)}this.g=b}var d={};function c(A){return-128<=A&&128>A?r(A,function(m){return new s([m|0],0>m?-1:0)}):new s([A|0],0>A?-1:0)}function u(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return I(u(-A));for(var m=[],b=1,x=0;A>=b;x++)m[x]=A/b|0,b*=4294967296;return new s(m,0)}function p(A,m){if(A.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(A.charAt(0)=="-")return I(p(A.substring(1),m));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var b=u(Math.pow(m,8)),x=f,y=0;y<A.length;y+=8){var S=Math.min(8,A.length-y),w=parseInt(A.substring(y,y+S),m);8>S?(S=u(Math.pow(m,S)),x=x.j(S).add(u(w))):(x=x.j(b),x=x.add(u(w)))}return x}var f=c(0),v=c(1),_=c(16777216);i=s.prototype,i.m=function(){if(k(this))return-I(this).m();for(var A=0,m=1,b=0;b<this.g.length;b++){var x=this.i(b);A+=(0<=x?x:4294967296+x)*m,m*=4294967296}return A},i.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(T(this))return"0";if(k(this))return"-"+I(this).toString(A);for(var m=u(Math.pow(A,6)),b=this,x="";;){var y=X(b,m).g;b=H(b,y.j(m));var S=((0<b.g.length?b.g[0]:b.h)>>>0).toString(A);if(b=y,T(b))return S+x;for(;6>S.length;)S="0"+S;x=S+x}},i.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function T(A){if(A.h!=0)return!1;for(var m=0;m<A.g.length;m++)if(A.g[m]!=0)return!1;return!0}function k(A){return A.h==-1}i.l=function(A){return A=H(this,A),k(A)?-1:T(A)?0:1};function I(A){for(var m=A.g.length,b=[],x=0;x<m;x++)b[x]=~A.g[x];return new s(b,~A.h).add(v)}i.abs=function(){return k(this)?I(this):this},i.add=function(A){for(var m=Math.max(this.g.length,A.g.length),b=[],x=0,y=0;y<=m;y++){var S=x+(this.i(y)&65535)+(A.i(y)&65535),w=(S>>>16)+(this.i(y)>>>16)+(A.i(y)>>>16);x=w>>>16,S&=65535,w&=65535,b[y]=w<<16|S}return new s(b,b[b.length-1]&-2147483648?-1:0)};function H(A,m){return A.add(I(m))}i.j=function(A){if(T(this)||T(A))return f;if(k(this))return k(A)?I(this).j(I(A)):I(I(this).j(A));if(k(A))return I(this.j(I(A)));if(0>this.l(_)&&0>A.l(_))return u(this.m()*A.m());for(var m=this.g.length+A.g.length,b=[],x=0;x<2*m;x++)b[x]=0;for(x=0;x<this.g.length;x++)for(var y=0;y<A.g.length;y++){var S=this.i(x)>>>16,w=this.i(x)&65535,At=A.i(y)>>>16,Qi=A.i(y)&65535;b[2*x+2*y]+=w*Qi,R(b,2*x+2*y),b[2*x+2*y+1]+=S*Qi,R(b,2*x+2*y+1),b[2*x+2*y+1]+=w*At,R(b,2*x+2*y+1),b[2*x+2*y+2]+=S*At,R(b,2*x+2*y+2)}for(x=0;x<m;x++)b[x]=b[2*x+1]<<16|b[2*x];for(x=m;x<2*m;x++)b[x]=0;return new s(b,0)};function R(A,m){for(;(A[m]&65535)!=A[m];)A[m+1]+=A[m]>>>16,A[m]&=65535,m++}function z(A,m){this.g=A,this.h=m}function X(A,m){if(T(m))throw Error("division by zero");if(T(A))return new z(f,f);if(k(A))return m=X(I(A),m),new z(I(m.g),I(m.h));if(k(m))return m=X(A,I(m)),new z(I(m.g),m.h);if(30<A.g.length){if(k(A)||k(m))throw Error("slowDivide_ only works with positive integers.");for(var b=v,x=m;0>=x.l(A);)b=ge(b),x=ge(x);var y=Y(b,1),S=Y(x,1);for(x=Y(x,2),b=Y(b,2);!T(x);){var w=S.add(x);0>=w.l(A)&&(y=y.add(b),S=w),x=Y(x,1),b=Y(b,1)}return m=H(A,y.j(m)),new z(y,m)}for(y=f;0<=A.l(m);){for(b=Math.max(1,Math.floor(A.m()/m.m())),x=Math.ceil(Math.log(b)/Math.LN2),x=48>=x?1:Math.pow(2,x-48),S=u(b),w=S.j(m);k(w)||0<w.l(A);)b-=x,S=u(b),w=S.j(m);T(S)&&(S=v),y=y.add(S),A=H(A,w)}return new z(y,A)}i.A=function(A){return X(this,A).h},i.and=function(A){for(var m=Math.max(this.g.length,A.g.length),b=[],x=0;x<m;x++)b[x]=this.i(x)&A.i(x);return new s(b,this.h&A.h)},i.or=function(A){for(var m=Math.max(this.g.length,A.g.length),b=[],x=0;x<m;x++)b[x]=this.i(x)|A.i(x);return new s(b,this.h|A.h)},i.xor=function(A){for(var m=Math.max(this.g.length,A.g.length),b=[],x=0;x<m;x++)b[x]=this.i(x)^A.i(x);return new s(b,this.h^A.h)};function ge(A){for(var m=A.g.length+1,b=[],x=0;x<m;x++)b[x]=A.i(x)<<1|A.i(x-1)>>>31;return new s(b,A.h)}function Y(A,m){var b=m>>5;m%=32;for(var x=A.g.length-b,y=[],S=0;S<x;S++)y[S]=0<m?A.i(S+b)>>>m|A.i(S+b+1)<<32-m:A.i(S+b);return new s(y,A.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,_d=Vg.Md5=n,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=u,s.fromString=p,Et=Vg.Integer=s}).apply(typeof Bg<"u"?Bg:typeof self<"u"?self:typeof window<"u"?window:{});var da=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Tt={};var Sd,Xb,$n,Ed,wo,la,Td,Pd,Id;(function(){var i,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,h){return a==Array.prototype||a==Object.prototype||(a[l]=h.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof da=="object"&&da];for(var l=0;l<a.length;++l){var h=a[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=t(this);function o(a,l){if(l)e:{var h=n;a=a.split(".");for(var g=0;g<a.length-1;g++){var C=a[g];if(!(C in h))break e;h=h[C]}a=a[a.length-1],g=h[a],l=l(g),l!=g&&l!=null&&e(h,a,{configurable:!0,writable:!0,value:l})}}function r(a,l){a instanceof String&&(a+="");var h=0,g=!1,C={next:function(){if(!g&&h<a.length){var E=h++;return{value:l(E,a[E]),done:!1}}return g=!0,{done:!0,value:void 0}}};return C[Symbol.iterator]=function(){return C},C}o("Array.prototype.values",function(a){return a||function(){return r(this,function(l,h){return h})}});var s=s||{},d=this||self;function c(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function u(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function p(a,l,h){return a.call.apply(a.bind,arguments)}function f(a,l,h){if(!a)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var C=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(C,g),a.apply(l,C)}}return function(){return a.apply(l,arguments)}}function v(a,l,h){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:f,v.apply(null,arguments)}function _(a,l){var h=Array.prototype.slice.call(arguments,1);return function(){var g=h.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function T(a,l){function h(){}h.prototype=l.prototype,a.aa=l.prototype,a.prototype=new h,a.prototype.constructor=a,a.Qb=function(g,C,E){for(var V=Array(arguments.length-2),ne=2;ne<arguments.length;ne++)V[ne-2]=arguments[ne];return l.prototype[C].apply(g,V)}}function k(a){let l=a.length;if(0<l){let h=Array(l);for(let g=0;g<l;g++)h[g]=a[g];return h}return[]}function I(a,l){for(let h=1;h<arguments.length;h++){let g=arguments[h];if(c(g)){let C=a.length||0,E=g.length||0;a.length=C+E;for(let V=0;V<E;V++)a[C+V]=g[V]}else a.push(g)}}class H{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function R(a){return/^[\s\xa0]*$/.test(a)}function z(){var a=d.navigator;return a&&(a=a.userAgent)?a:""}function X(a){return X[" "](a),a}X[" "]=function(){};var ge=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function Y(a,l,h){for(let g in a)l.call(h,a[g],g,a)}function A(a,l){for(let h in a)l.call(void 0,a[h],h,a)}function m(a){let l={};for(let h in a)l[h]=a[h];return l}let b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function x(a,l){let h,g;for(let C=1;C<arguments.length;C++){g=arguments[C];for(h in g)a[h]=g[h];for(let E=0;E<b.length;E++)h=b[E],Object.prototype.hasOwnProperty.call(g,h)&&(a[h]=g[h])}}function y(a){var l=1;a=a.split(":");let h=[];for(;0<l&&a.length;)h.push(a.shift()),l--;return a.length&&h.push(a.join(":")),h}function S(a){d.setTimeout(()=>{throw a},0)}function w(){var a=Ds;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class At{constructor(){this.h=this.g=null}add(l,h){let g=Qi.get();g.set(l,h),this.h?this.h.next=g:this.g=g,this.h=g}}var Qi=new H(()=>new bb,a=>a.reset());class bb{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let qi,Gi=!1,Ds=new At,Ch=()=>{let a=d.Promise.resolve(void 0);qi=()=>{a.then(wb)}};var wb=()=>{for(var a;a=w();){try{a.h.call(a.g)}catch(h){S(h)}var l=Qi;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}Gi=!1};function Ot(){this.s=this.s,this.C=this.C}Ot.prototype.s=!1,Ot.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ot.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Te(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}Te.prototype.h=function(){this.defaultPrevented=!0};var xb=(function(){if(!d.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let h=()=>{};d.addEventListener("test",h,l),d.removeEventListener("test",h,l)}catch{}return a})();function Wi(a,l){if(Te.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var h=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(ge){e:{try{X(l.nodeName);var C=!0;break e}catch{}C=!1}C||(l=null)}}else h=="mouseover"?l=a.fromElement:h=="mouseout"&&(l=a.toElement);this.relatedTarget=l,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:Ab[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Wi.aa.h.call(this)}}T(Wi,Te);var Ab={2:"touch",3:"pen",4:"mouse"};Wi.prototype.h=function(){Wi.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Zi="closure_listenable_"+(1e6*Math.random()|0),yb=0;function Cb(a,l,h,g,C){this.listener=a,this.proxy=null,this.src=l,this.type=h,this.capture=!!g,this.ha=C,this.key=++yb,this.da=this.fa=!1}function dr(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function lr(a){this.src=a,this.g={},this.h=0}lr.prototype.add=function(a,l,h,g,C){var E=a.toString();a=this.g[E],a||(a=this.g[E]=[],this.h++);var V=Vs(a,l,g,C);return-1<V?(l=a[V],h||(l.fa=!1)):(l=new Cb(l,this.src,E,!!g,C),l.fa=h,a.push(l)),l};function Bs(a,l){var h=l.type;if(h in a.g){var g=a.g[h],C=Array.prototype.indexOf.call(g,l,void 0),E;(E=0<=C)&&Array.prototype.splice.call(g,C,1),E&&(dr(l),a.g[h].length==0&&(delete a.g[h],a.h--))}}function Vs(a,l,h,g){for(var C=0;C<a.length;++C){var E=a[C];if(!E.da&&E.listener==l&&E.capture==!!h&&E.ha==g)return C}return-1}var Ms="closure_lm_"+(1e6*Math.random()|0),Ls={};function _h(a,l,h,g,C){if(g&&g.once)return Eh(a,l,h,g,C);if(Array.isArray(l)){for(var E=0;E<l.length;E++)_h(a,l[E],h,g,C);return null}return h=Os(h),a&&a[Zi]?a.K(l,h,u(g)?!!g.capture:!!g,C):Sh(a,l,h,!1,g,C)}function Sh(a,l,h,g,C,E){if(!l)throw Error("Invalid event type");var V=u(C)?!!C.capture:!!C,ne=Rs(a);if(ne||(a[Ms]=ne=new lr(a)),h=ne.add(l,h,g,V,E),h.proxy)return h;if(g=_b(),h.proxy=g,g.src=a,g.listener=h,a.addEventListener)xb||(C=V),C===void 0&&(C=!1),a.addEventListener(l.toString(),g,C);else if(a.attachEvent)a.attachEvent(Ph(l.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return h}function _b(){function a(h){return l.call(a.src,a.listener,h)}let l=Sb;return a}function Eh(a,l,h,g,C){if(Array.isArray(l)){for(var E=0;E<l.length;E++)Eh(a,l[E],h,g,C);return null}return h=Os(h),a&&a[Zi]?a.L(l,h,u(g)?!!g.capture:!!g,C):Sh(a,l,h,!0,g,C)}function Th(a,l,h,g,C){if(Array.isArray(l))for(var E=0;E<l.length;E++)Th(a,l[E],h,g,C);else g=u(g)?!!g.capture:!!g,h=Os(h),a&&a[Zi]?(a=a.i,l=String(l).toString(),l in a.g&&(E=a.g[l],h=Vs(E,h,g,C),-1<h&&(dr(E[h]),Array.prototype.splice.call(E,h,1),E.length==0&&(delete a.g[l],a.h--)))):a&&(a=Rs(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Vs(l,h,g,C)),(h=-1<a?l[a]:null)&&Fs(h))}function Fs(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[Zi])Bs(l.i,a);else{var h=a.type,g=a.proxy;l.removeEventListener?l.removeEventListener(h,g,a.capture):l.detachEvent?l.detachEvent(Ph(h),g):l.addListener&&l.removeListener&&l.removeListener(g),(h=Rs(l))?(Bs(h,a),h.h==0&&(h.src=null,l[Ms]=null)):dr(a)}}}function Ph(a){return a in Ls?Ls[a]:Ls[a]="on"+a}function Sb(a,l){if(a.da)a=!0;else{l=new Wi(l,this);var h=a.listener,g=a.ha||a.src;a.fa&&Fs(a),a=h.call(g,l)}return a}function Rs(a){return a=a[Ms],a instanceof lr?a:null}var Ns="__closure_events_fn_"+(1e9*Math.random()>>>0);function Os(a){return typeof a=="function"?a:(a[Ns]||(a[Ns]=function(l){return a.handleEvent(l)}),a[Ns])}function Pe(){Ot.call(this),this.i=new lr(this),this.M=this,this.F=null}T(Pe,Ot),Pe.prototype[Zi]=!0,Pe.prototype.removeEventListener=function(a,l,h,g){Th(this,a,l,h,g)};function Re(a,l){var h,g=a.F;if(g)for(h=[];g;g=g.F)h.push(g);if(a=a.M,g=l.type||l,typeof l=="string")l=new Te(l,a);else if(l instanceof Te)l.target=l.target||a;else{var C=l;l=new Te(g,a),x(l,C)}if(C=!0,h)for(var E=h.length-1;0<=E;E--){var V=l.g=h[E];C=cr(V,g,!0,l)&&C}if(V=l.g=a,C=cr(V,g,!0,l)&&C,C=cr(V,g,!1,l)&&C,h)for(E=0;E<h.length;E++)V=l.g=h[E],C=cr(V,g,!1,l)&&C}Pe.prototype.N=function(){if(Pe.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var h=a.g[l],g=0;g<h.length;g++)dr(h[g]);delete a.g[l],a.h--}}this.F=null},Pe.prototype.K=function(a,l,h,g){return this.i.add(String(a),l,!1,h,g)},Pe.prototype.L=function(a,l,h,g){return this.i.add(String(a),l,!0,h,g)};function cr(a,l,h,g){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var C=!0,E=0;E<l.length;++E){var V=l[E];if(V&&!V.da&&V.capture==h){var ne=V.listener,Se=V.ha||V.src;V.fa&&Bs(a.i,V),C=ne.call(Se,g)!==!1&&C}}return C&&!g.defaultPrevented}function Ih(a,l,h){if(typeof a=="function")h&&(a=v(a,h));else if(a&&typeof a.handleEvent=="function")a=v(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:d.setTimeout(a,l||0)}function kh(a){a.g=Ih(()=>{a.g=null,a.i&&(a.i=!1,kh(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class Eb extends Ot{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:kh(this)}N(){super.N(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ki(a){Ot.call(this),this.h=a,this.g={}}T(Ki,Ot);var Dh=[];function Bh(a){Y(a.g,function(l,h){this.g.hasOwnProperty(h)&&Fs(l)},a),a.g={}}Ki.prototype.N=function(){Ki.aa.N.call(this),Bh(this)},Ki.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var zs=d.JSON.stringify,Tb=d.JSON.parse,Pb=class{stringify(a){return d.JSON.stringify(a,void 0)}parse(a){return d.JSON.parse(a,void 0)}};function Hs(){}Hs.prototype.h=null;function Vh(a){return a.h||(a.h=a.i())}function Mh(){}var Yi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function js(){Te.call(this,"d")}T(js,Te);function Us(){Te.call(this,"c")}T(Us,Te);var sn={},Lh=null;function ur(){return Lh=Lh||new Pe}sn.La="serverreachability";function Fh(a){Te.call(this,sn.La,a)}T(Fh,Te);function Ji(a){let l=ur();Re(l,new Fh(l))}sn.STAT_EVENT="statevent";function Rh(a,l){Te.call(this,sn.STAT_EVENT,a),this.stat=l}T(Rh,Te);function Ne(a){let l=ur();Re(l,new Rh(l,a))}sn.Ma="timingevent";function Nh(a,l){Te.call(this,sn.Ma,a),this.size=l}T(Nh,Te);function Xi(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return d.setTimeout(function(){a()},l)}function $i(){this.g=!0}$i.prototype.xa=function(){this.g=!1};function Ib(a,l,h,g,C,E){a.info(function(){if(a.g)if(E)for(var V="",ne=E.split("&"),Se=0;Se<ne.length;Se++){var $=ne[Se].split("=");if(1<$.length){var Ie=$[0];$=$[1];var ke=Ie.split("_");V=2<=ke.length&&ke[1]=="type"?V+(Ie+"="+$+"&"):V+(Ie+"=redacted&")}}else V=null;else V=E;return"XMLHTTP REQ ("+g+") [attempt "+C+"]: "+l+`
`+h+`
`+V})}function kb(a,l,h,g,C,E,V){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+C+"]: "+l+`
`+h+`
`+E+" "+V})}function Hn(a,l,h,g){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+Bb(a,h)+(g?" "+g:"")})}function Db(a,l){a.info(function(){return"TIMEOUT: "+l})}$i.prototype.info=function(){};function Bb(a,l){if(!a.g)return l;if(!l)return null;try{var h=JSON.parse(l);if(h){for(a=0;a<h.length;a++)if(Array.isArray(h[a])){var g=h[a];if(!(2>g.length)){var C=g[1];if(Array.isArray(C)&&!(1>C.length)){var E=C[0];if(E!="noop"&&E!="stop"&&E!="close")for(var V=1;V<C.length;V++)C[V]=""}}}}return zs(h)}catch{return l}}var hr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Oh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Qs;function pr(){}T(pr,Hs),pr.prototype.g=function(){return new XMLHttpRequest},pr.prototype.i=function(){return{}},Qs=new pr;function zt(a,l,h,g){this.j=a,this.i=l,this.l=h,this.R=g||1,this.U=new Ki(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new zh}function zh(){this.i=null,this.g="",this.h=!1}var Hh={},qs={};function Gs(a,l,h){a.L=1,a.v=vr(yt(l)),a.m=h,a.P=!0,jh(a,null)}function jh(a,l){a.F=Date.now(),gr(a),a.A=yt(a.v);var h=a.A,g=a.R;Array.isArray(g)||(g=[String(g)]),np(h.i,"t",g),a.C=0,h=a.j.J,a.h=new zh,a.g=xp(a.j,h?l:null,!a.m),0<a.O&&(a.M=new Eb(v(a.Y,a,a.g),a.O)),l=a.U,h=a.g,g=a.ca;var C="readystatechange";Array.isArray(C)||(C&&(Dh[0]=C.toString()),C=Dh);for(var E=0;E<C.length;E++){var V=_h(h,C[E],g||l.handleEvent,!1,l.h||l);if(!V)break;l.g[V.key]=V}l=a.H?m(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),Ji(),Ib(a.i,a.u,a.A,a.l,a.R,a.m)}zt.prototype.ca=function(a){a=a.target;let l=this.M;l&&Ct(a)==3?l.j():this.Y(a)},zt.prototype.Y=function(a){try{if(a==this.g)e:{let ke=Ct(this.g);var l=this.g.Ba();let Qn=this.g.Z();if(!(3>ke)&&(ke!=3||this.g&&(this.h.h||this.g.oa()||lp(this.g)))){this.J||ke!=4||l==7||(l==8||0>=Qn?Ji(3):Ji(2)),Ws(this);var h=this.g.Z();this.X=h;t:if(Uh(this)){var g=lp(this.g);a="";var C=g.length,E=Ct(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){dn(this),eo(this);var V="";break t}this.h.i=new d.TextDecoder}for(l=0;l<C;l++)this.h.h=!0,a+=this.h.i.decode(g[l],{stream:!(E&&l==C-1)});g.length=0,this.h.g+=a,this.C=0,V=this.h.g}else V=this.g.oa();if(this.o=h==200,kb(this.i,this.u,this.A,this.l,this.R,ke,h),this.o){if(this.T&&!this.K){t:{if(this.g){var ne,Se=this.g;if((ne=Se.g?Se.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!R(ne)){var $=ne;break t}}$=null}if(h=$)Hn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Zs(this,h);else{this.o=!1,this.s=3,Ne(12),dn(this),eo(this);break e}}if(this.P){h=!0;let nt;for(;!this.J&&this.C<V.length;)if(nt=Vb(this,V),nt==qs){ke==4&&(this.s=4,Ne(14),h=!1),Hn(this.i,this.l,null,"[Incomplete Response]");break}else if(nt==Hh){this.s=4,Ne(15),Hn(this.i,this.l,V,"[Invalid Chunk]"),h=!1;break}else Hn(this.i,this.l,nt,null),Zs(this,nt);if(Uh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ke!=4||V.length!=0||this.h.h||(this.s=1,Ne(16),h=!1),this.o=this.o&&h,!h)Hn(this.i,this.l,V,"[Invalid Chunked Response]"),dn(this),eo(this);else if(0<V.length&&!this.W){this.W=!0;var Ie=this.j;Ie.g==this&&Ie.ba&&!Ie.M&&(Ie.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),ed(Ie),Ie.M=!0,Ne(11))}}else Hn(this.i,this.l,V,null),Zs(this,V);ke==4&&dn(this),this.o&&!this.J&&(ke==4?mp(this.j,this):(this.o=!1,gr(this)))}else Yb(this.g),h==400&&0<V.indexOf("Unknown SID")?(this.s=3,Ne(12)):(this.s=0,Ne(13)),dn(this),eo(this)}}}catch{}finally{}};function Uh(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function Vb(a,l){var h=a.C,g=l.indexOf(`
`,h);return g==-1?qs:(h=Number(l.substring(h,g)),isNaN(h)?Hh:(g+=1,g+h>l.length?qs:(l=l.slice(g,g+h),a.C=g+h,l)))}zt.prototype.cancel=function(){this.J=!0,dn(this)};function gr(a){a.S=Date.now()+a.I,Qh(a,a.I)}function Qh(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Xi(v(a.ba,a),l)}function Ws(a){a.B&&(d.clearTimeout(a.B),a.B=null)}zt.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(Db(this.i,this.A),this.L!=2&&(Ji(),Ne(17)),dn(this),this.s=2,eo(this)):Qh(this,this.S-a)};function eo(a){a.j.G==0||a.J||mp(a.j,a)}function dn(a){Ws(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,Bh(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function Zs(a,l){try{var h=a.j;if(h.G!=0&&(h.g==a||Ks(h.h,a))){if(!a.K&&Ks(h.h,a)&&h.G==3){try{var g=h.Da.g.parse(l)}catch{g=null}if(Array.isArray(g)&&g.length==3){var C=g;if(C[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<a.F)yr(h),xr(h);else break e;$s(h),Ne(18)}}else h.za=C[1],0<h.za-h.T&&37500>C[2]&&h.F&&h.v==0&&!h.C&&(h.C=Xi(v(h.Za,h),6e3));if(1>=Wh(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else cn(h,11)}else if((a.K||h.g==a)&&yr(h),!R(l))for(C=h.Da.g.parse(l),l=0;l<C.length;l++){let $=C[l];if(h.T=$[0],$=$[1],h.G==2)if($[0]=="c"){h.K=$[1],h.ia=$[2];let Ie=$[3];Ie!=null&&(h.la=Ie,h.j.info("VER="+h.la));let ke=$[4];ke!=null&&(h.Aa=ke,h.j.info("SVER="+h.Aa));let Qn=$[5];Qn!=null&&typeof Qn=="number"&&0<Qn&&(g=1.5*Qn,h.L=g,h.j.info("backChannelRequestTimeoutMs_="+g)),g=h;let nt=a.g;if(nt){let _r=nt.g?nt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_r){var E=g.h;E.g||_r.indexOf("spdy")==-1&&_r.indexOf("quic")==-1&&_r.indexOf("h2")==-1||(E.j=E.l,E.g=new Set,E.h&&(Ys(E,E.h),E.h=null))}if(g.D){let td=nt.g?nt.g.getResponseHeader("X-HTTP-Session-Id"):null;td&&(g.ya=td,oe(g.I,g.D,td))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-a.F,h.j.info("Handshake RTT: "+h.R+"ms")),g=h;var V=a;if(g.qa=wp(g,g.J?g.ia:null,g.W),V.K){Zh(g.h,V);var ne=V,Se=g.L;Se&&(ne.I=Se),ne.B&&(Ws(ne),gr(ne)),g.g=V}else gp(g);0<h.i.length&&Ar(h)}else $[0]!="stop"&&$[0]!="close"||cn(h,7);else h.G==3&&($[0]=="stop"||$[0]=="close"?$[0]=="stop"?cn(h,7):Xs(h):$[0]!="noop"&&h.l&&h.l.ta($),h.v=0)}}Ji(4)}catch{}}var Mb=class{constructor(a,l){this.g=a,this.map=l}};function qh(a){this.l=a||10,d.PerformanceNavigationTiming?(a=d.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(d.chrome&&d.chrome.loadTimes&&d.chrome.loadTimes()&&d.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Gh(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Wh(a){return a.h?1:a.g?a.g.size:0}function Ks(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function Ys(a,l){a.g?a.g.add(l):a.h=l}function Zh(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}qh.prototype.cancel=function(){if(this.i=Kh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Kh(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let h of a.g.values())l=l.concat(h.D);return l}return k(a.i)}function Lb(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(c(a)){for(var l=[],h=a.length,g=0;g<h;g++)l.push(a[g]);return l}l=[],h=0;for(g in a)l[h++]=a[g];return l}function Fb(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||typeof a=="string"){var l=[];a=a.length;for(var h=0;h<a;h++)l.push(h);return l}l=[],h=0;for(let g in a)l[h++]=g;return l}}}function Yh(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(c(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var h=Fb(a),g=Lb(a),C=g.length,E=0;E<C;E++)l.call(void 0,g[E],h&&h[E],a)}var Jh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Rb(a,l){if(a){a=a.split("&");for(var h=0;h<a.length;h++){var g=a[h].indexOf("="),C=null;if(0<=g){var E=a[h].substring(0,g);C=a[h].substring(g+1)}else E=a[h];l(E,C?decodeURIComponent(C.replace(/\+/g," ")):"")}}}function ln(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof ln){this.h=a.h,fr(this,a.j),this.o=a.o,this.g=a.g,mr(this,a.s),this.l=a.l;var l=a.i,h=new io;h.i=l.i,l.g&&(h.g=new Map(l.g),h.h=l.h),Xh(this,h),this.m=a.m}else a&&(l=String(a).match(Jh))?(this.h=!1,fr(this,l[1]||"",!0),this.o=to(l[2]||""),this.g=to(l[3]||"",!0),mr(this,l[4]),this.l=to(l[5]||"",!0),Xh(this,l[6]||"",!0),this.m=to(l[7]||"")):(this.h=!1,this.i=new io(null,this.h))}ln.prototype.toString=function(){var a=[],l=this.j;l&&a.push(no(l,$h,!0),":");var h=this.g;return(h||l=="file")&&(a.push("//"),(l=this.o)&&a.push(no(l,$h,!0),"@"),a.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&a.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&a.push("/"),a.push(no(h,h.charAt(0)=="/"?zb:Ob,!0))),(h=this.i.toString())&&a.push("?",h),(h=this.m)&&a.push("#",no(h,jb)),a.join("")};function yt(a){return new ln(a)}function fr(a,l,h){a.j=h?to(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function mr(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function Xh(a,l,h){l instanceof io?(a.i=l,Ub(a.i,a.h)):(h||(l=no(l,Hb)),a.i=new io(l,a.h))}function oe(a,l,h){a.i.set(l,h)}function vr(a){return oe(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function to(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function no(a,l,h){return typeof a=="string"?(a=encodeURI(a).replace(l,Nb),h&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Nb(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var $h=/[#\/\?@]/g,Ob=/[#\?:]/g,zb=/[#\?]/g,Hb=/[#\?@]/g,jb=/#/g;function io(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function Ht(a){a.g||(a.g=new Map,a.h=0,a.i&&Rb(a.i,function(l,h){a.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}i=io.prototype,i.add=function(a,l){Ht(this),this.i=null,a=jn(this,a);var h=this.g.get(a);return h||this.g.set(a,h=[]),h.push(l),this.h+=1,this};function ep(a,l){Ht(a),l=jn(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function tp(a,l){return Ht(a),l=jn(a,l),a.g.has(l)}i.forEach=function(a,l){Ht(this),this.g.forEach(function(h,g){h.forEach(function(C){a.call(l,C,g,this)},this)},this)},i.na=function(){Ht(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),h=[];for(let g=0;g<l.length;g++){let C=a[g];for(let E=0;E<C.length;E++)h.push(l[g])}return h},i.V=function(a){Ht(this);let l=[];if(typeof a=="string")tp(this,a)&&(l=l.concat(this.g.get(jn(this,a))));else{a=Array.from(this.g.values());for(let h=0;h<a.length;h++)l=l.concat(a[h])}return l},i.set=function(a,l){return Ht(this),this.i=null,a=jn(this,a),tp(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},i.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function np(a,l,h){ep(a,l),0<h.length&&(a.i=null,a.g.set(jn(a,l),k(h)),a.h+=h.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var h=0;h<l.length;h++){var g=l[h];let E=encodeURIComponent(String(g)),V=this.V(g);for(g=0;g<V.length;g++){var C=E;V[g]!==""&&(C+="="+encodeURIComponent(String(V[g]))),a.push(C)}}return this.i=a.join("&")};function jn(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function Ub(a,l){l&&!a.j&&(Ht(a),a.i=null,a.g.forEach(function(h,g){var C=g.toLowerCase();g!=C&&(ep(this,g),np(this,C,h))},a)),a.j=l}function Qb(a,l){let h=new $i;if(d.Image){let g=new Image;g.onload=_(jt,h,"TestLoadImage: loaded",!0,l,g),g.onerror=_(jt,h,"TestLoadImage: error",!1,l,g),g.onabort=_(jt,h,"TestLoadImage: abort",!1,l,g),g.ontimeout=_(jt,h,"TestLoadImage: timeout",!1,l,g),d.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else l(!1)}function qb(a,l){let h=new $i,g=new AbortController,C=setTimeout(()=>{g.abort(),jt(h,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:g.signal}).then(E=>{clearTimeout(C),E.ok?jt(h,"TestPingServer: ok",!0,l):jt(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(C),jt(h,"TestPingServer: error",!1,l)})}function jt(a,l,h,g,C){try{C&&(C.onload=null,C.onerror=null,C.onabort=null,C.ontimeout=null),g(h)}catch{}}function Gb(){this.g=new Pb}function Wb(a,l,h){let g=h||"";try{Yh(a,function(C,E){let V=C;u(C)&&(V=zs(C)),l.push(g+E+"="+encodeURIComponent(V))})}catch(C){throw l.push(g+"type="+encodeURIComponent("_badmap")),C}}function oo(a){this.l=a.Ub||null,this.j=a.eb||!1}T(oo,Hs),oo.prototype.g=function(){return new br(this.l,this.j)},oo.prototype.i=(function(a){return function(){return a}})({});function br(a,l){Pe.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}T(br,Pe),i=br.prototype,i.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,ao(this)},i.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||d).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ro(this)),this.readyState=0},i.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ao(this)),this.g&&(this.readyState=3,ao(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof d.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ip(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function ip(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}i.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?ro(this):ao(this),this.readyState==3&&ip(this)}},i.Ra=function(a){this.g&&(this.response=this.responseText=a,ro(this))},i.Qa=function(a){this.g&&(this.response=a,ro(this))},i.ga=function(){this.g&&ro(this)};function ro(a){a.readyState=4,a.l=null,a.j=null,a.v=null,ao(a)}i.setRequestHeader=function(a,l){this.u.append(a,l)},i.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,a.push(h[0]+": "+h[1]),h=l.next();return a.join(`\r
`)};function ao(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(br.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function op(a){let l="";return Y(a,function(h,g){l+=g,l+=":",l+=h,l+=`\r
`}),l}function Js(a,l,h){e:{for(g in h){var g=!1;break e}g=!0}g||(h=op(h),typeof a=="string"?h!=null&&encodeURIComponent(String(h)):oe(a,l,h))}function ue(a){Pe.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}T(ue,Pe);var Zb=/^https?$/i,Kb=["POST","PUT"];i=ue.prototype,i.Ha=function(a){this.J=a},i.ea=function(a,l,h,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Qs.g(),this.v=this.o?Vh(this.o):Vh(Qs),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(E){rp(this,E);return}if(a=h||"",h=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var C in g)h.set(C,g[C]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let E of g.keys())h.set(E,g.get(E));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(h.keys()).find(E=>E.toLowerCase()=="content-type"),C=d.FormData&&a instanceof d.FormData,!(0<=Array.prototype.indexOf.call(Kb,l,void 0))||g||C||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[E,V]of h)this.g.setRequestHeader(E,V);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{dp(this),this.u=!0,this.g.send(a),this.u=!1}catch(E){rp(this,E)}};function rp(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,ap(a),wr(a)}function ap(a){a.A||(a.A=!0,Re(a,"complete"),Re(a,"error"))}i.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Re(this,"complete"),Re(this,"abort"),wr(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),wr(this,!0)),ue.aa.N.call(this)},i.Ea=function(){this.s||(this.B||this.u||this.j?sp(this):this.bb())},i.bb=function(){sp(this)};function sp(a){if(a.h&&typeof s<"u"&&(!a.v[1]||Ct(a)!=4||a.Z()!=2)){if(a.u&&Ct(a)==4)Ih(a.Ea,0,a);else if(Re(a,"readystatechange"),Ct(a)==4){a.h=!1;try{let V=a.Z();e:switch(V){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var h;if(!(h=l)){var g;if(g=V===0){var C=String(a.D).match(Jh)[1]||null;!C&&d.self&&d.self.location&&(C=d.self.location.protocol.slice(0,-1)),g=!Zb.test(C?C.toLowerCase():"")}h=g}if(h)Re(a,"complete"),Re(a,"success");else{a.m=6;try{var E=2<Ct(a)?a.g.statusText:""}catch{E=""}a.l=E+" ["+a.Z()+"]",ap(a)}}finally{wr(a)}}}}function wr(a,l){if(a.g){dp(a);let h=a.g,g=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||Re(a,"ready");try{h.onreadystatechange=g}catch{}}}function dp(a){a.I&&(d.clearTimeout(a.I),a.I=null)}i.isActive=function(){return!!this.g};function Ct(a){return a.g?a.g.readyState:0}i.Z=function(){try{return 2<Ct(this)?this.g.status:-1}catch{return-1}},i.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),Tb(l)}};function lp(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function Yb(a){let l={};a=(a.g&&2<=Ct(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(R(a[g]))continue;var h=y(a[g]);let C=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let E=l[C]||[];l[C]=E,E.push(h)}A(l,function(g){return g.join(", ")})}i.Ba=function(){return this.m},i.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function so(a,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[a]||l}function cp(a){this.Aa=0,this.i=[],this.j=new $i,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=so("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=so("baseRetryDelayMs",5e3,a),this.cb=so("retryDelaySeedMs",1e4,a),this.Wa=so("forwardChannelMaxRetries",2,a),this.wa=so("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new qh(a&&a.concurrentRequestLimit),this.Da=new Gb,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}i=cp.prototype,i.la=8,i.G=1,i.connect=function(a,l,h,g){Ne(0),this.W=a,this.H=l||{},h&&g!==void 0&&(this.H.OSID=h,this.H.OAID=g),this.F=this.X,this.I=wp(this,null,this.W),Ar(this)};function Xs(a){if(up(a),a.G==3){var l=a.U++,h=yt(a.I);if(oe(h,"SID",a.K),oe(h,"RID",l),oe(h,"TYPE","terminate"),lo(a,h),l=new zt(a,a.j,l),l.L=2,l.v=vr(yt(h)),h=!1,d.navigator&&d.navigator.sendBeacon)try{h=d.navigator.sendBeacon(l.v.toString(),"")}catch{}!h&&d.Image&&(new Image().src=l.v,h=!0),h||(l.g=xp(l.j,null),l.g.ea(l.v)),l.F=Date.now(),gr(l)}bp(a)}function xr(a){a.g&&(ed(a),a.g.cancel(),a.g=null)}function up(a){xr(a),a.u&&(d.clearTimeout(a.u),a.u=null),yr(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&d.clearTimeout(a.s),a.s=null)}function Ar(a){if(!Gh(a.h)&&!a.s){a.s=!0;var l=a.Ga;qi||Ch(),Gi||(qi(),Gi=!0),Ds.add(l,a),a.B=0}}function Jb(a,l){return Wh(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Xi(v(a.Ga,a,l),vp(a,a.B)),a.B++,!0)}i.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let C=new zt(this,this.j,a),E=this.o;if(this.S&&(E?(E=m(E),x(E,this.S)):E=this.S),this.m!==null||this.O||(C.H=E,E=null),this.P)e:{for(var l=0,h=0;h<this.i.length;h++){t:{var g=this.i[h];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(l+=g,4096<l){l=h;break e}if(l===4096||h===this.i.length-1){l=h+1;break e}}l=1e3}else l=1e3;l=pp(this,C,l),h=yt(this.I),oe(h,"RID",a),oe(h,"CVER",22),this.D&&oe(h,"X-HTTP-Session-Id",this.D),lo(this,h),E&&(this.O?l="headers="+encodeURIComponent(String(op(E)))+"&"+l:this.m&&Js(h,this.m,E)),Ys(this.h,C),this.Ua&&oe(h,"TYPE","init"),this.P?(oe(h,"$req",l),oe(h,"SID","null"),C.T=!0,Gs(C,h,null)):Gs(C,h,l),this.G=2}}else this.G==3&&(a?hp(this,a):this.i.length==0||Gh(this.h)||hp(this))};function hp(a,l){var h;l?h=l.l:h=a.U++;let g=yt(a.I);oe(g,"SID",a.K),oe(g,"RID",h),oe(g,"AID",a.T),lo(a,g),a.m&&a.o&&Js(g,a.m,a.o),h=new zt(a,a.j,h,a.B+1),a.m===null&&(h.H=a.o),l&&(a.i=l.D.concat(a.i)),l=pp(a,h,1e3),h.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),Ys(a.h,h),Gs(h,g,l)}function lo(a,l){a.H&&Y(a.H,function(h,g){oe(l,g,h)}),a.l&&Yh({},function(h,g){oe(l,g,h)})}function pp(a,l,h){h=Math.min(a.i.length,h);var g=a.l?v(a.l.Na,a.l,a):null;e:{var C=a.i;let E=-1;for(;;){let V=["count="+h];E==-1?0<h?(E=C[0].g,V.push("ofs="+E)):E=0:V.push("ofs="+E);let ne=!0;for(let Se=0;Se<h;Se++){let $=C[Se].g,Ie=C[Se].map;if($-=E,0>$)E=Math.max(0,C[Se].g-100),ne=!1;else try{Wb(Ie,V,"req"+$+"_")}catch{g&&g(Ie)}}if(ne){g=V.join("&");break e}}}return a=a.i.splice(0,h),l.D=a,g}function gp(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;qi||Ch(),Gi||(qi(),Gi=!0),Ds.add(l,a),a.v=0}}function $s(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Xi(v(a.Fa,a),vp(a,a.v)),a.v++,!0)}i.Fa=function(){if(this.u=null,fp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Xi(v(this.ab,this),a)}},i.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ne(10),xr(this),fp(this))};function ed(a){a.A!=null&&(d.clearTimeout(a.A),a.A=null)}function fp(a){a.g=new zt(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=yt(a.qa);oe(l,"RID","rpc"),oe(l,"SID",a.K),oe(l,"AID",a.T),oe(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&oe(l,"TO",a.ja),oe(l,"TYPE","xmlhttp"),lo(a,l),a.m&&a.o&&Js(l,a.m,a.o),a.L&&(a.g.I=a.L);var h=a.g;a=a.ia,h.L=1,h.v=vr(yt(l)),h.m=null,h.P=!0,jh(h,a)}i.Za=function(){this.C!=null&&(this.C=null,xr(this),$s(this),Ne(19))};function yr(a){a.C!=null&&(d.clearTimeout(a.C),a.C=null)}function mp(a,l){var h=null;if(a.g==l){yr(a),ed(a),a.g=null;var g=2}else if(Ks(a.h,l))h=l.D,Zh(a.h,l),g=1;else return;if(a.G!=0){if(l.o)if(g==1){h=l.m?l.m.length:0,l=Date.now()-l.F;var C=a.B;g=ur(),Re(g,new Nh(g,h)),Ar(a)}else gp(a);else if(C=l.s,C==3||C==0&&0<l.X||!(g==1&&Jb(a,l)||g==2&&$s(a)))switch(h&&0<h.length&&(l=a.h,l.i=l.i.concat(h)),C){case 1:cn(a,5);break;case 4:cn(a,10);break;case 3:cn(a,6);break;default:cn(a,2)}}}function vp(a,l){let h=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(h*=2),h*l}function cn(a,l){if(a.j.info("Error code "+l),l==2){var h=v(a.fb,a),g=a.Xa;let C=!g;g=new ln(g||"//www.google.com/images/cleardot.gif"),d.location&&d.location.protocol=="http"||fr(g,"https"),vr(g),C?Qb(g.toString(),h):qb(g.toString(),h)}else Ne(2);a.G=0,a.l&&a.l.sa(l),bp(a),up(a)}i.fb=function(a){a?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))};function bp(a){if(a.G=0,a.ka=[],a.l){let l=Kh(a.h);(l.length!=0||a.i.length!=0)&&(I(a.ka,l),I(a.ka,a.i),a.h.i.length=0,k(a.i),a.i.length=0),a.l.ra()}}function wp(a,l,h){var g=h instanceof ln?yt(h):new ln(h);if(g.g!="")l&&(g.g=l+"."+g.g),mr(g,g.s);else{var C=d.location;g=C.protocol,l=l?l+"."+C.hostname:C.hostname,C=+C.port;var E=new ln(null);g&&fr(E,g),l&&(E.g=l),C&&mr(E,C),h&&(E.l=h),g=E}return h=a.D,l=a.ya,h&&l&&oe(g,h,l),oe(g,"VER",a.la),lo(a,g),g}function xp(a,l,h){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new ue(new oo({eb:h})):new ue(a.pa),l.Ha(a.J),l}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ap(){}i=Ap.prototype,i.ua=function(){},i.ta=function(){},i.sa=function(){},i.ra=function(){},i.isActive=function(){return!0},i.Na=function(){};function Cr(){}Cr.prototype.g=function(a,l){return new Qe(a,l)};function Qe(a,l){Pe.call(this),this.g=new cp(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!R(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!R(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new Un(this)}T(Qe,Pe),Qe.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Qe.prototype.close=function(){Xs(this.g)},Qe.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var h={};h.__data__=a,a=h}else this.u&&(h={},h.__data__=zs(a),a=h);l.i.push(new Mb(l.Ya++,a)),l.G==3&&Ar(l)},Qe.prototype.N=function(){this.g.l=null,delete this.j,Xs(this.g),delete this.g,Qe.aa.N.call(this)};function yp(a){js.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let h in l){a=h;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}T(yp,js);function Cp(){Us.call(this),this.status=1}T(Cp,Us);function Un(a){this.g=a}T(Un,Ap),Un.prototype.ua=function(){Re(this.g,"a")},Un.prototype.ta=function(a){Re(this.g,new yp(a))},Un.prototype.sa=function(a){Re(this.g,new Cp)},Un.prototype.ra=function(){Re(this.g,"b")},Cr.prototype.createWebChannel=Cr.prototype.g,Qe.prototype.send=Qe.prototype.o,Qe.prototype.open=Qe.prototype.m,Qe.prototype.close=Qe.prototype.close,Id=Tt.createWebChannelTransport=function(){return new Cr},Pd=Tt.getStatEventTarget=function(){return ur()},Td=Tt.Event=sn,la=Tt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},hr.NO_ERROR=0,hr.TIMEOUT=8,hr.HTTP_ERROR=6,wo=Tt.ErrorCode=hr,Oh.COMPLETE="complete",Ed=Tt.EventType=Oh,Mh.EventType=Yi,Yi.OPEN="a",Yi.CLOSE="b",Yi.ERROR="c",Yi.MESSAGE="d",Pe.prototype.listen=Pe.prototype.K,$n=Tt.WebChannel=Mh,Xb=Tt.FetchXmlHttpFactory=oo,ue.prototype.listenOnce=ue.prototype.L,ue.prototype.getLastError=ue.prototype.Ka,ue.prototype.getLastErrorCode=ue.prototype.Ba,ue.prototype.getStatus=ue.prototype.Z,ue.prototype.getResponseJson=ue.prototype.Oa,ue.prototype.getResponseText=ue.prototype.oa,ue.prototype.send=ue.prototype.ea,ue.prototype.setWithCredentials=ue.prototype.Ha,Sd=Tt.XhrIo=ue}).apply(typeof da<"u"?da:typeof self<"u"?self:typeof window<"u"?window:{});var Mg="@firebase/firestore",Lg="4.8.0";var ye=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ye.UNAUTHENTICATED=new ye(null),ye.GOOGLE_CREDENTIALS=new ye("google-credentials-uid"),ye.FIRST_PARTY=new ye("first-party-uid"),ye.MOCK_USER=new ye("mock-user");var xi="11.10.0";var Cn=new Gr("@firebase/firestore");function ei(){return Cn.logLevel}function F(i,...e){if(Cn.logLevel<=Ye.DEBUG){let t=e.map(yc);Cn.debug(`Firestore (${xi}): ${i}`,...t)}}function kt(i,...e){if(Cn.logLevel<=Ye.ERROR){let t=e.map(yc);Cn.error(`Firestore (${xi}): ${i}`,...t)}}function Jt(i,...e){if(Cn.logLevel<=Ye.WARN){let t=e.map(yc);Cn.warn(`Firestore (${xi}): ${i}`,...t)}}function yc(i){if(typeof i=="string")return i;try{return(function(t){return JSON.stringify(t)})(i)}catch{return i}}function O(i,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,If(i,n,t)}function If(i,e,t){let n=`FIRESTORE (${xi}) INTERNAL ASSERTION FAILED: ${e} (ID: ${i.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw kt(n),new Error(n)}function ee(i,e,t,n){let o="Unexpected state";typeof t=="string"?o=t:n=t,i||If(e,o,n)}function j(i,e){return i}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},L=class extends ag{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Pt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ma=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Md=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ye.UNAUTHENTICATED))}shutdown(){}},Ld=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Fd=class{constructor(e){this.t=e,this.currentUser=ye.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ee(this.o===void 0,42304);let n=this.i,o=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),r=new Pt;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Pt,e.enqueueRetryable(()=>o(this.currentUser))};let s=()=>{let c=r;e.enqueueRetryable(()=>B(this,null,function*(){yield c.promise,yield o(this.currentUser)}))},d=c=>{F("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(c=>d(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?d(c):(F("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Pt)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(F("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(ee(typeof n.accessToken=="string",31837,{l:n}),new ma(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return ee(e===null||typeof e=="string",2055,{h:e}),new ye(e)}},Rd=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=ye.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Nd=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Rd(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ye.FIRST_PARTY))}shutdown(){}invalidateToken(){}},va=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Od=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Kr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ee(this.o===void 0,3512);let n=r=>{r.error!=null&&F("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);let s=r.token!==this.m;return this.m=r.token,F("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>n(r))};let o=r=>{F("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(r=>o(r)),setTimeout(()=>{if(!this.appCheck){let r=this.V.getImmediate({optional:!0});r?o(r):F("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new va(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ee(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new va(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function $b(i){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}function kf(){return new TextEncoder}var So=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let o=$b(40);for(let r=0;r<o.length;++r)n.length<20&&o[r]<t&&(n+=e.charAt(o[r]%62))}return n}};function Q(i,e){return i<e?-1:i>e?1:0}function zd(i,e){let t=0;for(;t<i.length&&t<e.length;){let n=i.codePointAt(t),o=e.codePointAt(t);if(n!==o){if(n<128&&o<128)return Q(n,o);{let r=kf(),s=ew(r.encode(Fg(i,t)),r.encode(Fg(e,t)));return s!==0?s:Q(n,o)}}t+=n>65535?2:1}return Q(i.length,e.length)}function Fg(i,e){return i.codePointAt(e)>65535?i.substring(e,e+2):i.substring(e,e+1)}function ew(i,e){for(let t=0;t<i.length&&t<e.length;++t)if(i[t]!==e[t])return Q(i[t],e[t]);return Q(i.length,e.length)}function di(i,e,t){return i.length===e.length&&i.every((n,o)=>t(n,e[o]))}var Rg="__name__",ba=class i{constructor(e,t,n){t===void 0?t=0:t>e.length&&O(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&O(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return i.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof i?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let o=0;o<n;o++){let r=i.compareSegments(e.get(o),t.get(o));if(r!==0)return r}return Q(e.length,t.length)}static compareSegments(e,t){let n=i.isNumericId(e),o=i.isNumericId(t);return n&&!o?-1:!n&&o?1:n&&o?i.extractNumericId(e).compare(i.extractNumericId(t)):zd(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Et.fromString(e.substring(4,e.length-2))}},se=class i extends ba{construct(e,t,n){return new i(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new L(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(o=>o.length>0))}return new i(t)}static emptyPath(){return new i([])}},tw=/^[_a-zA-Z][_a-zA-Z0-9]*$/,We=class i extends ba{construct(e,t,n){return new i(e,t,n)}static isValidIdentifier(e){return tw.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),i.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Rg}static keyField(){return new i([Rg])}static fromServerFormat(e){let t=[],n="",o=0,r=()=>{if(n.length===0)throw new L(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;o<e.length;){let d=e[o];if(d==="\\"){if(o+1===e.length)throw new L(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[o+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new L(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,o+=2}else d==="`"?(s=!s,o++):d!=="."||s?(n+=d,o++):(r(),o++)}if(r(),s)throw new L(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new i(t)}static emptyPath(){return new i([])}};var N=class i{constructor(e){this.path=e}static fromPath(e){return new i(se.fromString(e))}static fromName(e){return new i(se.fromString(e).popFirst(5))}static empty(){return new i(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new i(new se(e.slice()))}};function Df(i,e,t){if(!t)throw new L(P.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function nw(i,e,t,n){if(e===!0&&n===!0)throw new L(P.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function Ng(i){if(!N.isDocumentKey(i))throw new L(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function Og(i){if(N.isDocumentKey(i))throw new L(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function Bf(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function Ka(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{let e=(function(n){return n.constructor?n.constructor.name:null})(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":O(12329,{type:typeof i})}function Gt(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new L(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Ka(i);throw new L(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function be(i,e){let t={typeString:i};return e&&(t.value=e),t}function Fo(i,e){if(!Bf(i))throw new L(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(let n in e)if(e[n]){let o=e[n].typeString,r="value"in e[n]?{value:e[n].value}:void 0;if(!(n in i)){t=`JSON missing required field: '${n}'`;break}let s=i[n];if(o&&typeof s!==o){t=`JSON field '${n}' must be a ${o}.`;break}if(r!==void 0&&s!==r.value){t=`Expected '${n}' field to equal '${r.value}'`;break}}if(t)throw new L(P.INVALID_ARGUMENT,t);return!0}var zg=-62135596800,Hg=1e6,we=class i{static now(){return i.fromMillis(Date.now())}static fromDate(e){return i.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Hg);return new i(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<zg)throw new L(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Hg}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:i._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Fo(e,i._jsonSchema))return new i(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-zg;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};we._jsonSchemaVersion="firestore/timestamp/1.0",we._jsonSchema={type:be("string",we._jsonSchemaVersion),seconds:be("number"),nanoseconds:be("number")};var U=class i{static fromTimestamp(e){return new i(e)}static min(){return new i(new we(0,0))}static max(){return new i(new we(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Eo=-1,Hd=class{constructor(e,t,n,o){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=o}};Hd.UNKNOWN_ID=-1;function iw(i,e){let t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,o=U.fromTimestamp(n===1e9?new we(t+1,0):new we(t,n));return new _n(o,N.empty(),e)}function ow(i){return new _n(i.readTime,i.key,Eo)}var _n=class i{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new i(U.min(),N.empty(),Eo)}static max(){return new i(U.max(),N.empty(),Eo)}};function rw(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=N.comparator(i.documentKey,e.documentKey),t!==0?t:Q(i.largestBatchId,e.largestBatchId))}var aw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",jd=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ai(i){return B(this,null,function*(){if(i.code!==P.FAILED_PRECONDITION||i.message!==aw)throw i;F("LocalStore","Unexpectedly lost primary lease")})}var D=class i{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&O(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new i((n,o)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(n,o)},this.catchCallback=r=>{this.wrapFailure(t,r).next(n,o)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof i?t:i.resolve(t)}catch(t){return i.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):i.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):i.reject(t)}static resolve(e){return new i((t,n)=>{t(e)})}static reject(e){return new i((t,n)=>{n(e)})}static waitFor(e){return new i((t,n)=>{let o=0,r=0,s=!1;e.forEach(d=>{++o,d.next(()=>{++r,s&&r===o&&t()},c=>n(c))}),s=!0,r===o&&t()})}static or(e){let t=i.resolve(!1);for(let n of e)t=t.next(o=>o?i.resolve(o):n());return t}static forEach(e,t){let n=[];return e.forEach((o,r)=>{n.push(t.call(this,o,r))}),this.waitFor(n)}static mapArray(e,t){return new i((n,o)=>{let r=e.length,s=new Array(r),d=0;for(let c=0;c<r;c++){let u=c;t(e[u]).next(p=>{s[u]=p,++d,d===r&&n(s)},p=>o(p))}})}static doWhile(e,t){return new i((n,o)=>{let r=()=>{e()===!0?t().next(()=>{r()},o):n()};r()})}};function sw(i){let e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function yi(i){return i.name==="IndexedDbTransactionError"}var Cc=(()=>{class i{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=o=>this._e(o),this.ae=o=>n.writeSequenceNumber(o))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}i.ue=-1;return i})(),_c=-1;function Ya(i){return i==null}function To(i){return i===0&&1/i==-1/0}function dw(i){return typeof i=="number"&&Number.isInteger(i)&&!To(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}var Vf="";function lw(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=jg(e)),e=cw(i.get(t),e);return jg(e)}function cw(i,e){let t=e,n=i.length;for(let o=0;o<n;o++){let r=i.charAt(o);switch(r){case"\0":t+="";break;case Vf:t+="";break;default:t+=r}}return t}function jg(i){return i+Vf+""}var uw="remoteDocuments",Mf="owner";var Lf="mutationQueues";var Ff="mutations";var Rf="documentMutations",hw="remoteDocumentsV14";var Nf="remoteDocumentGlobal";var Of="targets";var zf="targetDocuments";var Hf="targetGlobal",jf="collectionParents";var Uf="clientMetadata";var Qf="bundles";var qf="namedQueries";var pw="indexConfiguration";var gw="indexState";var fw="indexEntries";var Gf="documentOverlays";var mw="globals";var vw=[Lf,Ff,Rf,uw,Of,Mf,Hf,zf,Uf,Nf,jf,Qf,qf],P2=[...vw,Gf],bw=[Lf,Ff,Rf,hw,Of,Mf,Hf,zf,Uf,Nf,jf,Qf,qf,Gf],ww=bw,xw=[...ww,pw,gw,fw];var I2=[...xw,mw];function Ug(i){let e=0;for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function on(i,e){for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function Wf(i){for(let e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}var he=class i{constructor(e,t){this.comparator=e,this.root=t||mt.EMPTY}insert(e,t){return new i(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,mt.BLACK,null,null))}remove(e){return new i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,mt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let o=this.comparator(e,n.key);if(o===0)return t+n.left.size;o<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new oi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new oi(this.root,e,this.comparator,!1)}getReverseIterator(){return new oi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new oi(this.root,e,this.comparator,!0)}},oi=class{constructor(e,t,n,o){this.isReverse=o,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&o&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},mt=class i{constructor(e,t,n,o,r){this.key=e,this.value=t,this.color=n??i.RED,this.left=o??i.EMPTY,this.right=r??i.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,o,r){return new i(e??this.key,t??this.value,n??this.color,o??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let o=this,r=n(e,o.key);return o=r<0?o.copy(null,null,null,o.left.insert(e,t,n),null):r===0?o.copy(null,t,null,null,null):o.copy(null,null,null,null,o.right.insert(e,t,n)),o.fixUp()}removeMin(){if(this.left.isEmpty())return i.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,o=this;if(t(e,o.key)<0)o.left.isEmpty()||o.left.isRed()||o.left.left.isRed()||(o=o.moveRedLeft()),o=o.copy(null,null,null,o.left.remove(e,t),null);else{if(o.left.isRed()&&(o=o.rotateRight()),o.right.isEmpty()||o.right.isRed()||o.right.left.isRed()||(o=o.moveRedRight()),t(e,o.key)===0){if(o.right.isEmpty())return i.EMPTY;n=o.right.min(),o=o.copy(n.key,n.value,null,null,o.right.removeMin())}o=o.copy(null,null,null,null,o.right.remove(e,t))}return o.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw O(43730,{key:this.key,value:this.value});if(this.right.isRed())throw O(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw O(27949);return e+(this.isRed()?0:1)}};mt.EMPTY=null,mt.RED=!0,mt.BLACK=!1;mt.EMPTY=new class{constructor(){this.size=0}get key(){throw O(57766)}get value(){throw O(16141)}get color(){throw O(16727)}get left(){throw O(29726)}get right(){throw O(36894)}copy(e,t,n,o,r){return this}insert(e,t,n){return new mt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ce=class i{constructor(e){this.comparator=e,this.data=new he(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let o=n.getNext();if(this.comparator(o.key,e[1])>=0)return;t(o.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new wa(this.data.getIterator())}getIteratorFrom(e){return new wa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let o=t.getNext().key,r=n.getNext().key;if(this.comparator(o,r)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new i(this.comparator);return t.data=e,t}},wa=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Xe=class i{constructor(e){this.fields=e,e.sort(We.comparator)}static empty(){return new i([])}unionWith(e){let t=new Ce(We.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new i(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return di(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var xa=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Be=class i{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(o){try{return atob(o)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new xa("Invalid base64 string: "+r):r}})(e);return new i(t)}static fromUint8Array(e){let t=(function(o){let r="";for(let s=0;s<o.length;++s)r+=String.fromCharCode(o[s]);return r})(e);return new i(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Be.EMPTY_BYTE_STRING=new Be("");var Aw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dt(i){if(ee(!!i,39018),typeof i=="string"){let e=0,t=Aw.exec(i);if(ee(!!t,46558,{timestamp:i}),t[1]){let o=t[1];o=(o+"000000000").substr(0,9),e=Number(o)}let n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:ae(i.seconds),nanos:ae(i.nanos)}}function ae(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function Bt(i){return typeof i=="string"?Be.fromBase64String(i):Be.fromUint8Array(i)}var Zf="server_timestamp",Kf="__type__",Yf="__previous_value__",Jf="__local_write_time__";function Sc(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Kf])===null||t===void 0?void 0:t.stringValue)===Zf}function Ja(i){let e=i.mapValue.fields[Yf];return Sc(e)?Ja(e):e}function Po(i){let e=Dt(i.mapValue.fields[Jf].timestampValue);return new we(e.seconds,e.nanos)}var Ud=class{constructor(e,t,n,o,r,s,d,c,u,p){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=o,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=d,this.longPollingOptions=c,this.useFetchStreams=u,this.isUsingEmulator=p}},Aa="(default)",ya=class i{constructor(e,t){this.projectId=e,this.database=t||Aa}static empty(){return new i("","")}get isDefaultDatabase(){return this.database===Aa}isEqual(e){return e instanceof i&&e.projectId===this.projectId&&e.database===this.database}};var Ec="__type__",Xf="__max__",ca={mapValue:{fields:{__type__:{stringValue:Xf}}}},Tc="__vector__",li="value";function Xt(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?Sc(i)?4:em(i)?9007199254740991:$f(i)?10:11:O(28295,{value:i})}function wt(i,e){if(i===e)return!0;let t=Xt(i);if(t!==Xt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return Po(i).isEqual(Po(e));case 3:return(function(o,r){if(typeof o.timestampValue=="string"&&typeof r.timestampValue=="string"&&o.timestampValue.length===r.timestampValue.length)return o.timestampValue===r.timestampValue;let s=Dt(o.timestampValue),d=Dt(r.timestampValue);return s.seconds===d.seconds&&s.nanos===d.nanos})(i,e);case 5:return i.stringValue===e.stringValue;case 6:return(function(o,r){return Bt(o.bytesValue).isEqual(Bt(r.bytesValue))})(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return(function(o,r){return ae(o.geoPointValue.latitude)===ae(r.geoPointValue.latitude)&&ae(o.geoPointValue.longitude)===ae(r.geoPointValue.longitude)})(i,e);case 2:return(function(o,r){if("integerValue"in o&&"integerValue"in r)return ae(o.integerValue)===ae(r.integerValue);if("doubleValue"in o&&"doubleValue"in r){let s=ae(o.doubleValue),d=ae(r.doubleValue);return s===d?To(s)===To(d):isNaN(s)&&isNaN(d)}return!1})(i,e);case 9:return di(i.arrayValue.values||[],e.arrayValue.values||[],wt);case 10:case 11:return(function(o,r){let s=o.mapValue.fields||{},d=r.mapValue.fields||{};if(Ug(s)!==Ug(d))return!1;for(let c in s)if(s.hasOwnProperty(c)&&(d[c]===void 0||!wt(s[c],d[c])))return!1;return!0})(i,e);default:return O(52216,{left:i})}}function Io(i,e){return(i.values||[]).find(t=>wt(t,e))!==void 0}function ci(i,e){if(i===e)return 0;let t=Xt(i),n=Xt(e);if(t!==n)return Q(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(i.booleanValue,e.booleanValue);case 2:return(function(r,s){let d=ae(r.integerValue||r.doubleValue),c=ae(s.integerValue||s.doubleValue);return d<c?-1:d>c?1:d===c?0:isNaN(d)?isNaN(c)?0:-1:1})(i,e);case 3:return Qg(i.timestampValue,e.timestampValue);case 4:return Qg(Po(i),Po(e));case 5:return zd(i.stringValue,e.stringValue);case 6:return(function(r,s){let d=Bt(r),c=Bt(s);return d.compareTo(c)})(i.bytesValue,e.bytesValue);case 7:return(function(r,s){let d=r.split("/"),c=s.split("/");for(let u=0;u<d.length&&u<c.length;u++){let p=Q(d[u],c[u]);if(p!==0)return p}return Q(d.length,c.length)})(i.referenceValue,e.referenceValue);case 8:return(function(r,s){let d=Q(ae(r.latitude),ae(s.latitude));return d!==0?d:Q(ae(r.longitude),ae(s.longitude))})(i.geoPointValue,e.geoPointValue);case 9:return qg(i.arrayValue,e.arrayValue);case 10:return(function(r,s){var d,c,u,p;let f=r.fields||{},v=s.fields||{},_=(d=f[li])===null||d===void 0?void 0:d.arrayValue,T=(c=v[li])===null||c===void 0?void 0:c.arrayValue,k=Q(((u=_?.values)===null||u===void 0?void 0:u.length)||0,((p=T?.values)===null||p===void 0?void 0:p.length)||0);return k!==0?k:qg(_,T)})(i.mapValue,e.mapValue);case 11:return(function(r,s){if(r===ca.mapValue&&s===ca.mapValue)return 0;if(r===ca.mapValue)return 1;if(s===ca.mapValue)return-1;let d=r.fields||{},c=Object.keys(d),u=s.fields||{},p=Object.keys(u);c.sort(),p.sort();for(let f=0;f<c.length&&f<p.length;++f){let v=zd(c[f],p[f]);if(v!==0)return v;let _=ci(d[c[f]],u[p[f]]);if(_!==0)return _}return Q(c.length,p.length)})(i.mapValue,e.mapValue);default:throw O(23264,{le:t})}}function Qg(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return Q(i,e);let t=Dt(i),n=Dt(e),o=Q(t.seconds,n.seconds);return o!==0?o:Q(t.nanos,n.nanos)}function qg(i,e){let t=i.values||[],n=e.values||[];for(let o=0;o<t.length&&o<n.length;++o){let r=ci(t[o],n[o]);if(r)return r}return Q(t.length,n.length)}function ui(i){return Qd(i)}function Qd(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?(function(t){let n=Dt(t);return`time(${n.seconds},${n.nanos})`})(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?(function(t){return Bt(t).toBase64()})(i.bytesValue):"referenceValue"in i?(function(t){return N.fromName(t).toString()})(i.referenceValue):"geoPointValue"in i?(function(t){return`geo(${t.latitude},${t.longitude})`})(i.geoPointValue):"arrayValue"in i?(function(t){let n="[",o=!0;for(let r of t.values||[])o?o=!1:n+=",",n+=Qd(r);return n+"]"})(i.arrayValue):"mapValue"in i?(function(t){let n=Object.keys(t.fields||{}).sort(),o="{",r=!0;for(let s of n)r?r=!1:o+=",",o+=`${s}:${Qd(t.fields[s])}`;return o+"}"})(i.mapValue):O(61005,{value:i})}function pa(i){switch(Xt(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Ja(i);return e?16+pa(e):16;case 5:return 2*i.stringValue.length;case 6:return Bt(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce((o,r)=>o+pa(r),0)})(i.arrayValue);case 10:case 11:return(function(n){let o=0;return on(n.fields,(r,s)=>{o+=r.length+pa(s)}),o})(i.mapValue);default:throw O(13486,{value:i})}}function Gg(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function qd(i){return!!i&&"integerValue"in i}function Pc(i){return!!i&&"arrayValue"in i}function Wg(i){return!!i&&"nullValue"in i}function Zg(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function ga(i){return!!i&&"mapValue"in i}function $f(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Ec])===null||t===void 0?void 0:t.stringValue)===Tc}function Ao(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){let e={mapValue:{fields:{}}};return on(i.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ao(n)),e}if(i.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ao(i.arrayValue.values[t]);return e}return Object.assign({},i)}function em(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue===Xf}var D2={mapValue:{fields:{[Ec]:{stringValue:Tc},[li]:{arrayValue:{}}}}};var Ge=class i{constructor(e){this.value=e}static empty(){return new i({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ga(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ao(t)}setAll(e){let t=We.emptyPath(),n={},o=[];e.forEach((s,d)=>{if(!t.isImmediateParentOf(d)){let c=this.getFieldsMap(t);this.applyChanges(c,n,o),n={},o=[],t=d.popLast()}s?n[d.lastSegment()]=Ao(s):o.push(d.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,o)}delete(e){let t=this.field(e.popLast());ga(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return wt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let o=t.mapValue.fields[e.get(n)];ga(o)&&o.mapValue.fields||(o={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=o),t=o}return t.mapValue.fields}applyChanges(e,t,n){on(t,(o,r)=>e[o]=r);for(let o of n)delete e[o]}clone(){return new i(Ao(this.value))}};function tm(i){let e=[];return on(i.fields,(t,n)=>{let o=new We([t]);if(ga(n)){let r=tm(n.mapValue).fields;if(r.length===0)e.push(o);else for(let s of r)e.push(o.child(s))}else e.push(o)}),new Xe(e)}var at=class i{constructor(e,t,n,o,r,s,d){this.key=e,this.documentType=t,this.version=n,this.readTime=o,this.createTime=r,this.data=s,this.documentState=d}static newInvalidDocument(e){return new i(e,0,U.min(),U.min(),U.min(),Ge.empty(),0)}static newFoundDocument(e,t,n,o){return new i(e,1,t,U.min(),n,o,0)}static newNoDocument(e,t){return new i(e,2,t,U.min(),U.min(),Ge.empty(),0)}static newUnknownDocument(e,t){return new i(e,3,t,U.min(),U.min(),Ge.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ge.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ge.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof i&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new i(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var hi=class{constructor(e,t){this.position=e,this.inclusive=t}};function Kg(i,e,t){let n=0;for(let o=0;o<i.position.length;o++){let r=e[o],s=i.position[o];if(r.field.isKeyField()?n=N.comparator(N.fromName(s.referenceValue),t.key):n=ci(s,t.data.field(r.field)),r.dir==="desc"&&(n*=-1),n!==0)break}return n}function Yg(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!wt(i.position[t],e.position[t]))return!1;return!0}var Sn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function yw(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}var Ca=class{},ve=class i extends Ca{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Wd(e,t,n):t==="array-contains"?new Yd(e,n):t==="in"?new Jd(e,n):t==="not-in"?new Xd(e,n):t==="array-contains-any"?new $d(e,n):new i(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Zd(e,n):new Kd(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(ci(t,this.value)):t!==null&&Xt(this.value)===Xt(t)&&this.matchesComparison(ci(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return O(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},st=class i extends Ca{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new i(e,t)}matches(e){return nm(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function nm(i){return i.op==="and"}function im(i){return Cw(i)&&nm(i)}function Cw(i){for(let e of i.filters)if(e instanceof st)return!1;return!0}function Gd(i){if(i instanceof ve)return i.field.canonicalString()+i.op.toString()+ui(i.value);if(im(i))return i.filters.map(e=>Gd(e)).join(",");{let e=i.filters.map(t=>Gd(t)).join(",");return`${i.op}(${e})`}}function om(i,e){return i instanceof ve?(function(n,o){return o instanceof ve&&n.op===o.op&&n.field.isEqual(o.field)&&wt(n.value,o.value)})(i,e):i instanceof st?(function(n,o){return o instanceof st&&n.op===o.op&&n.filters.length===o.filters.length?n.filters.reduce((r,s,d)=>r&&om(s,o.filters[d]),!0):!1})(i,e):void O(19439)}function rm(i){return i instanceof ve?(function(t){return`${t.field.canonicalString()} ${t.op} ${ui(t.value)}`})(i):i instanceof st?(function(t){return t.op.toString()+" {"+t.getFilters().map(rm).join(" ,")+"}"})(i):"Filter"}var Wd=class extends ve{constructor(e,t,n){super(e,t,n),this.key=N.fromName(n.referenceValue)}matches(e){let t=N.comparator(e.key,this.key);return this.matchesComparison(t)}},Zd=class extends ve{constructor(e,t){super(e,"in",t),this.keys=am("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Kd=class extends ve{constructor(e,t){super(e,"not-in",t),this.keys=am("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function am(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>N.fromName(n.referenceValue))}var Yd=class extends ve{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Pc(t)&&Io(t.arrayValue,this.value)}},Jd=class extends ve{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Io(this.value.arrayValue,t)}},Xd=class extends ve{constructor(e,t){super(e,"not-in",t)}matches(e){if(Io(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Io(this.value.arrayValue,t)}},$d=class extends ve{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Pc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Io(this.value.arrayValue,n))}};var el=class{constructor(e,t=null,n=[],o=[],r=null,s=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=o,this.limit=r,this.startAt=s,this.endAt=d,this.Pe=null}};function Jg(i,e=null,t=[],n=[],o=null,r=null,s=null){return new el(i,e,t,n,o,r,s)}function Ic(i){let e=j(i);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Gd(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>(function(r){return r.field.canonicalString()+r.dir})(n)).join(","),Ya(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>ui(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>ui(n)).join(",")),e.Pe=t}return e.Pe}function kc(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!yw(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!om(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!Yg(i.startAt,e.startAt)&&Yg(i.endAt,e.endAt)}function tl(i){return N.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}var $t=class{constructor(e,t=null,n=[],o=[],r=null,s="F",d=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=o,this.limit=r,this.limitType=s,this.startAt=d,this.endAt=c,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function _w(i,e,t,n,o,r,s,d){return new $t(i,e,t,n,o,r,s,d)}function Dc(i){return new $t(i)}function Xg(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function sm(i){return i.collectionGroup!==null}function yo(i){let e=j(i);if(e.Te===null){e.Te=[];let t=new Set;for(let r of e.explicitOrderBy)e.Te.push(r),t.add(r.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(s){let d=new Ce(We.comparator);return s.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(d=d.add(u.field))})}),d})(e).forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.Te.push(new Sn(r,n))}),t.has(We.keyField().canonicalString())||e.Te.push(new Sn(We.keyField(),n))}return e.Te}function vt(i){let e=j(i);return e.Ie||(e.Ie=Sw(e,yo(i))),e.Ie}function Sw(i,e){if(i.limitType==="F")return Jg(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map(o=>{let r=o.dir==="desc"?"asc":"desc";return new Sn(o.field,r)});let t=i.endAt?new hi(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new hi(i.startAt.position,i.startAt.inclusive):null;return Jg(i.path,i.collectionGroup,e,i.filters,i.limit,t,n)}}function nl(i,e){let t=i.filters.concat([e]);return new $t(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function il(i,e,t){return new $t(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function Xa(i,e){return kc(vt(i),vt(e))&&i.limitType===e.limitType}function dm(i){return`${Ic(vt(i))}|lt:${i.limitType}`}function ti(i){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(o=>rm(o)).join(", ")}]`),Ya(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(o=>(function(s){return`${s.field.canonicalString()} (${s.dir})`})(o)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(o=>ui(o)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(o=>ui(o)).join(",")),`Target(${n})`})(vt(i))}; limitType=${i.limitType})`}function $a(i,e){return e.isFoundDocument()&&(function(n,o){let r=o.key.path;return n.collectionGroup!==null?o.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(r):N.isDocumentKey(n.path)?n.path.isEqual(r):n.path.isImmediateParentOf(r)})(i,e)&&(function(n,o){for(let r of yo(n))if(!r.field.isKeyField()&&o.data.field(r.field)===null)return!1;return!0})(i,e)&&(function(n,o){for(let r of n.filters)if(!r.matches(o))return!1;return!0})(i,e)&&(function(n,o){return!(n.startAt&&!(function(s,d,c){let u=Kg(s,d,c);return s.inclusive?u<=0:u<0})(n.startAt,yo(n),o)||n.endAt&&!(function(s,d,c){let u=Kg(s,d,c);return s.inclusive?u>=0:u>0})(n.endAt,yo(n),o))})(i,e)}function Ew(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function lm(i){return(e,t)=>{let n=!1;for(let o of yo(i)){let r=Tw(o,e,t);if(r!==0)return r;n=n||o.field.isKeyField()}return 0}}function Tw(i,e,t){let n=i.field.isKeyField()?N.comparator(e.key,t.key):(function(r,s,d){let c=s.data.field(r),u=d.data.field(r);return c!==null&&u!==null?ci(c,u):O(42886)})(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return O(19790,{direction:i.dir})}}var Vt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[o,r]of n)if(this.equalsFn(o,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),o=this.inner[n];if(o===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<o.length;r++)if(this.equalsFn(o[r][0],e))return void(o[r]=[e,t]);o.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let o=0;o<n.length;o++)if(this.equalsFn(n[o][0],e))return n.length===1?delete this.inner[t]:n.splice(o,1),this.innerSize--,!0;return!1}forEach(e){on(this.inner,(t,n)=>{for(let[o,r]of n)e(o,r)})}isEmpty(){return Wf(this.inner)}size(){return this.innerSize}};var Pw=new he(N.comparator);function Mt(){return Pw}var cm=new he(N.comparator);function xo(...i){let e=cm;for(let t of i)e=e.insert(t.key,t);return e}function um(i){let e=cm;return i.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function wn(){return Co()}function hm(){return Co()}function Co(){return new Vt(i=>i.toString(),(i,e)=>i.isEqual(e))}var Iw=new he(N.comparator),kw=new Ce(N.comparator);function q(...i){let e=kw;for(let t of i)e=e.add(t);return e}var Dw=new Ce(Q);function Bw(){return Dw}function Bc(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:To(e)?"-0":e}}function pm(i){return{integerValue:""+i}}function Vw(i,e){return dw(e)?pm(e):Bc(i,e)}var pi=class{constructor(){this._=void 0}};function Mw(i,e,t){return i instanceof En?(function(o,r){let s={fields:{[Kf]:{stringValue:Zf},[Jf]:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return r&&Sc(r)&&(r=Ja(r)),r&&(s.fields[Yf]=r),{mapValue:s}})(t,e):i instanceof Tn?fm(i,e):i instanceof Pn?mm(i,e):(function(o,r){let s=gm(o,r),d=$g(s)+$g(o.Ee);return qd(s)&&qd(o.Ee)?pm(d):Bc(o.serializer,d)})(i,e)}function Lw(i,e,t){return i instanceof Tn?fm(i,e):i instanceof Pn?mm(i,e):t}function gm(i,e){return i instanceof gi?(function(n){return qd(n)||(function(r){return!!r&&"doubleValue"in r})(n)})(e)?e:{integerValue:0}:null}var En=class extends pi{},Tn=class extends pi{constructor(e){super(),this.elements=e}};function fm(i,e){let t=vm(e);for(let n of i.elements)t.some(o=>wt(o,n))||t.push(n);return{arrayValue:{values:t}}}var Pn=class extends pi{constructor(e){super(),this.elements=e}};function mm(i,e){let t=vm(e);for(let n of i.elements)t=t.filter(o=>!wt(o,n));return{arrayValue:{values:t}}}var gi=class extends pi{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function $g(i){return ae(i.integerValue||i.doubleValue)}function vm(i){return Pc(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}var ol=class{constructor(e,t){this.field=e,this.transform=t}};function Fw(i,e){return i.field.isEqual(e.field)&&(function(n,o){return n instanceof Tn&&o instanceof Tn||n instanceof Pn&&o instanceof Pn?di(n.elements,o.elements,wt):n instanceof gi&&o instanceof gi?wt(n.Ee,o.Ee):n instanceof En&&o instanceof En})(i.transform,e.transform)}var rl=class{constructor(e,t){this.version=e,this.transformResults=t}},It=class i{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new i}static exists(e){return new i(void 0,e)}static updateTime(e){return new i(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function fa(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}var fi=class{};function bm(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new ko(i.key,It.none()):new In(i.key,i.data,It.none());{let t=i.data,n=Ge.empty(),o=new Ce(We.comparator);for(let r of e.fields)if(!o.has(r)){let s=t.field(r);s===null&&r.length>1&&(r=r.popLast(),s=t.field(r)),s===null?n.delete(r):n.set(r,s),o=o.add(r)}return new xt(i.key,n,new Xe(o.toArray()),It.none())}}function Rw(i,e,t){i instanceof In?(function(o,r,s){let d=o.value.clone(),c=tf(o.fieldTransforms,r,s.transformResults);d.setAll(c),r.convertToFoundDocument(s.version,d).setHasCommittedMutations()})(i,e,t):i instanceof xt?(function(o,r,s){if(!fa(o.precondition,r))return void r.convertToUnknownDocument(s.version);let d=tf(o.fieldTransforms,r,s.transformResults),c=r.data;c.setAll(wm(o)),c.setAll(d),r.convertToFoundDocument(s.version,c).setHasCommittedMutations()})(i,e,t):(function(o,r,s){r.convertToNoDocument(s.version).setHasCommittedMutations()})(0,e,t)}function _o(i,e,t,n){return i instanceof In?(function(r,s,d,c){if(!fa(r.precondition,s))return d;let u=r.value.clone(),p=nf(r.fieldTransforms,c,s);return u.setAll(p),s.convertToFoundDocument(s.version,u).setHasLocalMutations(),null})(i,e,t,n):i instanceof xt?(function(r,s,d,c){if(!fa(r.precondition,s))return d;let u=nf(r.fieldTransforms,c,s),p=s.data;return p.setAll(wm(r)),p.setAll(u),s.convertToFoundDocument(s.version,p).setHasLocalMutations(),d===null?null:d.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(f=>f.field))})(i,e,t,n):(function(r,s,d){return fa(r.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):d})(i,e,t)}function Nw(i,e){let t=null;for(let n of i.fieldTransforms){let o=e.data.field(n.field),r=gm(n.transform,o||null);r!=null&&(t===null&&(t=Ge.empty()),t.set(n.field,r))}return t||null}function ef(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!(function(n,o){return n===void 0&&o===void 0||!(!n||!o)&&di(n,o,(r,s)=>Fw(r,s))})(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}var In=class extends fi{constructor(e,t,n,o=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=o,this.type=0}getFieldMask(){return null}},xt=class extends fi{constructor(e,t,n,o,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=o,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}};function wm(i){let e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=i.data.field(t);e.set(t,n)}}),e}function tf(i,e,t){let n=new Map;ee(i.length===t.length,32656,{Ae:t.length,Re:i.length});for(let o=0;o<t.length;o++){let r=i[o],s=r.transform,d=e.data.field(r.field);n.set(r.field,Lw(s,d,t[o]))}return n}function nf(i,e,t){let n=new Map;for(let o of i){let r=o.transform,s=t.data.field(o.field);n.set(o.field,Mw(r,s,e))}return n}var ko=class extends fi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},al=class extends fi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var sl=class{constructor(e,t,n,o){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=o}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let o=0;o<this.mutations.length;o++){let r=this.mutations[o];r.key.isEqual(e.key)&&Rw(r,e,n[o])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=_o(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=_o(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=hm();return this.mutations.forEach(o=>{let r=e.get(o.key),s=r.overlayedDocument,d=this.applyToLocalView(s,r.mutatedFields);d=t.has(o.key)?null:d;let c=bm(s,d);c!==null&&n.set(o.key,c),s.isValidDocument()||s.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),q())}isEqual(e){return this.batchId===e.batchId&&di(this.mutations,e.mutations,(t,n)=>ef(t,n))&&di(this.baseMutations,e.baseMutations,(t,n)=>ef(t,n))}},dl=class i{constructor(e,t,n,o){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=o}static from(e,t,n){ee(e.mutations.length===n.length,58842,{Ve:e.mutations.length,me:n.length});let o=(function(){return Iw})(),r=e.mutations;for(let s=0;s<r.length;s++)o=o.insert(r[s].key,n[s].version);return new i(e,t,n,o)}};var ll=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var cl=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var fe,W;function Ow(i){switch(i){case P.OK:return O(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return O(15467,{code:i})}}function xm(i){if(i===void 0)return kt("GRPC error has no .code"),P.UNKNOWN;switch(i){case fe.OK:return P.OK;case fe.CANCELLED:return P.CANCELLED;case fe.UNKNOWN:return P.UNKNOWN;case fe.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case fe.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case fe.INTERNAL:return P.INTERNAL;case fe.UNAVAILABLE:return P.UNAVAILABLE;case fe.UNAUTHENTICATED:return P.UNAUTHENTICATED;case fe.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case fe.NOT_FOUND:return P.NOT_FOUND;case fe.ALREADY_EXISTS:return P.ALREADY_EXISTS;case fe.PERMISSION_DENIED:return P.PERMISSION_DENIED;case fe.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case fe.ABORTED:return P.ABORTED;case fe.OUT_OF_RANGE:return P.OUT_OF_RANGE;case fe.UNIMPLEMENTED:return P.UNIMPLEMENTED;case fe.DATA_LOSS:return P.DATA_LOSS;default:return O(39323,{code:i})}}(W=fe||(fe={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";var of=null;var zw=new Et([4294967295,4294967295],0);function rf(i){let e=kf().encode(i),t=new _d;return t.update(e),new Uint8Array(t.digest())}function af(i){let e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),o=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new Et([t,n],0),new Et([o,r],0)]}var ul=class i{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new xn(`Invalid padding: ${t}`);if(n<0)throw new xn(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new xn(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new xn(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=Et.fromNumber(this.fe)}pe(e,t,n){let o=e.add(t.multiply(Et.fromNumber(n)));return o.compare(zw)===1&&(o=new Et([o.getBits(0),o.getBits(1)],0)),o.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=rf(e),[n,o]=af(t);for(let r=0;r<this.hashCount;r++){let s=this.pe(n,o,r);if(!this.ye(s))return!1}return!0}static create(e,t,n){let o=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),s=new i(r,o,t);return n.forEach(d=>s.insert(d)),s}insert(e){if(this.fe===0)return;let t=rf(e),[n,o]=af(t);for(let r=0;r<this.hashCount;r++){let s=this.pe(n,o,r);this.we(s)}}we(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},xn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var _a=class i{constructor(e,t,n,o,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=o,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let o=new Map;return o.set(e,Do.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new i(U.min(),o,new he(Q),Mt(),q())}},Do=class i{constructor(e,t,n,o,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=o,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new i(n,t,q(),q(),q())}};var ri=class{constructor(e,t,n,o){this.Se=e,this.removedTargetIds=t,this.key=n,this.be=o}},Sa=class{constructor(e,t){this.targetId=e,this.De=t}},Ea=class{constructor(e,t,n=Be.EMPTY_BYTE_STRING,o=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=o}},Ta=class{constructor(){this.ve=0,this.Ce=sf(),this.Fe=Be.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=q(),t=q(),n=q();return this.Ce.forEach((o,r)=>{switch(r){case 0:e=e.add(o);break;case 2:t=t.add(o);break;case 1:n=n.add(o);break;default:O(38017,{changeType:r})}}),new Do(this.Fe,this.Me,e,t,n)}ke(){this.xe=!1,this.Ce=sf()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,ee(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},hl=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=Mt(),this.je=ua(),this.Je=ua(),this.He=new he(Q)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let n=this.tt(t);switch(e.state){case 0:this.nt(t)&&n.Be(e.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(e.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(n.Ke(),n.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),n.Be(e.resumeToken));break;default:O(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((n,o)=>{this.nt(o)&&t(o)})}it(e){let t=e.targetId,n=e.De.count,o=this.st(t);if(o){let r=o.target;if(tl(r))if(n===0){let s=new N(r.path);this.Xe(t,s,at.newNoDocument(s,U.min()))}else ee(n===1,20013,{expectedCount:n});else{let s=this.ot(t);if(s!==n){let d=this._t(e),c=d?this.ut(d,e,s):1;if(c!==0){this.rt(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,u)}of?.ct((function(p,f,v,_,T){var k,I,H,R,z,X;let ge={localCacheCount:p,existenceFilterCount:f.count,databaseId:v.database,projectId:v.projectId},Y=f.unchangedNames;return Y&&(ge.bloomFilter={applied:T===0,hashCount:(k=Y?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(R=(H=(I=Y?.bits)===null||I===void 0?void 0:I.bitmap)===null||H===void 0?void 0:H.length)!==null&&R!==void 0?R:0,padding:(X=(z=Y?.bits)===null||z===void 0?void 0:z.padding)!==null&&X!==void 0?X:0,mightContain:A=>{var m;return(m=_?.mightContain(A))!==null&&m!==void 0&&m}}),ge})(s,e.De,this.We.lt(),d,c))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:o=0},hashCount:r=0}=t,s,d;try{s=Bt(n).toUint8Array()}catch(c){if(c instanceof xa)return Jt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{d=new ul(s,o,r)}catch(c){return Jt(c instanceof xn?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return d.fe===0?null:d}ut(e,t,n){return t.De.count===n-this.ht(e,t.targetId)?0:2}ht(e,t){let n=this.We.getRemoteKeysForTarget(t),o=0;return n.forEach(r=>{let s=this.We.lt(),d=`projects/${s.projectId}/databases/${s.database}/documents/${r.path.canonicalString()}`;e.mightContain(d)||(this.Xe(t,r,null),o++)}),o}Pt(e){let t=new Map;this.Ge.forEach((r,s)=>{let d=this.st(s);if(d){if(r.current&&tl(d.target)){let c=new N(d.target.path);this.Tt(c).has(s)||this.It(s,c)||this.Xe(s,c,at.newNoDocument(c,e))}r.Ne&&(t.set(s,r.Le()),r.ke())}});let n=q();this.Je.forEach((r,s)=>{let d=!0;s.forEachWhile(c=>{let u=this.st(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)}),d&&(n=n.add(r))}),this.ze.forEach((r,s)=>s.setReadTime(e));let o=new _a(e,t,this.He,this.ze,n);return this.ze=Mt(),this.je=ua(),this.Je=ua(),this.He=new he(Q),o}Ze(e,t){if(!this.nt(e))return;let n=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,n),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,n){if(!this.nt(e))return;let o=this.tt(e);this.It(e,t)?o.qe(t,1):o.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),n&&(this.ze=this.ze.insert(t,n))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Ta,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new Ce(Q),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new Ce(Q),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||F("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Ta),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function ua(){return new he(N.comparator)}function sf(){return new he(N.comparator)}var Hw={asc:"ASCENDING",desc:"DESCENDING"},jw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Uw={and:"AND",or:"OR"},pl=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function gl(i,e){return i.useProto3Json||Ya(e)?e:{value:e}}function Pa(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Am(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function Qw(i,e){return Pa(i,e.toTimestamp())}function bt(i){return ee(!!i,49232),U.fromTimestamp((function(t){let n=Dt(t);return new we(n.seconds,n.nanos)})(i))}function Vc(i,e){return fl(i,e).canonicalString()}function fl(i,e){let t=(function(o){return new se(["projects",o.projectId,"databases",o.database])})(i).child("documents");return e===void 0?t:t.child(e)}function ym(i){let e=se.fromString(i);return ee(Tm(e),10190,{key:e.toString()}),e}function ml(i,e){return Vc(i.databaseId,e.path)}function kd(i,e){let t=ym(e);if(t.get(1)!==i.databaseId.projectId)throw new L(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new L(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new N(_m(t))}function Cm(i,e){return Vc(i.databaseId,e)}function qw(i){let e=ym(i);return e.length===4?se.emptyPath():_m(e)}function vl(i){return new se(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function _m(i){return ee(i.length>4&&i.get(4)==="documents",29091,{key:i.toString()}),i.popFirst(5)}function df(i,e,t){return{name:ml(i,e),fields:t.value.mapValue.fields}}function Gw(i,e){let t;if("targetChange"in e){e.targetChange;let n=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:O(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),o=e.targetChange.targetIds||[],r=(function(u,p){return u.useProto3Json?(ee(p===void 0||typeof p=="string",58123),Be.fromBase64String(p||"")):(ee(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Be.fromUint8Array(p||new Uint8Array))})(i,e.targetChange.resumeToken),s=e.targetChange.cause,d=s&&(function(u){let p=u.code===void 0?P.UNKNOWN:xm(u.code);return new L(p,u.message||"")})(s);t=new Ea(n,o,r,d||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let o=kd(i,n.document.name),r=bt(n.document.updateTime),s=n.document.createTime?bt(n.document.createTime):U.min(),d=new Ge({mapValue:{fields:n.document.fields}}),c=at.newFoundDocument(o,r,s,d),u=n.targetIds||[],p=n.removedTargetIds||[];t=new ri(u,p,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let o=kd(i,n.document),r=n.readTime?bt(n.readTime):U.min(),s=at.newNoDocument(o,r),d=n.removedTargetIds||[];t=new ri([],d,s.key,s)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let o=kd(i,n.document),r=n.removedTargetIds||[];t=new ri([],r,o,null)}else{if(!("filter"in e))return O(11601,{At:e});{e.filter;let n=e.filter;n.targetId;let{count:o=0,unchangedNames:r}=n,s=new cl(o,r),d=n.targetId;t=new Sa(d,s)}}return t}function Ww(i,e){let t;if(e instanceof In)t={update:df(i,e.key,e.value)};else if(e instanceof ko)t={delete:ml(i,e.key)};else if(e instanceof xt)t={update:df(i,e.key,e.data),updateMask:n1(e.fieldMask)};else{if(!(e instanceof al))return O(16599,{Rt:e.type});t={verify:ml(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>(function(r,s){let d=s.transform;if(d instanceof En)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Tn)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Pn)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof gi)return{fieldPath:s.field.canonicalString(),increment:d.Ee};throw O(20930,{transform:s.transform})})(0,n))),e.precondition.isNone||(t.currentDocument=(function(o,r){return r.updateTime!==void 0?{updateTime:Qw(o,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:O(27497)})(i,e.precondition)),t}function Zw(i,e){return i&&i.length>0?(ee(e!==void 0,14353),i.map(t=>(function(o,r){let s=o.updateTime?bt(o.updateTime):bt(r);return s.isEqual(U.min())&&(s=bt(r)),new rl(s,o.transformResults||[])})(t,e))):[]}function Kw(i,e){return{documents:[Cm(i,e.path)]}}function Yw(i,e){let t={structuredQuery:{}},n=e.path,o;e.collectionGroup!==null?(o=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(o=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Cm(i,o);let r=(function(u){if(u.length!==0)return Em(st.create(u,"and"))})(e.filters);r&&(t.structuredQuery.where=r);let s=(function(u){if(u.length!==0)return u.map(p=>(function(v){return{field:ni(v.field),direction:$w(v.dir)}})(p))})(e.orderBy);s&&(t.structuredQuery.orderBy=s);let d=gl(i,e.limit);return d!==null&&(t.structuredQuery.limit=d),e.startAt&&(t.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{Vt:t,parent:o}}function Jw(i){let e=qw(i.parent),t=i.structuredQuery,n=t.from?t.from.length:0,o=null;if(n>0){ee(n===1,65062);let p=t.from[0];p.allDescendants?o=p.collectionId:e=e.child(p.collectionId)}let r=[];t.where&&(r=(function(f){let v=Sm(f);return v instanceof st&&im(v)?v.getFilters():[v]})(t.where));let s=[];t.orderBy&&(s=(function(f){return f.map(v=>(function(T){return new Sn(ii(T.field),(function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(T.direction))})(v))})(t.orderBy));let d=null;t.limit&&(d=(function(f){let v;return v=typeof f=="object"?f.value:f,Ya(v)?null:v})(t.limit));let c=null;t.startAt&&(c=(function(f){let v=!!f.before,_=f.values||[];return new hi(_,v)})(t.startAt));let u=null;return t.endAt&&(u=(function(f){let v=!f.before,_=f.values||[];return new hi(_,v)})(t.endAt)),_w(e,o,s,r,d,"F",c,u)}function Xw(i,e){let t=(function(o){switch(o){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O(28987,{purpose:o})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Sm(i){return i.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=ii(t.unaryFilter.field);return ve.create(n,"==",{doubleValue:NaN});case"IS_NULL":let o=ii(t.unaryFilter.field);return ve.create(o,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=ii(t.unaryFilter.field);return ve.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let s=ii(t.unaryFilter.field);return ve.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return O(61313);default:return O(60726)}})(i):i.fieldFilter!==void 0?(function(t){return ve.create(ii(t.fieldFilter.field),(function(o){switch(o){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return O(58110);default:return O(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(i):i.compositeFilter!==void 0?(function(t){return st.create(t.compositeFilter.filters.map(n=>Sm(n)),(function(o){switch(o){case"AND":return"and";case"OR":return"or";default:return O(1026)}})(t.compositeFilter.op))})(i):O(30097,{filter:i})}function $w(i){return Hw[i]}function e1(i){return jw[i]}function t1(i){return Uw[i]}function ni(i){return{fieldPath:i.canonicalString()}}function ii(i){return We.fromServerFormat(i.fieldPath)}function Em(i){return i instanceof ve?(function(t){if(t.op==="=="){if(Zg(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NAN"}};if(Wg(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Zg(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NAN"}};if(Wg(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ni(t.field),op:e1(t.op),value:t.value}}})(i):i instanceof st?(function(t){let n=t.getFilters().map(o=>Em(o));return n.length===1?n[0]:{compositeFilter:{op:t1(t.op),filters:n}}})(i):O(54877,{filter:i})}function n1(i){let e=[];return i.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Tm(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}var Bo=class i{constructor(e,t,n,o,r=U.min(),s=U.min(),d=Be.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=o,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=d,this.expectedCount=c}withSequenceNumber(e){return new i(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var bl=class{constructor(e){this.gt=e}};function i1(i){let e=Jw({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?il(e,e.limit,"L"):e}var Ia=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(ae(e.integerValue));else if("doubleValue"in e){let n=ae(e.doubleValue);isNaN(n)?this.Ct(t,13):(this.Ct(t,15),To(n)?t.Ft(0):t.Ft(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ct(t,20),typeof n=="string"&&(n=Dt(n)),t.Mt(`${n.seconds||""}`),t.Ft(n.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Bt(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ct(t,45),t.Ft(n.latitude||0),t.Ft(n.longitude||0)}else"mapValue"in e?em(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):$f(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):O(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let n=e.fields||{};this.Ct(t,55);for(let o of Object.keys(n))this.xt(o,t),this.Dt(n[o],t)}Lt(e,t){var n,o;let r=e.fields||{};this.Ct(t,53);let s=li,d=((o=(n=r[s].arrayValue)===null||n===void 0?void 0:n.values)===null||o===void 0?void 0:o.length)||0;this.Ct(t,15),t.Ft(ae(d)),this.xt(s,t),this.Dt(r[s],t)}qt(e,t){let n=e.values||[];this.Ct(t,50);for(let o of n)this.Dt(o,t)}Bt(e,t){this.Ct(t,37),N.fromName(e).path.forEach(n=>{this.Ct(t,60),this.$t(n,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};Ia.Ut=new Ia;var wl=class{constructor(){this.Dn=new xl}addToCollectionParentIndex(e,t){return this.Dn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(_n.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(_n.min())}updateCollectionGroup(e,t,n){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}},xl=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),o=this.index[t]||new Ce(se.comparator),r=!o.has(n);return this.index[t]=o.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),o=this.index[t];return o&&o.has(n)}getEntries(e){return(this.index[e]||new Ce(se.comparator)).toArray()}};var B2=new Uint8Array(0);var lf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pm=41943040,Je=class i{static withCacheSize(e){return new i(e,i.DEFAULT_COLLECTION_PERCENTILE,i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}};Je.DEFAULT_COLLECTION_PERCENTILE=10,Je.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Je.DEFAULT=new Je(Pm,Je.DEFAULT_COLLECTION_PERCENTILE,Je.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Je.DISABLED=new Je(-1,0,0);var Vo=class i{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new i(0)}static ur(){return new i(-1)}};var cf="LruGarbageCollector",o1=1048576;function uf([i,e],[t,n]){let o=Q(i,t);return o===0?Q(e,n):o}var Al=class{constructor(e){this.Tr=e,this.buffer=new Ce(uf),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();uf(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},yl=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){F(cf,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>B(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){yi(t)?F(cf,"Ignoring IndexedDB error during garbage collection: ",t):yield Ai(t)}yield this.Rr(3e5)}))}},Cl=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return D.resolve(Cc.ue);let n=new Al(t);return this.Vr.forEachTarget(e,o=>n.Er(o.sequenceNumber)).next(()=>this.Vr.gr(e,o=>n.Er(o))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(F("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(lf)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(F("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lf):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let n,o,r,s,d,c,u,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(F("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),o=this.params.maximumSequenceNumbersToCollect):o=f,s=Date.now(),this.nthSequenceNumber(e,o))).next(f=>(n=f,d=Date.now(),this.removeTargets(e,n,t))).next(f=>(r=f,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(f=>(u=Date.now(),ei()<=Ye.DEBUG&&F("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-p}ms
	Determined least recently used ${o} in `+(d-s)+`ms
	Removed ${r} targets in `+(c-d)+`ms
	Removed ${f} documents in `+(u-c)+`ms
Total Duration: ${u-p}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:o,targetsRemoved:r,documentsRemoved:f})))}};function r1(i,e){return new Cl(i,e)}var _l=class{constructor(){this.changes=new Vt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,at.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?D.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Sl=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var El=class{constructor(e,t,n,o){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=o}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(o=>(n=o,this.remoteDocumentCache.getEntry(e,t))).next(o=>(n!==null&&_o(n.mutation,o,Xe.empty(),we.now()),o))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,q()).next(()=>n))}getLocalViewOfDocuments(e,t,n=q()){let o=wn();return this.populateOverlays(e,o,t).next(()=>this.computeViews(e,t,o,n).next(r=>{let s=xo();return r.forEach((d,c)=>{s=s.insert(d,c.overlayedDocument)}),s}))}getOverlayedDocuments(e,t){let n=wn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,q()))}populateOverlays(e,t,n){let o=[];return n.forEach(r=>{t.has(r)||o.push(r)}),this.documentOverlayCache.getOverlays(e,o).next(r=>{r.forEach((s,d)=>{t.set(s,d)})})}computeViews(e,t,n,o){let r=Mt(),s=Co(),d=(function(){return Co()})();return t.forEach((c,u)=>{let p=n.get(u.key);o.has(u.key)&&(p===void 0||p.mutation instanceof xt)?r=r.insert(u.key,u):p!==void 0?(s.set(u.key,p.mutation.getFieldMask()),_o(p.mutation,u,p.mutation.getFieldMask(),we.now())):s.set(u.key,Xe.empty())}),this.recalculateAndSaveOverlays(e,r).next(c=>(c.forEach((u,p)=>s.set(u,p)),t.forEach((u,p)=>{var f;return d.set(u,new Sl(p,(f=s.get(u))!==null&&f!==void 0?f:null))}),d))}recalculateAndSaveOverlays(e,t){let n=Co(),o=new he((s,d)=>s-d),r=q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(s=>{for(let d of s)d.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let p=n.get(c)||Xe.empty();p=d.applyToLocalView(u,p),n.set(c,p);let f=(o.get(d.batchId)||q()).add(c);o=o.insert(d.batchId,f)})}).next(()=>{let s=[],d=o.getReverseIterator();for(;d.hasNext();){let c=d.getNext(),u=c.key,p=c.value,f=hm();p.forEach(v=>{if(!r.has(v)){let _=bm(t.get(v),n.get(v));_!==null&&f.set(v,_),r=r.add(v)}}),s.push(this.documentOverlayCache.saveOverlays(e,u,f))}return D.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,o){return(function(s){return N.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):sm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,o):this.getDocumentsMatchingCollectionQuery(e,t,n,o)}getNextDocuments(e,t,n,o){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,o).next(r=>{let s=o-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,o-r.size):D.resolve(wn()),d=Eo,c=r;return s.next(u=>D.forEach(u,(p,f)=>(d<f.largestBatchId&&(d=f.largestBatchId),r.get(p)?D.resolve():this.remoteDocumentCache.getEntry(e,p).next(v=>{c=c.insert(p,v)}))).next(()=>this.populateOverlays(e,u,r)).next(()=>this.computeViews(e,c,u,q())).next(p=>({batchId:d,changes:um(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new N(t)).next(n=>{let o=xo();return n.isFoundDocument()&&(o=o.insert(n.key,n)),o})}getDocumentsMatchingCollectionGroupQuery(e,t,n,o){let r=t.collectionGroup,s=xo();return this.indexManager.getCollectionParents(e,r).next(d=>D.forEach(d,c=>{let u=(function(f,v){return new $t(v,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)})(t,c.child(r));return this.getDocumentsMatchingCollectionQuery(e,u,n,o).next(p=>{p.forEach((f,v)=>{s=s.insert(f,v)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,o){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,o))).next(s=>{r.forEach((c,u)=>{let p=u.getKey();s.get(p)===null&&(s=s.insert(p,at.newInvalidDocument(p)))});let d=xo();return s.forEach((c,u)=>{let p=r.get(c);p!==void 0&&_o(p.mutation,u,Xe.empty(),we.now()),$a(t,u)&&(d=d.insert(c,u))}),d})}};var Tl=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return D.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(o){return{id:o.id,version:o.version,createTime:bt(o.createTime)}})(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(o){return{name:o.name,query:i1(o.bundledQuery),readTime:bt(o.readTime)}})(t)),D.resolve()}};var Pl=class{constructor(){this.overlays=new he(N.comparator),this.kr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){let n=wn();return D.forEach(t,o=>this.getOverlay(e,o).next(r=>{r!==null&&n.set(o,r)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((o,r)=>{this.wt(e,t,r)}),D.resolve()}removeOverlaysForBatchId(e,t,n){let o=this.kr.get(n);return o!==void 0&&(o.forEach(r=>this.overlays=this.overlays.remove(r)),this.kr.delete(n)),D.resolve()}getOverlaysForCollection(e,t,n){let o=wn(),r=t.length+1,s=new N(t.child("")),d=this.overlays.getIteratorFrom(s);for(;d.hasNext();){let c=d.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===r&&c.largestBatchId>n&&o.set(c.getKey(),c)}return D.resolve(o)}getOverlaysForCollectionGroup(e,t,n,o){let r=new he((u,p)=>u-p),s=this.overlays.getIterator();for(;s.hasNext();){let u=s.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){let p=r.get(u.largestBatchId);p===null&&(p=wn(),r=r.insert(u.largestBatchId,p)),p.set(u.getKey(),u)}}let d=wn(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,p)=>d.set(u,p)),!(d.size()>=o)););return D.resolve(d)}wt(e,t,n){let o=this.overlays.get(n.key);if(o!==null){let s=this.kr.get(o.largestBatchId).delete(n.key);this.kr.set(o.largestBatchId,s)}this.overlays=this.overlays.insert(n.key,new ll(t,n));let r=this.kr.get(t);r===void 0&&(r=q(),this.kr.set(t,r)),this.kr.set(t,r.add(n.key))}};var Il=class{constructor(){this.sessionToken=Be.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}};var Mo=class{constructor(){this.qr=new Ce(me.Qr),this.$r=new Ce(me.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let n=new me(e,t);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Wr(new me(e,t))}Gr(e,t){e.forEach(n=>this.removeReference(n,t))}zr(e){let t=new N(new se([])),n=new me(t,e),o=new me(t,e+1),r=[];return this.$r.forEachInRange([n,o],s=>{this.Wr(s),r.push(s.key)}),r}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new N(new se([])),n=new me(t,e),o=new me(t,e+1),r=q();return this.$r.forEachInRange([n,o],s=>{r=r.add(s.key)}),r}containsKey(e){let t=new me(e,0),n=this.qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},me=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return N.comparator(e.key,t.key)||Q(e.Hr,t.Hr)}static Ur(e,t){return Q(e.Hr,t.Hr)||N.comparator(e.key,t.key)}};var kl=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new Ce(me.Qr)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,o){let r=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new sl(r,t,n,o);this.mutationQueue.push(s);for(let d of o)this.Yr=this.Yr.add(new me(d.key,r)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return D.resolve(s)}lookupMutationBatch(e,t){return D.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,o=this.Xr(n),r=o<0?0:o;return D.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?_c:this.er-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new me(t,0),o=new me(t,Number.POSITIVE_INFINITY),r=[];return this.Yr.forEachInRange([n,o],s=>{let d=this.Zr(s.Hr);r.push(d)}),D.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ce(Q);return t.forEach(o=>{let r=new me(o,0),s=new me(o,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([r,s],d=>{n=n.add(d.Hr)})}),D.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,o=n.length+1,r=n;N.isDocumentKey(r)||(r=r.child(""));let s=new me(new N(r),0),d=new Ce(Q);return this.Yr.forEachWhile(c=>{let u=c.key.path;return!!n.isPrefixOf(u)&&(u.length===o&&(d=d.add(c.Hr)),!0)},s),D.resolve(this.ei(d))}ei(e){let t=[];return e.forEach(n=>{let o=this.Zr(n);o!==null&&t.push(o)}),t}removeMutationBatch(e,t){ee(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Yr;return D.forEach(t.mutations,o=>{let r=new me(o.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,o.key)}).next(()=>{this.Yr=n})}rr(e){}containsKey(e,t){let n=new me(t,0),o=this.Yr.firstAfterOrEqual(n);return D.resolve(t.isEqual(o&&o.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Dl=class{constructor(e){this.ni=e,this.docs=(function(){return new he(N.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,o=this.docs.get(n),r=o?o.size:0,s=this.ni(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return D.resolve(n?n.document.mutableCopy():at.newInvalidDocument(t))}getEntries(e,t){let n=Mt();return t.forEach(o=>{let r=this.docs.get(o);n=n.insert(o,r?r.document.mutableCopy():at.newInvalidDocument(o))}),D.resolve(n)}getDocumentsMatchingQuery(e,t,n,o){let r=Mt(),s=t.path,d=new N(s.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(d);for(;c.hasNext();){let{key:u,value:{document:p}}=c.getNext();if(!s.isPrefixOf(u.path))break;u.path.length>s.length+1||rw(ow(p),n)<=0||(o.has(p.key)||$a(t,p))&&(r=r.insert(p.key,p.mutableCopy()))}return D.resolve(r)}getAllFromCollectionGroup(e,t,n,o){O(9500)}ri(e,t){return D.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Bl(this)}getSize(e){return D.resolve(this.size)}},Bl=class extends _l{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((n,o)=>{o.isValidDocument()?t.push(this.Or.addEntry(e,o)):this.Or.removeEntry(n)}),D.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var Vl=class{constructor(e){this.persistence=e,this.ii=new Vt(t=>Ic(t),kc),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.si=0,this.oi=new Mo,this.targetCount=0,this._i=Vo.ar()}forEachTarget(e,t){return this.ii.forEach((n,o)=>t(o)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.si&&(this.si=t),D.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new Vo(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.hr(t),D.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,n){let o=0,r=[];return this.ii.forEach((s,d)=>{d.sequenceNumber<=t&&n.get(d.targetId)===null&&(this.ii.delete(s),r.push(this.removeMatchingKeysForTargetId(e,d.targetId)),o++)}),D.waitFor(r).next(()=>o)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){let n=this.ii.get(t)||null;return D.resolve(n)}addMatchingKeys(e,t,n){return this.oi.Kr(t,n),D.resolve()}removeMatchingKeys(e,t,n){this.oi.Gr(t,n);let o=this.persistence.referenceDelegate,r=[];return o&&t.forEach(s=>{r.push(o.markPotentiallyOrphaned(e,s))}),D.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),D.resolve()}getMatchingKeysForTargetId(e,t){let n=this.oi.Jr(t);return D.resolve(n)}containsKey(e,t){return D.resolve(this.oi.containsKey(t))}};var ka=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new Cc(0),this.ci=!1,this.ci=!0,this.li=new Il,this.referenceDelegate=e(this),this.hi=new Vl(this),this.indexManager=new wl,this.remoteDocumentCache=(function(o){return new Dl(o)})(n=>this.referenceDelegate.Pi(n)),this.serializer=new bl(t),this.Ti=new Tl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Pl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ai[e.toKey()];return n||(n=new kl(t,this.referenceDelegate),this.ai[e.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,n){F("MemoryPersistence","Starting transaction:",e);let o=new Ml(this.ui.next());return this.referenceDelegate.Ii(),n(o).next(r=>this.referenceDelegate.di(o).next(()=>r)).toPromise().then(r=>(o.raiseOnCommittedEvent(),r))}Ei(e,t){return D.or(Object.values(this.ai).map(n=>()=>n.containsKey(e,t)))}},Ml=class extends jd{constructor(e){super(),this.currentSequenceNumber=e}},Ll=class i{constructor(e){this.persistence=e,this.Ai=new Mo,this.Ri=null}static Vi(e){return new i(e)}get mi(){if(this.Ri)return this.Ri;throw O(60996)}addReference(e,t,n){return this.Ai.addReference(n,t),this.mi.delete(n.toString()),D.resolve()}removeReference(e,t,n){return this.Ai.removeReference(n,t),this.mi.add(n.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(o=>this.mi.add(o.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(o=>{o.forEach(r=>this.mi.add(r.toString()))}).next(()=>n.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.mi,n=>{let o=N.fromPath(n);return this.fi(e,o).next(r=>{r||t.removeEntry(o,U.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(n=>{n?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return D.or([()=>D.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},Da=class i{constructor(e,t){this.persistence=e,this.gi=new Vt(n=>lw(n.path),(n,o)=>n.isEqual(o)),this.garbageCollector=r1(this,t)}static Vi(e,t){return new i(e,t)}Ii(){}di(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(o=>n+o))}yr(e){let t=0;return this.gr(e,n=>{t++}).next(()=>t)}gr(e,t){return D.forEach(this.gi,(n,o)=>this.Sr(e,n,o).next(r=>r?D.resolve():t(o)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,o=this.persistence.getRemoteDocumentCache(),r=o.newChangeBuffer();return o.ri(e,s=>this.Sr(e,s,t).next(d=>{d||(n++,r.removeEntry(s,U.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),D.resolve()}removeReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),D.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=pa(e.data.value)),t}Sr(e,t,n){return D.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let o=this.gi.get(t);return D.resolve(o!==void 0&&o>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Fl=class i{constructor(e,t,n,o){this.targetId=e,this.fromCache=t,this.Is=n,this.ds=o}static Es(e,t){let n=q(),o=q();for(let r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:o=o.add(r.doc.key)}return new i(e,t.fromCache,n,o)}};var Rl=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Nl=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return rg()?8:sw(ig())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,n,o){let r={result:null};return this.ps(e,t).next(s=>{r.result=s}).next(()=>{if(!r.result)return this.ys(e,t,o,n).next(s=>{r.result=s})}).next(()=>{if(r.result)return;let s=new Rl;return this.ws(e,t,s).next(d=>{if(r.result=d,this.Rs)return this.Ss(e,t,s,d.size)})}).next(()=>r.result)}Ss(e,t,n,o){return n.documentReadCount<this.Vs?(ei()<=Ye.DEBUG&&F("QueryEngine","SDK will not create cache indexes for query:",ti(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),D.resolve()):(ei()<=Ye.DEBUG&&F("QueryEngine","Query:",ti(t),"scans",n.documentReadCount,"local documents and returns",o,"documents as results."),n.documentReadCount>this.fs*o?(ei()<=Ye.DEBUG&&F("QueryEngine","The SDK decides to create cache indexes for query:",ti(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,vt(t))):D.resolve())}ps(e,t){if(Xg(t))return D.resolve(null);let n=vt(t);return this.indexManager.getIndexType(e,n).next(o=>o===0?null:(t.limit!==null&&o===1&&(t=il(t,null,"F"),n=vt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let s=q(...r);return this.gs.getDocuments(e,s).next(d=>this.indexManager.getMinOffset(e,n).next(c=>{let u=this.bs(t,d);return this.Ds(t,u,s,c.readTime)?this.ps(e,il(t,null,"F")):this.vs(e,u,t,c)}))})))}ys(e,t,n,o){return Xg(t)||o.isEqual(U.min())?D.resolve(null):this.gs.getDocuments(e,n).next(r=>{let s=this.bs(t,r);return this.Ds(t,s,n,o)?D.resolve(null):(ei()<=Ye.DEBUG&&F("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),ti(t)),this.vs(e,s,t,iw(o,Eo)).next(d=>d))})}bs(e,t){let n=new Ce(lm(e));return t.forEach((o,r)=>{$a(e,r)&&(n=n.add(r))}),n}Ds(e,t,n,o){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(o)>0)}ws(e,t,n){return ei()<=Ye.DEBUG&&F("QueryEngine","Using full collection scan to execute query:",ti(t)),this.gs.getDocumentsMatchingQuery(e,t,_n.min(),n)}vs(e,t,n,o){return this.gs.getDocumentsMatchingQuery(e,n,o).next(r=>(t.forEach(s=>{r=r.insert(s.key,s)}),r))}};var Mc="LocalStore",a1=3e8,Ol=class{constructor(e,t,n,o){this.persistence=e,this.Cs=t,this.serializer=o,this.Fs=new he(Q),this.Ms=new Vt(r=>Ic(r),kc),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(n)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new El(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function s1(i,e,t,n){return new Ol(i,e,t,n)}function Im(i,e){return B(this,null,function*(){let t=j(i);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let o;return t.mutationQueue.getAllMutationBatches(n).next(r=>(o=r,t.Ns(e),t.mutationQueue.getAllMutationBatches(n))).next(r=>{let s=[],d=[],c=q();for(let u of o){s.push(u.batchId);for(let p of u.mutations)c=c.add(p.key)}for(let u of r){d.push(u.batchId);for(let p of u.mutations)c=c.add(p.key)}return t.localDocuments.getDocuments(n,c).next(u=>({Bs:u,removedBatchIds:s,addedBatchIds:d}))})})})}function d1(i,e){let t=j(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let o=e.batch.keys(),r=t.Os.newChangeBuffer({trackRemovals:!0});return(function(d,c,u,p){let f=u.batch,v=f.keys(),_=D.resolve();return v.forEach(T=>{_=_.next(()=>p.getEntry(c,T)).next(k=>{let I=u.docVersions.get(T);ee(I!==null,48541),k.version.compareTo(I)<0&&(f.applyToRemoteDocument(k,u),k.isValidDocument()&&(k.setReadTime(u.commitVersion),p.addEntry(k)))})}),_.next(()=>d.mutationQueue.removeMutationBatch(c,f))})(t,n,e,r).next(()=>r.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,o,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(d){let c=q();for(let u=0;u<d.mutationResults.length;++u)d.mutationResults[u].transformResults.length>0&&(c=c.add(d.batch.mutations[u].key));return c})(e))).next(()=>t.localDocuments.getDocuments(n,o))})}function km(i){let e=j(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function l1(i,e){let t=j(i),n=e.snapshotVersion,o=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{let s=t.Os.newChangeBuffer({trackRemovals:!0});o=t.Fs;let d=[];e.targetChanges.forEach((p,f)=>{let v=o.get(f);if(!v)return;d.push(t.hi.removeMatchingKeys(r,p.removedDocuments,f).next(()=>t.hi.addMatchingKeys(r,p.addedDocuments,f)));let _=v.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(Be.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,n)),o=o.insert(f,_),(function(k,I,H){return k.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=a1?!0:H.addedDocuments.size+H.modifiedDocuments.size+H.removedDocuments.size>0})(v,_,p)&&d.push(t.hi.updateTargetData(r,_))});let c=Mt(),u=q();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(r,p))}),d.push(c1(r,s,e.documentUpdates).next(p=>{c=p.Ls,u=p.ks})),!n.isEqual(U.min())){let p=t.hi.getLastRemoteSnapshotVersion(r).next(f=>t.hi.setTargetsMetadata(r,r.currentSequenceNumber,n));d.push(p)}return D.waitFor(d).next(()=>s.apply(r)).next(()=>t.localDocuments.getLocalViewOfDocuments(r,c,u)).next(()=>c)}).then(r=>(t.Fs=o,r))}function c1(i,e,t){let n=q(),o=q();return t.forEach(r=>n=n.add(r)),e.getEntries(i,n).next(r=>{let s=Mt();return t.forEach((d,c)=>{let u=r.get(d);c.isFoundDocument()!==u.isFoundDocument()&&(o=o.add(d)),c.isNoDocument()&&c.version.isEqual(U.min())?(e.removeEntry(d,c.readTime),s=s.insert(d,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),s=s.insert(d,c)):F(Mc,"Ignoring outdated watch update for ",d,". Current version:",u.version," Watch version:",c.version)}),{Ls:s,ks:o}})}function u1(i,e){let t=j(i);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=_c),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function h1(i,e){let t=j(i);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let o;return t.hi.getTargetData(n,e).next(r=>r?(o=r,D.resolve(o)):t.hi.allocateTargetId(n).next(s=>(o=new Bo(e,s,"TargetPurposeListen",n.currentSequenceNumber),t.hi.addTargetData(n,o).next(()=>o))))}).then(n=>{let o=t.Fs.get(n.targetId);return(o===null||n.snapshotVersion.compareTo(o.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(n.targetId,n),t.Ms.set(e,n.targetId)),n})}function zl(i,e,t){return B(this,null,function*(){let n=j(i),o=n.Fs.get(e),r=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",r,s=>n.persistence.referenceDelegate.removeTarget(s,o)))}catch(s){if(!yi(s))throw s;F(Mc,`Failed to update sequence numbers for target ${e}: ${s}`)}n.Fs=n.Fs.remove(e),n.Ms.delete(o.target)})}function hf(i,e,t){let n=j(i),o=U.min(),r=q();return n.persistence.runTransaction("Execute query","readwrite",s=>(function(c,u,p){let f=j(c),v=f.Ms.get(p);return v!==void 0?D.resolve(f.Fs.get(v)):f.hi.getTargetData(u,p)})(n,s,vt(e)).next(d=>{if(d)return o=d.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(s,d.targetId).next(c=>{r=c})}).next(()=>n.Cs.getDocumentsMatchingQuery(s,e,t?o:U.min(),t?r:q())).next(d=>(p1(n,Ew(e),d),{documents:d,qs:r})))}function p1(i,e,t){let n=i.xs.get(e)||U.min();t.forEach((o,r)=>{r.readTime.compareTo(n)>0&&(n=r.readTime)}),i.xs.set(e,n)}var Ba=class{constructor(){this.activeTargetIds=Bw()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Hl=class{constructor(){this.Fo=new Ba,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,n){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Ba,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var jl=class{xo(e){}shutdown(){}};var pf="ConnectivityMonitor",Va=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){F(pf,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){F(pf,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ha=null;function Ul(){return ha===null?ha=(function(){return 268435456+Math.round(2147483648*Math.random())})():ha++,"0x"+ha.toString(16)}var Dd="RestConnection",g1={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Ql=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${n}/databases/${o}`,this.Ko=this.databaseId.database===Aa?`project_id=${n}`:`project_id=${n}&database_id=${o}`}Wo(e,t,n,o,r){let s=Ul(),d=this.Go(e,t.toUriEncodedString());F(Dd,`Sending RPC '${e}' ${s}:`,d,n);let c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(c,o,r);let{host:u}=new URL(d),p=Xn(u);return this.jo(e,d,c,n,p).then(f=>(F(Dd,`Received RPC '${e}' ${s}: `,f),f),f=>{throw Jt(Dd,`RPC '${e}' ${s} failed with error: `,f,"url: ",d,"request:",n),f})}Jo(e,t,n,o,r,s){return this.Wo(e,t,n,o,r)}zo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+xi})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((o,r)=>e[r]=o),n&&n.headers.forEach((o,r)=>e[r]=o)}Go(e,t){let n=g1[e];return`${this.$o}/v1/${t}:${n}`}terminate(){}};var ql=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var De="WebChannelConnection",Gl=class extends Ql{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,n,o,r){let s=Ul();return new Promise((d,c)=>{let u=new Sd;u.setWithCredentials(!0),u.listenOnce(Ed.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case wo.NO_ERROR:let f=u.getResponseJson();F(De,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),d(f);break;case wo.TIMEOUT:F(De,`RPC '${e}' ${s} timed out`),c(new L(P.DEADLINE_EXCEEDED,"Request time out"));break;case wo.HTTP_ERROR:let v=u.getStatus();if(F(De,`RPC '${e}' ${s} failed with status:`,v,"response text:",u.getResponseText()),v>0){let _=u.getResponseJson();Array.isArray(_)&&(_=_[0]);let T=_?.error;if(T&&T.status&&T.message){let k=(function(H){let R=H.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(R)>=0?R:P.UNKNOWN})(T.status);c(new L(k,T.message))}else c(new L(P.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new L(P.UNAVAILABLE,"Connection failed."));break;default:O(9055,{c_:e,streamId:s,l_:u.getLastErrorCode(),h_:u.getLastError()})}}finally{F(De,`RPC '${e}' ${s} completed.`)}});let p=JSON.stringify(o);F(De,`RPC '${e}' ${s} sending request:`,o),u.send(t,"POST",p,n,15)})}P_(e,t,n){let o=Ul(),r=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Id(),d=Pd(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.zo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let p=r.join("");F(De,`Creating RPC '${e}' stream ${o}: ${p}`,c);let f=s.createWebChannel(p,c);this.T_(f);let v=!1,_=!1,T=new ql({Ho:I=>{_?F(De,`Not sending because RPC '${e}' stream ${o} is closed:`,I):(v||(F(De,`Opening RPC '${e}' stream ${o} transport.`),f.open(),v=!0),F(De,`RPC '${e}' stream ${o} sending:`,I),f.send(I))},Yo:()=>f.close()}),k=(I,H,R)=>{I.listen(H,z=>{try{R(z)}catch(X){setTimeout(()=>{throw X},0)}})};return k(f,$n.EventType.OPEN,()=>{_||(F(De,`RPC '${e}' stream ${o} transport opened.`),T.s_())}),k(f,$n.EventType.CLOSE,()=>{_||(_=!0,F(De,`RPC '${e}' stream ${o} transport closed`),T.__(),this.I_(f))}),k(f,$n.EventType.ERROR,I=>{_||(_=!0,Jt(De,`RPC '${e}' stream ${o} transport errored. Name:`,I.name,"Message:",I.message),T.__(new L(P.UNAVAILABLE,"The operation could not be completed")))}),k(f,$n.EventType.MESSAGE,I=>{var H;if(!_){let R=I.data[0];ee(!!R,16349);let z=R,X=z?.error||((H=z[0])===null||H===void 0?void 0:H.error);if(X){F(De,`RPC '${e}' stream ${o} received error:`,X);let ge=X.status,Y=(function(b){let x=fe[b];if(x!==void 0)return xm(x)})(ge),A=X.message;Y===void 0&&(Y=P.INTERNAL,A="Unknown error status: "+ge+" with message "+X.message),_=!0,T.__(new L(Y,A)),f.close()}else F(De,`RPC '${e}' stream ${o} received:`,R),T.a_(R)}}),k(d,Td.STAT_EVENT,I=>{I.stat===la.PROXY?F(De,`RPC '${e}' stream ${o} detected buffering proxy`):I.stat===la.NOPROXY&&F(De,`RPC '${e}' stream ${o} detected no buffering proxy`)}),setTimeout(()=>{T.o_()},0),T}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function Bd(){return typeof document<"u"?document:null}function es(i){return new pl(i,!0)}var Ma=class{constructor(e,t,n=1e3,o=1.5,r=6e4){this.Fi=e,this.timerId=t,this.d_=n,this.E_=o,this.A_=r,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),o=Math.max(0,t-n);o>0&&F("ExponentialBackoff",`Backing off for ${o} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,o,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var gf="PersistentStream",La=class{constructor(e,t,n,o,r,s,d,c){this.Fi=e,this.w_=n,this.S_=o,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=d,this.listener=c,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Ma(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return B(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return B(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return B(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(kt(t.toString()),kt("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,o])=>{this.b_===t&&this.W_(n,o)},n=>{e(()=>{let o=new L(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.G_(o)})})}W_(e,t){let n=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(o=>{n(()=>this.G_(o))}),this.stream.onMessage(o=>{n(()=>++this.C_==1?this.j_(o):this.onNext(o))})}O_(){this.state=5,this.F_.g_(()=>B(this,null,function*(){this.state=0,this.start()}))}G_(e){return F(gf,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(F(gf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Wl=class extends La{constructor(e,t,n,o,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,o,s),this.serializer=r}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=Gw(this.serializer,e),n=(function(r){if(!("targetChange"in r))return U.min();let s=r.targetChange;return s.targetIds&&s.targetIds.length?U.min():s.readTime?bt(s.readTime):U.min()})(e);return this.listener.J_(t,n)}H_(e){let t={};t.database=vl(this.serializer),t.addTarget=(function(r,s){let d,c=s.target;if(d=tl(c)?{documents:Kw(r,c)}:{query:Yw(r,c).Vt},d.targetId=s.targetId,s.resumeToken.approximateByteSize()>0){d.resumeToken=Am(r,s.resumeToken);let u=gl(r,s.expectedCount);u!==null&&(d.expectedCount=u)}else if(s.snapshotVersion.compareTo(U.min())>0){d.readTime=Pa(r,s.snapshotVersion.toTimestamp());let u=gl(r,s.expectedCount);u!==null&&(d.expectedCount=u)}return d})(this.serializer,e);let n=Xw(this.serializer,e);n&&(t.labels=n),this.k_(t)}Y_(e){let t={};t.database=vl(this.serializer),t.removeTarget=e,this.k_(t)}},Zl=class extends La{constructor(e,t,n,o,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,o,s),this.serializer=r}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return ee(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ee(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){ee(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=Zw(e.writeResults,e.commitTime),n=bt(e.commitTime);return this.listener.ta(n,t)}na(){let e={};e.database=vl(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>Ww(this.serializer,n))};this.k_(t)}};var Kl=class{},Yl=class extends Kl{constructor(e,t,n,o){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=o,this.ra=!1}ia(){if(this.ra)throw new L(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,o){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.Wo(e,fl(t,n),o,r,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new L(P.UNKNOWN,r.toString())})}Jo(e,t,n,o,r){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,d])=>this.connection.Jo(e,fl(t,n),o,s,d,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new L(P.UNKNOWN,s.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Jl=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(kt(t),this._a=!1):F("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var kn="RemoteStore",Xl=class{constructor(e,t,n,o,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=r,this.Ea.xo(s=>{n.enqueueAndForget(()=>B(this,null,function*(){Bn(this)&&(F(kn,"Restarting streams for network reachability change."),yield(function(c){return B(this,null,function*(){let u=j(c);u.Ia.add(4),yield Ro(u),u.Aa.set("Unknown"),u.Ia.delete(4),yield ts(u)})})(this))}))}),this.Aa=new Jl(n,o)}};function ts(i){return B(this,null,function*(){if(Bn(i))for(let e of i.da)yield e(!0)})}function Ro(i){return B(this,null,function*(){for(let e of i.da)yield e(!1)})}function Dm(i,e){let t=j(i);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),Nc(t)?Rc(t):Ci(t).x_()&&Fc(t,e))}function Lc(i,e){let t=j(i),n=Ci(t);t.Ta.delete(e),n.x_()&&Bm(t,e),t.Ta.size===0&&(n.x_()?n.B_():Bn(t)&&t.Aa.set("Unknown"))}function Fc(i,e){if(i.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(U.min())>0){let t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ci(i).H_(e)}function Bm(i,e){i.Ra.$e(e),Ci(i).Y_(e)}function Rc(i){i.Ra=new hl({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>i.Ta.get(e)||null,lt:()=>i.datastore.serializer.databaseId}),Ci(i).start(),i.Aa.aa()}function Nc(i){return Bn(i)&&!Ci(i).M_()&&i.Ta.size>0}function Bn(i){return j(i).Ia.size===0}function Vm(i){i.Ra=void 0}function f1(i){return B(this,null,function*(){i.Aa.set("Online")})}function m1(i){return B(this,null,function*(){i.Ta.forEach((e,t)=>{Fc(i,e)})})}function v1(i,e){return B(this,null,function*(){Vm(i),Nc(i)?(i.Aa.la(e),Rc(i)):i.Aa.set("Unknown")})}function b1(i,e,t){return B(this,null,function*(){if(i.Aa.set("Online"),e instanceof Ea&&e.state===2&&e.cause)try{yield(function(o,r){return B(this,null,function*(){let s=r.cause;for(let d of r.targetIds)o.Ta.has(d)&&(yield o.remoteSyncer.rejectListen(d,s),o.Ta.delete(d),o.Ra.removeTarget(d))})})(i,e)}catch(n){F(kn,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Fa(i,n)}else if(e instanceof ri?i.Ra.Ye(e):e instanceof Sa?i.Ra.it(e):i.Ra.et(e),!t.isEqual(U.min()))try{let n=yield km(i.localStore);t.compareTo(n)>=0&&(yield(function(r,s){let d=r.Ra.Pt(s);return d.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let p=r.Ta.get(u);p&&r.Ta.set(u,p.withResumeToken(c.resumeToken,s))}}),d.targetMismatches.forEach((c,u)=>{let p=r.Ta.get(c);if(!p)return;r.Ta.set(c,p.withResumeToken(Be.EMPTY_BYTE_STRING,p.snapshotVersion)),Bm(r,c);let f=new Bo(p.target,c,u,p.sequenceNumber);Fc(r,f)}),r.remoteSyncer.applyRemoteEvent(d)})(i,t))}catch(n){F(kn,"Failed to raise snapshot:",n),yield Fa(i,n)}})}function Fa(i,e,t){return B(this,null,function*(){if(!yi(e))throw e;i.Ia.add(1),yield Ro(i),i.Aa.set("Offline"),t||(t=()=>km(i.localStore)),i.asyncQueue.enqueueRetryable(()=>B(null,null,function*(){F(kn,"Retrying IndexedDB access"),yield t(),i.Ia.delete(1),yield ts(i)}))})}function Mm(i,e){return e().catch(t=>Fa(i,t,e))}function ns(i){return B(this,null,function*(){let e=j(i),t=en(e),n=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:_c;for(;w1(e);)try{let o=yield u1(e.localStore,n);if(o===null){e.Pa.length===0&&t.B_();break}n=o.batchId,x1(e,o)}catch(o){yield Fa(e,o)}Lm(e)&&Fm(e)})}function w1(i){return Bn(i)&&i.Pa.length<10}function x1(i,e){i.Pa.push(e);let t=en(i);t.x_()&&t.Z_&&t.X_(e.mutations)}function Lm(i){return Bn(i)&&!en(i).M_()&&i.Pa.length>0}function Fm(i){en(i).start()}function A1(i){return B(this,null,function*(){en(i).na()})}function y1(i){return B(this,null,function*(){let e=en(i);for(let t of i.Pa)e.X_(t.mutations)})}function C1(i,e,t){return B(this,null,function*(){let n=i.Pa.shift(),o=dl.from(n,e,t);yield Mm(i,()=>i.remoteSyncer.applySuccessfulWrite(o)),yield ns(i)})}function _1(i,e){return B(this,null,function*(){e&&en(i).Z_&&(yield(function(n,o){return B(this,null,function*(){if((function(s){return Ow(s)&&s!==P.ABORTED})(o.code)){let r=n.Pa.shift();en(n).N_(),yield Mm(n,()=>n.remoteSyncer.rejectFailedWrite(r.batchId,o)),yield ns(n)}})})(i,e)),Lm(i)&&Fm(i)})}function ff(i,e){return B(this,null,function*(){let t=j(i);t.asyncQueue.verifyOperationInProgress(),F(kn,"RemoteStore received new credentials");let n=Bn(t);t.Ia.add(3),yield Ro(t),n&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield ts(t)})}function S1(i,e){return B(this,null,function*(){let t=j(i);e?(t.Ia.delete(2),yield ts(t)):e||(t.Ia.add(2),yield Ro(t),t.Aa.set("Unknown"))})}function Ci(i){return i.Va||(i.Va=(function(t,n,o){let r=j(t);return r.ia(),new Wl(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,o)})(i.datastore,i.asyncQueue,{Zo:f1.bind(null,i),e_:m1.bind(null,i),n_:v1.bind(null,i),J_:b1.bind(null,i)}),i.da.push(e=>B(null,null,function*(){e?(i.Va.N_(),Nc(i)?Rc(i):i.Aa.set("Unknown")):(yield i.Va.stop(),Vm(i))}))),i.Va}function en(i){return i.ma||(i.ma=(function(t,n,o){let r=j(t);return r.ia(),new Zl(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,o)})(i.datastore,i.asyncQueue,{Zo:()=>Promise.resolve(),e_:A1.bind(null,i),n_:_1.bind(null,i),ea:y1.bind(null,i),ta:C1.bind(null,i)}),i.da.push(e=>B(null,null,function*(){e?(i.ma.N_(),yield ns(i)):(yield i.ma.stop(),i.Pa.length>0&&(F(kn,`Stopping write stream with ${i.Pa.length} pending writes`),i.Pa=[]))}))),i.ma}var $l=class i{constructor(e,t,n,o,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=o,this.removalCallback=r,this.deferred=new Pt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(s=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,o,r){let s=Date.now()+n,d=new i(e,t,s,o,r);return d.start(n),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Oc(i,e){if(kt("AsyncQueue",`${e}: ${i}`),yi(i))return new L(P.UNAVAILABLE,`${e}: ${i}`);throw i}var Ra=class i{static emptySet(e){return new i(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||N.comparator(t.key,n.key):(t,n)=>N.comparator(t.key,n.key),this.keyedMap=xo(),this.sortedSet=new he(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let o=t.getNext().key,r=n.getNext().key;if(!o.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new i;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var Na=class{constructor(){this.fa=new he(N.comparator)}track(e){let t=e.doc.key,n=this.fa.get(t);n?e.type!==0&&n.type===3?this.fa=this.fa.insert(t,e):e.type===3&&n.type!==1?this.fa=this.fa.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.fa=this.fa.remove(t):e.type===1&&n.type===2?this.fa=this.fa.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):O(63341,{At:e,ga:n}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,n)=>{e.push(n)}),e}},mi=class i{constructor(e,t,n,o,r,s,d,c,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=o,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=d,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,o,r){let s=[];return t.forEach(d=>{s.push({type:0,doc:d})}),new i(e,t,Ra.emptySet(t),s,n,o,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Xa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(t[o].type!==n[o].type||!t[o].doc.isEqual(n[o].doc))return!1;return!0}};var ec=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},tc=class{constructor(){this.queries=mf(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,n){let o=j(t),r=o.queries;o.queries=mf(),r.forEach((s,d)=>{for(let c of d.wa)c.onError(n)})})(this,new L(P.ABORTED,"Firestore shutting down"))}};function mf(){return new Vt(i=>dm(i),Xa)}function E1(i,e){return B(this,null,function*(){let t=j(i),n=3,o=e.query,r=t.queries.get(o);r?!r.Sa()&&e.ba()&&(n=2):(r=new ec,n=e.ba()?0:1);try{switch(n){case 0:r.ya=yield t.onListen(o,!0);break;case 1:r.ya=yield t.onListen(o,!1);break;case 2:yield t.onFirstRemoteStoreListen(o)}}catch(s){let d=Oc(s,`Initialization of query '${ti(e.query)}' failed`);return void e.onError(d)}t.queries.set(o,r),r.wa.push(e),e.va(t.onlineState),r.ya&&e.Ca(r.ya)&&zc(t)})}function T1(i,e){return B(this,null,function*(){let t=j(i),n=e.query,o=3,r=t.queries.get(n);if(r){let s=r.wa.indexOf(e);s>=0&&(r.wa.splice(s,1),r.wa.length===0?o=e.ba()?0:1:!r.Sa()&&e.ba()&&(o=2))}switch(o){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function P1(i,e){let t=j(i),n=!1;for(let o of e){let r=o.query,s=t.queries.get(r);if(s){for(let d of s.wa)d.Ca(o)&&(n=!0);s.ya=o}}n&&zc(t)}function I1(i,e,t){let n=j(i),o=n.queries.get(e);if(o)for(let r of o.wa)r.onError(t);n.queries.delete(e)}function zc(i){i.Da.forEach(e=>{e.next()})}var nc,vf;(vf=nc||(nc={})).Fa="default",vf.Cache="cache";var ic=class{constructor(e,t,n){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(e){if(!this.options.includeMetadataChanges){let n=[];for(let o of e.docChanges)o.type!==3&&n.push(o);e=new mi(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let n=t!=="Offline";return(!this.options.ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=mi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==nc.Cache}};var Oa=class{constructor(e){this.key=e}},za=class{constructor(e){this.key=e}},oc=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=q(),this.mutatedKeys=q(),this.Xa=lm(e),this.eu=new Ra(this.Xa)}get tu(){return this.Ha}nu(e,t){let n=t?t.ru:new Na,o=t?t.eu:this.eu,r=t?t.mutatedKeys:this.mutatedKeys,s=o,d=!1,c=this.query.limitType==="F"&&o.size===this.query.limit?o.last():null,u=this.query.limitType==="L"&&o.size===this.query.limit?o.first():null;if(e.inorderTraversal((p,f)=>{let v=o.get(p),_=$a(this.query,f)?f:null,T=!!v&&this.mutatedKeys.has(v.key),k=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations),I=!1;v&&_?v.data.isEqual(_.data)?T!==k&&(n.track({type:3,doc:_}),I=!0):this.iu(v,_)||(n.track({type:2,doc:_}),I=!0,(c&&this.Xa(_,c)>0||u&&this.Xa(_,u)<0)&&(d=!0)):!v&&_?(n.track({type:0,doc:_}),I=!0):v&&!_&&(n.track({type:1,doc:v}),I=!0,(c||u)&&(d=!0)),I&&(_?(s=s.add(_),r=k?r.add(p):r.delete(p)):(s=s.delete(p),r=r.delete(p)))}),this.query.limit!==null)for(;s.size>this.query.limit;){let p=this.query.limitType==="F"?s.last():s.first();s=s.delete(p.key),r=r.delete(p.key),n.track({type:1,doc:p})}return{eu:s,ru:n,Ds:d,mutatedKeys:r}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,o){let r=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let s=e.ru.pa();s.sort((p,f)=>(function(_,T){let k=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O(20277,{At:I})}};return k(_)-k(T)})(p.type,f.type)||this.Xa(p.doc,f.doc)),this.su(n),o=o!=null&&o;let d=t&&!o?this.ou():[],c=this.Za.size===0&&this.current&&!o?1:0,u=c!==this.Ya;return this.Ya=c,s.length!==0||u?{snapshot:new mi(this.query,e.eu,r,s,e.mutatedKeys,c===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:d}:{_u:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Na,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=q(),this.eu.forEach(n=>{this.au(n.key)&&(this.Za=this.Za.add(n.key))});let t=[];return e.forEach(n=>{this.Za.has(n)||t.push(new za(n))}),this.Za.forEach(n=>{e.has(n)||t.push(new Oa(n))}),t}uu(e){this.Ha=e.qs,this.Za=q();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return mi.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Hc="SyncEngine",rc=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},ac=class{constructor(e){this.key=e,this.lu=!1}},sc=class{constructor(e,t,n,o,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=o,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.hu={},this.Pu=new Vt(d=>dm(d),Xa),this.Tu=new Map,this.Iu=new Set,this.du=new he(N.comparator),this.Eu=new Map,this.Au=new Mo,this.Ru={},this.Vu=new Map,this.mu=Vo.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function k1(i,e,t=!0){return B(this,null,function*(){let n=jm(i),o,r=n.Pu.get(e);return r?(n.sharedClientState.addLocalQueryTarget(r.targetId),o=r.view.cu()):o=yield Rm(n,e,t,!0),o})}function D1(i,e){return B(this,null,function*(){let t=jm(i);yield Rm(t,e,!0,!1)})}function Rm(i,e,t,n){return B(this,null,function*(){let o=yield h1(i.localStore,vt(e)),r=o.targetId,s=i.sharedClientState.addLocalQueryTarget(r,t),d;return n&&(d=yield B1(i,e,r,s==="current",o.resumeToken)),i.isPrimaryClient&&t&&Dm(i.remoteStore,o),d})}function B1(i,e,t,n,o){return B(this,null,function*(){i.gu=(f,v,_)=>(function(k,I,H,R){return B(this,null,function*(){let z=I.view.nu(H);z.Ds&&(z=yield hf(k.localStore,I.query,!1).then(({documents:A})=>I.view.nu(A,z)));let X=R&&R.targetChanges.get(I.targetId),ge=R&&R.targetMismatches.get(I.targetId)!=null,Y=I.view.applyChanges(z,k.isPrimaryClient,X,ge);return wf(k,I.targetId,Y._u),Y.snapshot})})(i,f,v,_);let r=yield hf(i.localStore,e,!0),s=new oc(e,r.qs),d=s.nu(r.documents),c=Do.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",o),u=s.applyChanges(d,i.isPrimaryClient,c);wf(i,t,u._u);let p=new rc(e,t,s);return i.Pu.set(e,p),i.Tu.has(t)?i.Tu.get(t).push(e):i.Tu.set(t,[e]),u.snapshot})}function V1(i,e,t){return B(this,null,function*(){let n=j(i),o=n.Pu.get(e),r=n.Tu.get(o.targetId);if(r.length>1)return n.Tu.set(o.targetId,r.filter(s=>!Xa(s,e))),void n.Pu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(o.targetId),n.sharedClientState.isActiveQueryTarget(o.targetId)||(yield zl(n.localStore,o.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(o.targetId),t&&Lc(n.remoteStore,o.targetId),dc(n,o.targetId)}).catch(Ai))):(dc(n,o.targetId),yield zl(n.localStore,o.targetId,!0))})}function M1(i,e){return B(this,null,function*(){let t=j(i),n=t.Pu.get(e),o=t.Tu.get(n.targetId);t.isPrimaryClient&&o.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Lc(t.remoteStore,n.targetId))})}function L1(i,e,t){return B(this,null,function*(){let n=j1(i);try{let o=yield(function(s,d){let c=j(s),u=we.now(),p=d.reduce((_,T)=>_.add(T.key),q()),f,v;return c.persistence.runTransaction("Locally write mutations","readwrite",_=>{let T=Mt(),k=q();return c.Os.getEntries(_,p).next(I=>{T=I,T.forEach((H,R)=>{R.isValidDocument()||(k=k.add(H))})}).next(()=>c.localDocuments.getOverlayedDocuments(_,T)).next(I=>{f=I;let H=[];for(let R of d){let z=Nw(R,f.get(R.key).overlayedDocument);z!=null&&H.push(new xt(R.key,z,tm(z.value.mapValue),It.exists(!0)))}return c.mutationQueue.addMutationBatch(_,u,H,d)}).next(I=>{v=I;let H=I.applyToLocalDocumentSet(f,k);return c.documentOverlayCache.saveOverlays(_,I.batchId,H)})}).then(()=>({batchId:v.batchId,changes:um(f)}))})(n.localStore,e);n.sharedClientState.addPendingMutation(o.batchId),(function(s,d,c){let u=s.Ru[s.currentUser.toKey()];u||(u=new he(Q)),u=u.insert(d,c),s.Ru[s.currentUser.toKey()]=u})(n,o.batchId,t),yield No(n,o.changes),yield ns(n.remoteStore)}catch(o){let r=Oc(o,"Failed to persist write");t.reject(r)}})}function Nm(i,e){return B(this,null,function*(){let t=j(i);try{let n=yield l1(t.localStore,e);e.targetChanges.forEach((o,r)=>{let s=t.Eu.get(r);s&&(ee(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1,22616),o.addedDocuments.size>0?s.lu=!0:o.modifiedDocuments.size>0?ee(s.lu,14607):o.removedDocuments.size>0&&(ee(s.lu,42227),s.lu=!1))}),yield No(t,n,e)}catch(n){yield Ai(n)}})}function bf(i,e,t){let n=j(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let o=[];n.Pu.forEach((r,s)=>{let d=s.view.va(e);d.snapshot&&o.push(d.snapshot)}),(function(s,d){let c=j(s);c.onlineState=d;let u=!1;c.queries.forEach((p,f)=>{for(let v of f.wa)v.va(d)&&(u=!0)}),u&&zc(c)})(n.eventManager,e),o.length&&n.hu.J_(o),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function F1(i,e,t){return B(this,null,function*(){let n=j(i);n.sharedClientState.updateQueryState(e,"rejected",t);let o=n.Eu.get(e),r=o&&o.key;if(r){let s=new he(N.comparator);s=s.insert(r,at.newNoDocument(r,U.min()));let d=q().add(r),c=new _a(U.min(),new Map,new he(Q),s,d);yield Nm(n,c),n.du=n.du.remove(r),n.Eu.delete(e),jc(n)}else yield zl(n.localStore,e,!1).then(()=>dc(n,e,t)).catch(Ai)})}function R1(i,e){return B(this,null,function*(){let t=j(i),n=e.batch.batchId;try{let o=yield d1(t.localStore,e);zm(t,n,null),Om(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield No(t,o)}catch(o){yield Ai(o)}})}function N1(i,e,t){return B(this,null,function*(){let n=j(i);try{let o=yield(function(s,d){let c=j(s);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let p;return c.mutationQueue.lookupMutationBatch(u,d).next(f=>(ee(f!==null,37113),p=f.keys(),c.mutationQueue.removeMutationBatch(u,f))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,p,d)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,p)).next(()=>c.localDocuments.getDocuments(u,p))})})(n.localStore,e);zm(n,e,t),Om(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield No(n,o)}catch(o){yield Ai(o)}})}function Om(i,e){(i.Vu.get(e)||[]).forEach(t=>{t.resolve()}),i.Vu.delete(e)}function zm(i,e,t){let n=j(i),o=n.Ru[n.currentUser.toKey()];if(o){let r=o.get(e);r&&(t?r.reject(t):r.resolve(),o=o.remove(e)),n.Ru[n.currentUser.toKey()]=o}}function dc(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(let n of i.Tu.get(e))i.Pu.delete(n),t&&i.hu.pu(n,t);i.Tu.delete(e),i.isPrimaryClient&&i.Au.zr(e).forEach(n=>{i.Au.containsKey(n)||Hm(i,n)})}function Hm(i,e){i.Iu.delete(e.path.canonicalString());let t=i.du.get(e);t!==null&&(Lc(i.remoteStore,t),i.du=i.du.remove(e),i.Eu.delete(t),jc(i))}function wf(i,e,t){for(let n of t)n instanceof Oa?(i.Au.addReference(n.key,e),O1(i,n)):n instanceof za?(F(Hc,"Document no longer in limbo: "+n.key),i.Au.removeReference(n.key,e),i.Au.containsKey(n.key)||Hm(i,n.key)):O(19791,{yu:n})}function O1(i,e){let t=e.key,n=t.path.canonicalString();i.du.get(t)||i.Iu.has(n)||(F(Hc,"New document in limbo: "+t),i.Iu.add(n),jc(i))}function jc(i){for(;i.Iu.size>0&&i.du.size<i.maxConcurrentLimboResolutions;){let e=i.Iu.values().next().value;i.Iu.delete(e);let t=new N(se.fromString(e)),n=i.mu.next();i.Eu.set(n,new ac(t)),i.du=i.du.insert(t,n),Dm(i.remoteStore,new Bo(vt(Dc(t.path)),n,"TargetPurposeLimboResolution",Cc.ue))}}function No(i,e,t){return B(this,null,function*(){let n=j(i),o=[],r=[],s=[];n.Pu.isEmpty()||(n.Pu.forEach((d,c)=>{s.push(n.gu(c,e,t).then(u=>{var p;if((u||t)&&n.isPrimaryClient){let f=u?!u.fromCache:(p=t?.targetChanges.get(c.targetId))===null||p===void 0?void 0:p.current;n.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(u){o.push(u);let f=Fl.Es(c.targetId,u);r.push(f)}}))}),yield Promise.all(s),n.hu.J_(o),yield(function(c,u){return B(this,null,function*(){let p=j(c);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>D.forEach(u,v=>D.forEach(v.Is,_=>p.persistence.referenceDelegate.addReference(f,v.targetId,_)).next(()=>D.forEach(v.ds,_=>p.persistence.referenceDelegate.removeReference(f,v.targetId,_)))))}catch(f){if(!yi(f))throw f;F(Mc,"Failed to update sequence numbers: "+f)}for(let f of u){let v=f.targetId;if(!f.fromCache){let _=p.Fs.get(v),T=_.snapshotVersion,k=_.withLastLimboFreeSnapshotVersion(T);p.Fs=p.Fs.insert(v,k)}}})})(n.localStore,r))})}function z1(i,e){return B(this,null,function*(){let t=j(i);if(!t.currentUser.isEqual(e)){F(Hc,"User change. New user:",e.toKey());let n=yield Im(t.localStore,e);t.currentUser=e,(function(r,s){r.Vu.forEach(d=>{d.forEach(c=>{c.reject(new L(P.CANCELLED,s))})}),r.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield No(t,n.Bs)}})}function H1(i,e){let t=j(i),n=t.Eu.get(e);if(n&&n.lu)return q().add(n.key);{let o=q(),r=t.Tu.get(e);if(!r)return o;for(let s of r){let d=t.Pu.get(s);o=o.unionWith(d.view.tu)}return o}}function jm(i){let e=j(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=Nm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=H1.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=F1.bind(null,e),e.hu.J_=P1.bind(null,e.eventManager),e.hu.pu=I1.bind(null,e.eventManager),e}function j1(i){let e=j(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=R1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=N1.bind(null,e),e}var Um=(()=>{class i{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return B(this,null,function*(){this.serializer=es(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,n){return null}Fu(t,n){return null}vu(t){return s1(this.persistence,new Nl,t.initialUser,this.serializer)}Du(t){return new ka(Ll.Vi,this.serializer)}bu(t){return new Hl}terminate(){return B(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return i.provider={build:()=>new i},i})(),lc=class extends Um{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){ee(this.persistence.referenceDelegate instanceof Da,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new yl(n,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?Je.withCacheSize(this.cacheSizeBytes):Je.DEFAULT;return new ka(n=>Da.Vi(n,t),this.serializer)}};var U1=(()=>{class i{initialize(t,n){return B(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>bf(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=z1.bind(null,this.syncEngine),yield S1(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new tc})()}createDatastore(t){let n=es(t.databaseInfo.databaseId),o=(function(s){return new Gl(s)})(t.databaseInfo);return(function(s,d,c,u){return new Yl(s,d,c,u)})(t.authCredentials,t.appCheckCredentials,o,n)}createRemoteStore(t){return(function(o,r,s,d,c){return new Xl(o,r,s,d,c)})(this.localStore,this.datastore,t.asyncQueue,n=>bf(this.syncEngine,n,0),(function(){return Va.C()?new Va:new jl})())}createSyncEngine(t,n){return(function(r,s,d,c,u,p,f){let v=new sc(r,s,d,c,u,p);return f&&(v.fu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return B(this,null,function*(){var t,n;yield(function(r){return B(this,null,function*(){let s=j(r);F(kn,"RemoteStore shutting down."),s.Ia.add(5),yield Ro(s),s.Ea.shutdown(),s.Aa.set("Unknown")})})(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return i.provider={build:()=>new i},i})();var cc=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):kt("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var tn="FirestoreClient",uc=class{constructor(e,t,n,o,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=o,this.user=ye.UNAUTHENTICATED,this.clientId=So.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,s=>B(this,null,function*(){F(tn,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(n,s=>(F(tn,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Pt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>B(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=Oc(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function Vd(i,e){return B(this,null,function*(){i.asyncQueue.verifyOperationInProgress(),F(tn,"Initializing OfflineComponentProvider");let t=i.configuration;yield e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener(o=>B(null,null,function*(){n.isEqual(o)||(yield Im(e.localStore,o),n=o)})),e.persistence.setDatabaseDeletedListener(()=>{Jt("Terminating Firestore due to IndexedDb database deletion"),i.terminate().then(()=>{F("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(o=>{Jt("Terminating Firestore due to IndexedDb database deletion failed",o)})}),i._offlineComponents=e})}function xf(i,e){return B(this,null,function*(){i.asyncQueue.verifyOperationInProgress();let t=yield Q1(i);F(tn,"Initializing OnlineComponentProvider"),yield e.initialize(t,i.configuration),i.setCredentialChangeListener(n=>ff(e.remoteStore,n)),i.setAppCheckTokenChangeListener((n,o)=>ff(e.remoteStore,o)),i._onlineComponents=e})}function Q1(i){return B(this,null,function*(){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){F(tn,"Using user provided OfflineComponentProvider");try{yield Vd(i,i._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(o){return o.name==="FirebaseError"?o.code===P.FAILED_PRECONDITION||o.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||o.code===22||o.code===20||o.code===11})(t))throw t;Jt("Error using user provided cache. Falling back to memory cache: "+t),yield Vd(i,new Um)}}else F(tn,"Using default OfflineComponentProvider"),yield Vd(i,new lc(void 0));return i._offlineComponents})}function Qm(i){return B(this,null,function*(){return i._onlineComponents||(i._uninitializedComponentsProvider?(F(tn,"Using user provided OnlineComponentProvider"),yield xf(i,i._uninitializedComponentsProvider._online)):(F(tn,"Using default OnlineComponentProvider"),yield xf(i,new U1))),i._onlineComponents})}function q1(i){return Qm(i).then(e=>e.syncEngine)}function Af(i){return B(this,null,function*(){let e=yield Qm(i),t=e.eventManager;return t.onListen=k1.bind(null,e.syncEngine),t.onUnlisten=V1.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=D1.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=M1.bind(null,e.syncEngine),t})}function qm(i){let e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}var yf=new Map;var Gm="firestore.googleapis.com",Cf=!0,Ha=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new L(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Gm,this.ssl=Cf}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Cf;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Pm;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<o1)throw new L(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}nw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qm((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new L(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new L(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new L(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,o){return n.timeoutSeconds===o.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},vi=class{constructor(e,t,n,o){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=o,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ha({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new L(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ha(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new Md;switch(n.type){case"firstParty":return new Nd(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new L(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return B(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let n=yf.get(t);n&&(F("ComponentProvider","Removing Datastore"),yf.delete(t),n.terminate())})(this),Promise.resolve()}};function Wm(i,e,t,n={}){var o;i=Gt(i,vi);let r=Xn(e),s=i._getSettings(),d=Object.assign(Object.assign({},s),{emulatorOptions:i._getEmulatorOptions()}),c=`${e}:${t}`;r&&(zr(`https://${c}`),jr("Firestore",!0)),s.host!==Gm&&s.host!==c&&Jt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},s),{host:c,ssl:r,emulatorOptions:n});if(!Qr(u,d)&&(i._setSettings(u),n.mockUserToken)){let p,f;if(typeof n.mockUserToken=="string")p=n.mockUserToken,f=ye.MOCK_USER;else{p=Hr(n.mockUserToken,(o=i._app)===null||o===void 0?void 0:o.options.projectId);let v=n.mockUserToken.sub||n.mockUserToken.user_id;if(!v)throw new L(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new ye(v)}i._authCredentials=new Ld(new ma(p,f))}}var Dn=class i{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new i(this.firestore,e,this._query)}},Ee=class i{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new i(this.firestore,e,this._key)}toJSON(){return{type:i._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Fo(t,i._jsonSchema))return new i(e,n||null,new N(se.fromString(t.referencePath)))}};Ee._jsonSchemaVersion="firestore/documentReference/1.0",Ee._jsonSchema={type:be("string",Ee._jsonSchemaVersion),referencePath:be("string")};var Wt=class i extends Dn{constructor(e,t,n){super(e,t,Dc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ee(this.firestore,null,new N(e))}withConverter(e){return new i(this.firestore,e,this._path)}};function Zm(i,e,...t){if(i=je(i),Df("collection","path",e),i instanceof vi){let n=se.fromString(e,...t);return Og(n),new Wt(i,null,n)}{if(!(i instanceof Ee||i instanceof Wt))throw new L(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(se.fromString(e,...t));return Og(n),new Wt(i.firestore,null,n)}}function Uc(i,e,...t){if(i=je(i),arguments.length===1&&(e=So.newId()),Df("doc","path",e),i instanceof vi){let n=se.fromString(e,...t);return Ng(n),new Ee(i,null,new N(n))}{if(!(i instanceof Ee||i instanceof Wt))throw new L(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(se.fromString(e,...t));return Ng(n),new Ee(i.firestore,i instanceof Wt?i.converter:null,new N(n))}}var _f="AsyncQueue",ja=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Ma(this,"async_queue_retry"),this.oc=()=>{let n=Bd();n&&F(_f,"Visibility state changed to "+n.visibilityState),this.F_.y_()},this._c=e;let t=Bd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=Bd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new Pt;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return B(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!yi(e))throw e;F(_f,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(n=>{throw this.tc=n,this.nc=!1,kt("INTERNAL UNHANDLED ERROR: ",Sf(n)),n}).then(n=>(this.nc=!1,n))));return this._c=t,t}enqueueAfterDelay(e,t,n){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let o=$l.createAndSchedule(this,e,t,n,r=>this.lc(r));return this.ec.push(o),o}ac(){this.tc&&O(47125,{hc:Sf(this.tc)})}verifyOperationInProgress(){}Pc(){return B(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function Sf(i){let e=i.message||"";return i.stack&&(e=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),e}function Ef(i){return(function(t,n){if(typeof t!="object"||t===null)return!1;let o=t;for(let r of n)if(r in o&&typeof o[r]=="function")return!0;return!1})(i,["next","error","complete"])}var nn=class extends vi{constructor(e,t,n,o){super(e,t,n,o),this.type="firestore",this._queue=new ja,this._persistenceKey=o?.name||"[DEFAULT]"}_terminate(){return B(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ja(e),this._firestoreClient=void 0,yield e}})}};function Qc(i,e){let t=typeof i=="object"?i:Jr(),n=typeof i=="string"?i:e||Aa,o=Zr(t,"firestore").getImmediate({identifier:n});if(!o._initialized){let r=Or("firestore");r&&Wm(o,...r)}return o}function Km(i){if(i._terminated)throw new L(P.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||G1(i),i._firestoreClient}function G1(i){var e,t,n;let o=i._freezeSettings(),r=(function(d,c,u,p){return new Ud(d,c,u,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,qm(p.experimentalLongPollingOptions),p.useFetchStreams,p.isUsingEmulator)})(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,o);i._componentsProvider||!((t=o.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=o.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(i._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),i._firestoreClient=new uc(i._authCredentials,i._appCheckCredentials,i._queue,r,i._componentsProvider&&(function(d){let c=d?._online.build();return{_offline:d?._offline.build(c),_online:c}})(i._componentsProvider))}var Zt=class i{constructor(e){this._byteString=e}static fromBase64String(e){try{return new i(Be.fromBase64String(e))}catch(t){throw new L(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new i(Be.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:i._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Fo(e,i._jsonSchema))return i.fromBase64String(e.bytes)}};Zt._jsonSchemaVersion="firestore/bytes/1.0",Zt._jsonSchema={type:be("string",Zt._jsonSchemaVersion),bytes:be("string")};var bi=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new We(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var wi=class{constructor(e){this._methodName=e}};var Kt=class i{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:i._jsonSchemaVersion}}static fromJSON(e){if(Fo(e,i._jsonSchema))return new i(e.latitude,e.longitude)}};Kt._jsonSchemaVersion="firestore/geoPoint/1.0",Kt._jsonSchema={type:be("string",Kt._jsonSchemaVersion),latitude:be("number"),longitude:be("number")};var Yt=class i{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(n,o){if(n.length!==o.length)return!1;for(let r=0;r<n.length;++r)if(n[r]!==o[r])return!1;return!0})(this._values,e._values)}toJSON(){return{type:i._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Fo(e,i._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new i(e.vectorValues);throw new L(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Yt._jsonSchemaVersion="firestore/vectorValue/1.0",Yt._jsonSchema={type:be("string",Yt._jsonSchemaVersion),vectorValues:be("object")};var W1=/^__.*__$/,hc=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new xt(e,this.data,this.fieldMask,t,this.fieldTransforms):new In(e,this.data,t,this.fieldTransforms)}},Ua=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new xt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Ym(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O(40011,{Ec:i})}}var pc=class i{constructor(e,t,n,o,r,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=o,r===void 0&&this.Ac(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new i(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),o=this.Rc({path:n,mc:!1});return o.fc(e),o}gc(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),o=this.Rc({path:n,mc:!1});return o.Ac(),o}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return qa(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(Ym(this.Ec)&&W1.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},gc=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||es(e)}Dc(e,t,n,o=!1){return new pc({Ec:e,methodName:t,bc:n,path:We.emptyPath(),mc:!1,Sc:o},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function qc(i){let e=i._freezeSettings(),t=es(i._databaseId);return new gc(i._databaseId,!!e.ignoreUndefinedProperties,t)}function Z1(i,e,t,n,o,r={}){let s=i.Dc(r.merge||r.mergeFields?2:0,e,t,o);Gc("Data must be an object, but it was:",s,n);let d=Jm(n,s),c,u;if(r.merge)c=new Xe(s.fieldMask),u=s.fieldTransforms;else if(r.mergeFields){let p=[];for(let f of r.mergeFields){let v=mc(e,f,t);if(!s.contains(v))throw new L(P.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);$m(p,v)||p.push(v)}c=new Xe(p),u=s.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,u=s.fieldTransforms;return new hc(new Ge(d),c,u)}var Qa=class i extends wi{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof i}};var fc=class i extends wi{_toFieldTransform(e){return new ol(e.path,new En)}isEqual(e){return e instanceof i}};function K1(i,e,t,n){let o=i.Dc(1,e,t);Gc("Data must be an object, but it was:",o,n);let r=[],s=Ge.empty();on(n,(c,u)=>{let p=Wc(e,c,t);u=je(u);let f=o.gc(p);if(u instanceof Qa)r.push(p);else{let v=Oo(u,f);v!=null&&(r.push(p),s.set(p,v))}});let d=new Xe(r);return new Ua(s,d,o.fieldTransforms)}function Y1(i,e,t,n,o,r){let s=i.Dc(1,e,t),d=[mc(e,n,t)],c=[o];if(r.length%2!=0)throw new L(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<r.length;v+=2)d.push(mc(e,r[v])),c.push(r[v+1]);let u=[],p=Ge.empty();for(let v=d.length-1;v>=0;--v)if(!$m(u,d[v])){let _=d[v],T=c[v];T=je(T);let k=s.gc(_);if(T instanceof Qa)u.push(_);else{let I=Oo(T,k);I!=null&&(u.push(_),p.set(_,I))}}let f=new Xe(u);return new Ua(p,f,s.fieldTransforms)}function J1(i,e,t,n=!1){return Oo(t,i.Dc(n?4:3,e))}function Oo(i,e){if(Xm(i=je(i)))return Gc("Unsupported field value:",e,i),Jm(i,e);if(i instanceof wi)return(function(n,o){if(!Ym(o.Ec))throw o.wc(`${n._methodName}() can only be used with update() and set()`);if(!o.path)throw o.wc(`${n._methodName}() is not currently supported inside arrays`);let r=n._toFieldTransform(o);r&&o.fieldTransforms.push(r)})(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(n,o){let r=[],s=0;for(let d of n){let c=Oo(d,o.yc(s));c==null&&(c={nullValue:"NULL_VALUE"}),r.push(c),s++}return{arrayValue:{values:r}}})(i,e)}return(function(n,o){if((n=je(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Vw(o.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let r=we.fromDate(n);return{timestampValue:Pa(o.serializer,r)}}if(n instanceof we){let r=new we(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Pa(o.serializer,r)}}if(n instanceof Kt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Zt)return{bytesValue:Am(o.serializer,n._byteString)};if(n instanceof Ee){let r=o.databaseId,s=n.firestore._databaseId;if(!s.isEqual(r))throw o.wc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Vc(n.firestore._databaseId||o.databaseId,n._key.path)}}if(n instanceof Yt)return(function(s,d){return{mapValue:{fields:{[Ec]:{stringValue:Tc},[li]:{arrayValue:{values:s.toArray().map(u=>{if(typeof u!="number")throw d.wc("VectorValues must only contain numeric values.");return Bc(d.serializer,u)})}}}}}})(n,o);throw o.wc(`Unsupported field value: ${Ka(n)}`)})(i,e)}function Jm(i,e){let t={};return Wf(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):on(i,(n,o)=>{let r=Oo(o,e.Vc(n));r!=null&&(t[n]=r)}),{mapValue:{fields:t}}}function Xm(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof we||i instanceof Kt||i instanceof Zt||i instanceof Ee||i instanceof wi||i instanceof Yt)}function Gc(i,e,t){if(!Xm(t)||!Bf(t)){let n=Ka(t);throw n==="an object"?e.wc(i+" a custom object"):e.wc(i+" "+n)}}function mc(i,e,t){if((e=je(e))instanceof bi)return e._internalPath;if(typeof e=="string")return Wc(i,e);throw qa("Field path arguments must be of type string or ",i,!1,void 0,t)}var X1=new RegExp("[~\\*/\\[\\]]");function Wc(i,e,t){if(e.search(X1)>=0)throw qa(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new bi(...e.split("."))._internalPath}catch{throw qa(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function qa(i,e,t,n,o){let r=n&&!n.isEmpty(),s=o!==void 0,d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let c="";return(r||s)&&(c+=" (found",r&&(c+=` in field ${n}`),s&&(c+=` in document ${o}`),c+=")"),new L(P.INVALID_ARGUMENT,d+i+c)}function $m(i,e){return i.some(t=>t.isEqual(e))}var Ga=class{constructor(e,t,n,o,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=o,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Ee(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new vc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Zc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},vc=class extends Ga{data(){return super.data()}};function Zc(i,e){return typeof e=="string"?Wc(i,e):e instanceof bi?e._internalPath:e._delegate._internalPath}function $1(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new L(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Lo=class{},Wa=class extends Lo{};function e0(i,e,...t){let n=[];e instanceof Lo&&n.push(e),n=n.concat(t),(function(r){let s=r.filter(c=>c instanceof wc).length,d=r.filter(c=>c instanceof bc).length;if(s>1||s>0&&d>0)throw new L(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(let o of n)i=o._apply(i);return i}var bc=class i extends Wa{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=this._parse(e);return n0(e._query,t),new Dn(e.firestore,e.converter,nl(e._query,t))}_parse(e){let t=qc(e.firestore);return(function(r,s,d,c,u,p,f){let v;if(u.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new L(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Pf(f,p);let T=[];for(let k of f)T.push(Tf(c,r,k));v={arrayValue:{values:T}}}else v=Tf(c,r,f)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Pf(f,p),v=J1(d,s,f,p==="in"||p==="not-in");return ve.create(u,p,v)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};var wc=class i extends Lo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new i(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:st.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(o,r){let s=o,d=r.getFlattenedFilters();for(let c of d)n0(s,c),s=nl(s,c)})(e._query,t),new Dn(e.firestore,e.converter,nl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var xc=class i extends Wa{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new i(e,t)}_apply(e){let t=(function(o,r,s){if(o.startAt!==null)throw new L(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(o.endAt!==null)throw new L(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Sn(r,s)})(e._query,this._field,this._direction);return new Dn(e.firestore,e.converter,(function(o,r){let s=o.explicitOrderBy.concat([r]);return new $t(o.path,o.collectionGroup,s,o.filters.slice(),o.limit,o.limitType,o.startAt,o.endAt)})(e._query,t))}};function t0(i,e="asc"){let t=e,n=Zc("orderBy",i);return xc._create(n,t)}function Tf(i,e,t){if(typeof(t=je(t))=="string"){if(t==="")throw new L(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sm(e)&&t.indexOf("/")!==-1)throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(se.fromString(t));if(!N.isDocumentKey(n))throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Gg(i,new N(n))}if(t instanceof Ee)return Gg(i,t._key);throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ka(t)}.`)}function Pf(i,e){if(!Array.isArray(i)||i.length===0)throw new L(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function n0(i,e){let t=(function(o,r){for(let s of o)for(let d of s.getFlattenedFilters())if(r.indexOf(d.op)>=0)return d.op;return null})(i.filters,(function(o){switch(o){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new L(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new L(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Ac=class{convertValue(e,t="none"){switch(Xt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ae(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Bt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw O(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return on(e,(o,r)=>{n[o]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,o;let r=(o=(n=(t=e.fields)===null||t===void 0?void 0:t[li].arrayValue)===null||n===void 0?void 0:n.values)===null||o===void 0?void 0:o.map(s=>ae(s.doubleValue));return new Yt(r)}convertGeoPoint(e){return new Kt(ae(e.latitude),ae(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=Ja(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Po(e));default:return null}}convertTimestamp(e){let t=Dt(e);return new we(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=se.fromString(e);ee(Tm(n),9688,{name:e});let o=new ya(n.get(1),n.get(3)),r=new N(n.popFirst(5));return o.isEqual(t)||kt(`Document ${r} contains a document reference within a different database (${o.projectId}/${o.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}};function ex(i,e,t){let n;return n=i?t&&(t.merge||t.mergeFields)?i.toFirestore(e,t):i.toFirestore(e):e,n}var An=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},yn=class i extends Ga{constructor(e,t,n,o,r,s){super(e,t,n,o,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ai(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(Zc("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=i._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};yn._jsonSchemaVersion="firestore/documentSnapshot/1.0",yn._jsonSchema={type:be("string",yn._jsonSchemaVersion),bundleSource:be("string","DocumentSnapshot"),bundleName:be("string"),bundle:be("string")};var ai=class extends yn{data(e={}){return super.data(e)}},si=class i{constructor(e,t,n,o){this._firestore=e,this._userDataWriter=t,this._snapshot=o,this.metadata=new An(o.hasPendingWrites,o.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ai(this._firestore,this._userDataWriter,n.key,n,new An(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(o,r){if(o._snapshot.oldDocs.isEmpty()){let s=0;return o._snapshot.docChanges.map(d=>{let c=new ai(o._firestore,o._userDataWriter,d.doc.key,d.doc,new An(o._snapshot.mutatedKeys.has(d.doc.key),o._snapshot.fromCache),o.query.converter);return d.doc,{type:"added",doc:c,oldIndex:-1,newIndex:s++}})}{let s=o._snapshot.oldDocs;return o._snapshot.docChanges.filter(d=>r||d.type!==3).map(d=>{let c=new ai(o._firestore,o._userDataWriter,d.doc.key,d.doc,new An(o._snapshot.mutatedKeys.has(d.doc.key),o._snapshot.fromCache),o.query.converter),u=-1,p=-1;return d.type!==0&&(u=s.indexOf(d.doc.key),s=s.delete(d.doc.key)),d.type!==1&&(s=s.add(d.doc),p=s.indexOf(d.doc.key)),{type:tx(d.type),doc:c,oldIndex:u,newIndex:p}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=i._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=So.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],o=[];return this.docs.forEach(r=>{r._document!==null&&(t.push(r._document),n.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),o.push(r.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function tx(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O(61501,{type:i})}}si._jsonSchemaVersion="firestore/querySnapshot/1.0",si._jsonSchema={type:be("string",si._jsonSchemaVersion),bundleSource:be("string","QuerySnapshot"),bundleName:be("string"),bundle:be("string")};var Za=class extends Ac{constructor(e){super(),this.firestore=e}convertBytes(e){return new Zt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ee(this.firestore,null,t)}};function i0(i,e,t,...n){i=Gt(i,Ee);let o=Gt(i.firestore,nn),r=qc(o),s;return s=typeof(e=je(e))=="string"||e instanceof bi?Y1(r,"updateDoc",i._key,e,t,n):K1(r,"updateDoc",i._key,e),Yc(o,[s.toMutation(i._key,It.exists(!0))])}function o0(i){return Yc(Gt(i.firestore,nn),[new ko(i._key,It.none())])}function r0(i,e){let t=Gt(i.firestore,nn),n=Uc(i),o=ex(i.converter,e);return Yc(t,[Z1(qc(i.firestore),"addDoc",n._key,o,i.converter!==null,{}).toMutation(n._key,It.exists(!1))]).then(()=>n)}function Kc(i,...e){var t,n,o;i=je(i);let r={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||Ef(e[s])||(r=e[s++]);let d={includeMetadataChanges:r.includeMetadataChanges,source:r.source};if(Ef(e[s])){let f=e[s];e[s]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[s+1]=(n=f.error)===null||n===void 0?void 0:n.bind(f),e[s+2]=(o=f.complete)===null||o===void 0?void 0:o.bind(f)}let c,u,p;if(i instanceof Ee)u=Gt(i.firestore,nn),p=Dc(i._key.path),c={next:f=>{e[s]&&e[s](nx(u,i,f))},error:e[s+1],complete:e[s+2]};else{let f=Gt(i,Dn);u=Gt(f.firestore,nn),p=f._query;let v=new Za(u);c={next:_=>{e[s]&&e[s](new si(u,v,f,_))},error:e[s+1],complete:e[s+2]},$1(i._query)}return(function(v,_,T,k){let I=new cc(k),H=new ic(_,I,T);return v.asyncQueue.enqueueAndForget(()=>B(null,null,function*(){return E1(yield Af(v),H)})),()=>{I.Ou(),v.asyncQueue.enqueueAndForget(()=>B(null,null,function*(){return T1(yield Af(v),H)}))}})(Km(u),p,d,c)}function Yc(i,e){return(function(n,o){let r=new Pt;return n.asyncQueue.enqueueAndForget(()=>B(null,null,function*(){return L1(yield q1(n),o,r)})),r.promise})(Km(i),e)}function nx(i,e,t){let n=t.docs.get(e._key),o=new Za(i);return new yn(i,o,e._key,n,new An(t.hasPendingWrites,t.fromCache),e.converter)}function a0(){return new fc("serverTimestamp")}(function(e,t=!0){(function(o){xi=o})(Yr),Wr(new qr("firestore",(n,{instanceIdentifier:o,options:r})=>{let s=n.getProvider("app").getImmediate(),d=new nn(new Fd(n.getProvider("auth-internal")),new Od(s,n.getProvider("app-check-internal")),(function(u,p){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new L(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ya(u.options.projectId,p)})(s,o),s);return r=Object.assign({useFetchStreams:t},r),d._setSettings(r),d},"PUBLIC").setMultipleInstances(!0)),ft(Mg,Lg,e),ft(Mg,Lg,"esm2017")})();var is=function(){return is=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},is.apply(this,arguments)};var rx={includeMetadataChanges:!1};function s0(i,e){return e===void 0&&(e=rx),new Sp(function(t){var n=Kc(i,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:n}})}function d0(i,e){var t;e===void 0&&(e={});var n=i.data(e);return!i.exists()||typeof n!="object"||n===null||!e.idField?n:is(is({},n),(t={},t[e.idField]=i.id,t))}function l0(i){return s0(i,{includeMetadataChanges:!0}).pipe(uo(function(e){return e.docs}))}function c0(i,e){return e===void 0&&(e={}),l0(i).pipe(uo(function(t){return t.map(function(n){return d0(n,e)})}))}var Vn=class{constructor(e){return e}},u0="firestore",Jc=class{constructor(){return ea(u0)}};var Xc=new Ut("angularfire2.firestore-instances");function ax(i,e){let t=$r(u0,i,e);return t&&new Vn(t)}function sx(i){return(e,t)=>{let n=e.runOutsideAngular(()=>i(t));return new Vn(n)}}var dx={provide:Jc,deps:[[new ut,Xc]]},lx={provide:Vn,useFactory:ax,deps:[[new ut,Xc],na]};function h0(i,...e){return ft("angularfire",Xr.full,"fst"),Er([lx,dx,{provide:Xc,useFactory:sx(i),multi:!0,deps:[it,He,ta,ia,[new ut,ra],[new ut,oa],...e]}])}var $c=rt(c0,!0);var eu=rt(r0,!0,2);var zo=rt(Zm,!0,2);var tu=rt(o0,!0,2);var os=rt(Uc,!0,2);var p0=rt(t0,!0,2),g0=rt(e0,!0,2);var f0=rt(i0,!0,2);var rs=class i{constructor(e,t,n){this.firestore=e;this.authService$=t;this.injector=n;this.notesCollection=zo(this.firestore,"users")}notesCollection;addNote(e){return B(this,null,function*(){try{let t=this.authService$.getCurrentUser();if(!t)throw new Error("User not authenticated. Cannot add note.");yield po(this.injector,()=>B(this,null,function*(){let n=zo(this.firestore,`users/${t.uid}/notes`),o=co(Oe({},e),{createdAt:a0()});yield eu(n,o)}))}catch(t){throw console.error("\u274C Error adding note: ",t),t}})}updateNote(e,t){return B(this,null,function*(){try{let n=this.authService$.getCurrentUser();if(!n)throw new Error("User not authenticated. Cannot update note.");yield po(this.injector,()=>B(this,null,function*(){let o=os(this.firestore,`users/${n.uid}/notes/${e}`);yield f0(o,t)}))}catch(n){throw console.error("\u274C Error updating note: ",n),n}})}deleteNote(e){return B(this,null,function*(){try{let t=this.authService$.getCurrentUser();if(!t)throw new Error("User not authenticated. Cannot delete note.");yield po(this.injector,()=>B(this,null,function*(){let n=os(this.firestore,`users/${t.uid}/notes/${e}`);yield tu(n)}))}catch(t){throw console.error("\u274C Error deleting note: ",t),t}})}getNotes(){return this.authService$.user$.pipe(Pp(e=>e?po(this.injector,()=>{let t=zo(this.firestore,`users/${e.uid}/notes`),n=g0(t,p0("createdAt","desc"));return $c(n,{idField:"id"})}):Sr([])))}getNotes_bak(){return $c(this.notesCollection,{idField:"id"})}addNote_bak(e,t){let n=zo(this.firestore,"notes");return eu(n,{uid:t,content:e,timestamp:Date.now()})}deleteNote_bak(e){let t=os(this.firestore,`notes/${e}`);return tu(t)}static \u0275fac=function(t){return new(t||i)(_t(Vn),_t(wg),_t(He))};static \u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ho=class{_attachedHost;attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;e!=null&&(this._attachedHost=null,e.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},_i=class extends Ho{component;viewContainerRef;injector;projectableNodes;constructor(e,t,n,o){super(),this.component=e,this.viewContainerRef=t,this.injector=n,this.projectableNodes=o}},Si=class extends Ho{templateRef;viewContainerRef;context;injector;constructor(e,t,n,o){super(),this.templateRef=e,this.viewContainerRef=t,this.context=n,this.injector=o}get origin(){return this.templateRef.elementRef}attach(e,t=this.context){return this.context=t,super.attach(e)}detach(){return this.context=void 0,super.detach()}},nu=class extends Ho{element;constructor(e){super(),this.element=e instanceof qn?e.nativeElement:e}},Ei=class{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(e){if(e instanceof _i)return this._attachedPortal=e,this.attachComponentPortal(e);if(e instanceof Si)return this._attachedPortal=e,this.attachTemplatePortal(e);if(this.attachDomPortal&&e instanceof nu)return this._attachedPortal=e,this.attachDomPortal(e)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}},as=class extends Ei{outletElement;_appRef;_defaultInjector;constructor(e,t,n){super(),this.outletElement=e,this._appRef=t,this._defaultInjector=n}attachComponentPortal(e){let t;if(e.viewContainerRef){let n=e.injector||e.viewContainerRef.injector,o=n.get(od,null,{optional:!0})||void 0;t=e.viewContainerRef.createComponent(e.component,{index:e.viewContainerRef.length,injector:n,ngModuleRef:o,projectableNodes:e.projectableNodes||void 0}),this.setDisposeFn(()=>t.destroy())}else{let n=this._appRef,o=e.injector||this._defaultInjector||He.NULL,r=o.get(Tr,n.injector);t=Rp(e.component,{elementInjector:o,environmentInjector:r,projectableNodes:e.projectableNodes||void 0}),n.attachView(t.hostView),this.setDisposeFn(()=>{n.viewCount>0&&n.detachView(t.hostView),t.destroy()})}return this.outletElement.appendChild(this._getComponentRootNode(t)),this._attachedPortal=e,t}attachTemplatePortal(e){let t=e.viewContainerRef,n=t.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return n.rootNodes.forEach(o=>this.outletElement.appendChild(o)),n.detectChanges(),this.setDisposeFn(()=>{let o=t.indexOf(n);o!==-1&&t.remove(o)}),this._attachedPortal=e,n}attachDomPortal=e=>{let t=e.element;t.parentNode;let n=this.outletElement.ownerDocument.createComment("dom-portal");t.parentNode.insertBefore(n,t),this.outletElement.appendChild(t),this._attachedPortal=e,super.setDisposeFn(()=>{n.parentNode&&n.parentNode.replaceChild(t,n)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}};var iu=(()=>{class i extends Ei{_moduleRef=J(od,{optional:!0});_document=J(St);_viewContainerRef=J(id);_isInitialized=!1;_attachedRef;constructor(){super()}get portal(){return this._attachedPortal}set portal(t){this.hasAttached()&&!t&&!this._isInitialized||(this.hasAttached()&&super.detach(),t&&super.attach(t),this._attachedPortal=t||null)}attached=new kr;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(t){t.setAttachedHost(this);let n=t.viewContainerRef!=null?t.viewContainerRef:this._viewContainerRef,o=n.createComponent(t.component,{index:n.length,injector:t.injector||n.injector,projectableNodes:t.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return n!==this._viewContainerRef&&this._getRootNode().appendChild(o.hostView.rootNodes[0]),super.setDisposeFn(()=>o.destroy()),this._attachedPortal=t,this._attachedRef=o,this.attached.emit(o),o}attachTemplatePortal(t){t.setAttachedHost(this);let n=this._viewContainerRef.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=t,this._attachedRef=n,this.attached.emit(n),n}attachDomPortal=t=>{let n=t.element;n.parentNode;let o=this._document.createComment("dom-portal");t.setAttachedHost(this),n.parentNode.insertBefore(o,n),this._getRootNode().appendChild(n),this._attachedPortal=t,super.setDisposeFn(()=>{o.parentNode&&o.parentNode.replaceChild(n,o)})};_getRootNode(){let t=this._viewContainerRef.element.nativeElement;return t.nodeType===t.ELEMENT_NODE?t:t.parentNode}static \u0275fac=function(n){return new(n||i)};static \u0275dir=pn({type:i,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Dr]})}return i})();var ss=class{enable(){}disable(){}attach(){}};var Ti=class{positionStrategy;scrollStrategy=new ss;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";disableAnimations;width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;constructor(e){if(e){let t=Object.keys(e);for(let n of t)e[n]!==void 0&&(this[n]=e[n])}}};var b0=(()=>{class i{_attachedOverlays=[];_document=J(St);_isAttached;constructor(){}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){let n=this._attachedOverlays.indexOf(t);n>-1&&this._attachedOverlays.splice(n,1),this._attachedOverlays.length===0&&this.detach()}static \u0275fac=function(n){return new(n||i)};static \u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),w0=(()=>{class i extends b0{_ngZone=J(it);_renderer=J(Wn).createRenderer(null,null);_cleanupKeydown;add(t){super.add(t),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=t=>{let n=this._attachedOverlays;for(let o=n.length-1;o>-1;o--)if(n[o]._keydownEvents.observers.length>0){this._ngZone.run(()=>n[o]._keydownEvents.next(t));break}};static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ir(i)))(o||i)}})();static \u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),x0=(()=>{class i extends b0{_platform=J(mo);_ngZone=J(it);_renderer=J(Wn).createRenderer(null,null);_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget;_cleanups;add(t){if(super.add(t),!this._isAttached){let n=this._document.body,o={capture:!0},r=this._renderer;this._cleanups=this._ngZone.runOutsideAngular(()=>[r.listen(n,"pointerdown",this._pointerDownListener,o),r.listen(n,"click",this._clickListener,o),r.listen(n,"auxclick",this._clickListener,o),r.listen(n,"contextmenu",this._clickListener,o)]),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=n.style.cursor,n.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){this._isAttached&&(this._cleanups?.forEach(t=>t()),this._cleanups=void 0,this._platform.IOS&&this._cursorStyleIsSet&&(this._document.body.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1)}_pointerDownListener=t=>{this._pointerDownEventTarget=gd(t)};_clickListener=t=>{let n=gd(t),o=t.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:n;this._pointerDownEventTarget=null;let r=this._attachedOverlays.slice();for(let s=r.length-1;s>-1;s--){let d=r[s];if(d._outsidePointerEvents.observers.length<1||!d.hasAttached())continue;if(m0(d.overlayElement,n)||m0(d.overlayElement,o))break;let c=d._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>c.next(t)):c.next(t)}};static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ir(i)))(o||i)}})();static \u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function m0(i,e){let t=typeof ShadowRoot<"u"&&ShadowRoot,n=e;for(;n;){if(n===i)return!0;n=t&&n instanceof ShadowRoot?n.host:n.parentNode}return!1}var A0=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275cmp=Ke({type:i,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(n,o){},styles:[`.cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0;touch-action:manipulation}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}@media(prefers-reduced-motion){.cdk-overlay-backdrop{transition-duration:1ms}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}
`],encapsulation:2,changeDetection:0})}return i})(),gx=(()=>{class i{_platform=J(mo);_containerElement;_document=J(St);_styleLoader=J(fd);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t="cdk-overlay-container";if(this._platform.isBrowser||md()){let o=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let r=0;r<o.length;r++)o[r].remove()}let n=this._document.createElement("div");n.classList.add(t),md()?n.setAttribute("platform","test"):this._platform.isBrowser||n.setAttribute("platform","server"),this._document.body.appendChild(n),this._containerElement=n}_loadStyles(){this._styleLoader.load(A0)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ou=class{_renderer;_ngZone;element;_cleanupClick;_cleanupTransitionEnd;_fallbackTimeout;constructor(e,t,n,o){this._renderer=t,this._ngZone=n,this.element=e.createElement("div"),this.element.classList.add("cdk-overlay-backdrop"),this._cleanupClick=t.listen(this.element,"click",o)}detach(){this._ngZone.runOutsideAngular(()=>{let e=this.element;clearTimeout(this._fallbackTimeout),this._cleanupTransitionEnd?.(),this._cleanupTransitionEnd=this._renderer.listen(e,"transitionend",this.dispose),this._fallbackTimeout=setTimeout(this.dispose,500),e.style.pointerEvents="none",e.classList.remove("cdk-overlay-backdrop-showing")})}dispose=()=>{clearTimeout(this._fallbackTimeout),this._cleanupClick?.(),this._cleanupTransitionEnd?.(),this._cleanupClick=this._cleanupTransitionEnd=this._fallbackTimeout=void 0,this.element.remove()}},ds=class{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropClick=new qe;_attachments=new qe;_detachments=new qe;_positionStrategy;_scrollStrategy;_locationChanges=_p.EMPTY;_backdropRef=null;_detachContentMutationObserver;_detachContentAfterRenderRef;_previousHostParent;_keydownEvents=new qe;_outsidePointerEvents=new qe;_afterNextRenderRef;constructor(e,t,n,o,r,s,d,c,u,p=!1,f,v){this._portalOutlet=e,this._host=t,this._pane=n,this._config=o,this._ngZone=r,this._keyboardDispatcher=s,this._document=d,this._location=c,this._outsideClickDispatcher=u,this._animationsDisabled=p,this._injector=f,this._renderer=v,o.scrollStrategy&&(this._scrollStrategy=o.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=o.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropRef?.element||null}get hostElement(){return this._host}attach(e){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let t=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=Gn(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._completeDetachContent(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof t?.onDestroy=="function"&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let e=this._portalOutlet.detach();return this._detachments.next(),this._completeDetachContent(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){let e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._backdropRef?.dispose(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=this._backdropRef=null,e&&this._detachments.next(),this._detachments.complete(),this._completeDetachContent()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config=Oe(Oe({},this._config),e),this._updateElementSize()}setDirection(e){this._config=co(Oe({},this._config),{direction:e}),this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){let e=this._config.direction;return e?typeof e=="string"?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let e=this._pane.style;e.width=vn(this._config.width),e.height=vn(this._config.height),e.minWidth=vn(this._config.minWidth),e.minHeight=vn(this._config.minHeight),e.maxWidth=vn(this._config.maxWidth),e.maxHeight=vn(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){let e="cdk-overlay-backdrop-showing";this._backdropRef?.dispose(),this._backdropRef=new ou(this._document,this._renderer,this._ngZone,t=>{this._backdropClick.next(t)}),this._animationsDisabled&&this._backdropRef.element.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropRef.element,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropRef.element,this._host),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._backdropRef?.element.classList.add(e))}):this._backdropRef.element.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){this._animationsDisabled?(this._backdropRef?.dispose(),this._backdropRef=null):this._backdropRef?.detach()}_toggleClasses(e,t,n){let o=qp(t||[]).filter(r=>!!r);o.length&&(n?e.classList.add(...o):e.classList.remove(...o))}_detachContentWhenEmpty(){let e=!1;try{this._detachContentAfterRenderRef=Gn(()=>{e=!0,this._detachContent()},{injector:this._injector})}catch(t){if(e)throw t;this._detachContent()}globalThis.MutationObserver&&this._pane&&(this._detachContentMutationObserver||=new globalThis.MutationObserver(()=>{this._detachContent()}),this._detachContentMutationObserver.observe(this._pane,{childList:!0}))}_detachContent(){(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),this._completeDetachContent())}_completeDetachContent(){this._detachContentAfterRenderRef?.destroy(),this._detachContentAfterRenderRef=void 0,this._detachContentMutationObserver?.disconnect()}_disposeScrollStrategy(){let e=this._scrollStrategy;e?.disable(),e?.detach?.()}};var v0="cdk-global-overlay-wrapper";function ru(i){return new ls}var ls=class{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(e){let t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(v0),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._xOffset=e,this._xPosition="left",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._xOffset=e,this._xPosition="right",this}start(e=""){return this._xOffset=e,this._xPosition="start",this}end(e=""){return this._xOffset=e,this._xPosition="end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._xPosition="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig(),{width:o,height:r,maxWidth:s,maxHeight:d}=n,c=(o==="100%"||o==="100vw")&&(!s||s==="100%"||s==="100vw"),u=(r==="100%"||r==="100vh")&&(!d||d==="100%"||d==="100vh"),p=this._xPosition,f=this._xOffset,v=this._overlayRef.getConfig().direction==="rtl",_="",T="",k="";c?k="flex-start":p==="center"?(k="center",v?T=f:_=f):v?p==="left"||p==="end"?(k="flex-end",_=f):(p==="right"||p==="start")&&(k="flex-start",T=f):p==="left"||p==="start"?(k="flex-start",_=f):(p==="right"||p==="end")&&(k="flex-end",T=f),e.position=this._cssPosition,e.marginLeft=c?"0":_,e.marginTop=u?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=c?"0":T,t.justifyContent=k,t.alignItems=u?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,n=t.style;t.classList.remove(v0),n.justifyContent=n.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}};function au(i,e){i.get(fd).load(A0);let t=i.get(gx),n=i.get(St),o=i.get(Rr),r=i.get(Vp),s=i.get(Kp),d=n.createElement("div"),c=n.createElement("div");c.id=o.getId("cdk-overlay-"),c.classList.add("cdk-overlay-pane"),d.appendChild(c),t.getContainerElement().appendChild(d);let u=new as(c,r,i),p=new Ti(e),f=i.get(nd,null,{optional:!0})||i.get(Wn).createRenderer(null,null);return p.direction=p.direction||s.value,new ds(u,d,c,p,i.get(it),i.get(w0),n,i.get(Np),i.get(x0),e?.disableAnimations??i.get(Bp,null,{optional:!0})==="NoopAnimations",i.get(Tr),f)}function mx(i,e){if(i&1){let t=Kn();de(0,"div",1)(1,"button",2),ht("click",function(){un(t);let o=ot();return hn(o.action())}),pe(2),le()()}if(i&2){let t=ot();xe(2),Qt(" ",t.data.action," ")}}var vx=["label"];function bx(i,e){}var wx=Math.pow(2,31)-1,jo=class{_overlayRef;instance;containerInstance;_afterDismissed=new qe;_afterOpened=new qe;_onAction=new qe;_durationTimeoutId;_dismissedByAction=!1;constructor(e,t){this._overlayRef=t,this.containerInstance=e,e._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(e){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(e,wx))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},y0=new Ut("MatSnackBarData"),Pi=class{politeness="polite";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"},xx=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275dir=pn({type:i,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return i})(),Ax=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275dir=pn({type:i,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return i})(),yx=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275dir=pn({type:i,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return i})(),Cx=(()=>{class i{snackBarRef=J(jo);data=J(y0);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=Ke({type:i,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["matButton","","matSnackBarAction","",3,"click"]],template:function(n,o){n&1&&(de(0,"div",0),pe(1),le(),gn(2,mx,3,1,"div",1)),n&2&&(xe(),Qt(" ",o.data.message,`
`),xe(),fn(o.hasAction?2:-1))},dependencies:[Nr,xx,Ax,yx],styles:[`.mat-mdc-simple-snack-bar{display:flex}.mat-mdc-simple-snack-bar .mat-mdc-snack-bar-label{max-height:50vh;overflow:auto}
`],encapsulation:2,changeDetection:0})}return i})(),su="_mat-snack-bar-enter",du="_mat-snack-bar-exit",_x=(()=>{class i extends Ei{_ngZone=J(it);_elementRef=J(qn);_changeDetectorRef=J(pd);_platform=J(mo);_animationsDisabled=vd();snackBarConfig=J(Pi);_document=J(St);_trackedModals=new Set;_enterFallback;_exitFallback;_injector=J(He);_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new qe;_onExit=new qe;_onEnter=new qe;_animationState="void";_live;_label;_role;_liveElementId=J(Rr).getId("mat-snack-bar-container-live-");constructor(){super();let t=this.snackBarConfig;t.politeness==="assertive"&&!t.announcementMessage?this._live="assertive":t.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(t){this._assertNotAttached();let n=this._portalOutlet.attachComponentPortal(t);return this._afterPortalAttached(),n}attachTemplatePortal(t){this._assertNotAttached();let n=this._portalOutlet.attachTemplatePortal(t);return this._afterPortalAttached(),n}attachDomPortal=t=>{this._assertNotAttached();let n=this._portalOutlet.attachDomPortal(t);return this._afterPortalAttached(),n};onAnimationEnd(t){t===du?this._completeExit():t===su&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?Gn(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(su)))},{injector:this._injector}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd(su)},200)))}exit(){return this._destroyed?Sr(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?Gn(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(du)))},{injector:this._injector}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd(du),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let t=this._elementRef.nativeElement,n=this.snackBarConfig.panelClass;n&&(Array.isArray(n)?n.forEach(s=>t.classList.add(s)):t.classList.add(n)),this._exposeToModals();let o=this._label.nativeElement,r="mdc-snackbar__label";o.classList.toggle(r,!o.querySelector(`.${r}`))}_exposeToModals(){let t=this._liveElementId,n=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let o=0;o<n.length;o++){let r=n[o],s=r.getAttribute("aria-owns");this._trackedModals.add(r),s?s.indexOf(t)===-1&&r.setAttribute("aria-owns",s+" "+t):r.setAttribute("aria-owns",t)}}_clearFromModals(){this._trackedModals.forEach(t=>{let n=t.getAttribute("aria-owns");if(n){let o=n.replace(this._liveElementId,"").trim();o.length>0?t.setAttribute("aria-owns",o):t.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;let t=this._elementRef.nativeElement,n=t.querySelector("[aria-hidden]"),o=t.querySelector("[aria-live]");if(n&&o){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&n.contains(document.activeElement)&&(r=document.activeElement),n.removeAttribute("aria-hidden"),o.appendChild(n),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=Ke({type:i,selectors:[["mat-snack-bar-container"]],viewQuery:function(n,o){if(n&1&&(Vr(iu,7),Vr(vx,7)),n&2){let r;Mr(r=Lr())&&(o._portalOutlet=r.first),Mr(r=Lr())&&(o._label=r.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(n,o){n&1&&ht("animationend",function(s){return o.onAnimationEnd(s.animationName)})("animationcancel",function(s){return o.onAnimationEnd(s.animationName)}),n&2&&Yn("mat-snack-bar-container-enter",o._animationState==="visible")("mat-snack-bar-container-exit",o._animationState==="hidden")("mat-snack-bar-container-animations-enabled",!o._animationsDisabled)},features:[Dr],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(n,o){n&1&&(de(0,"div",1)(1,"div",2,0)(3,"div",3),rd(4,bx,0,0,"ng-template",4),le(),mn(5,"div"),le()()),n&2&&(xe(5),ad("aria-live",o._live)("role",o._role)("id",o._liveElementId))},dependencies:[iu],styles:[`@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mat-snack-bar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mat-snack-bar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-snack-bar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mat-snack-bar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-snack-bar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mat-snack-bar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mat-snack-bar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-button-text-state-layer-color: currentColor;--mat-button-text-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}
`],encapsulation:2})}return i})();function Sx(){return new Pi}var Ex=new Ut("mat-snack-bar-default-options",{providedIn:"root",factory:Sx}),C0=(()=>{class i{_live=J(Wp);_injector=J(He);_breakpointObserver=J(Gp);_parentSnackBar=J(i,{optional:!0,skipSelf:!0});_defaultConfig=J(Ex);_animationsDisabled=vd();_snackBarRefAtThisLevel=null;simpleSnackBarComponent=Cx;snackBarContainerComponent=_x;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){let t=this._parentSnackBar;return t?t._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(t){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=t:this._snackBarRefAtThisLevel=t}constructor(){}openFromComponent(t,n){return this._attach(t,n)}openFromTemplate(t,n){return this._attach(t,n)}open(t,n="",o){let r=Oe(Oe({},this._defaultConfig),o);return r.data={message:t,action:n},r.announcementMessage===t&&(r.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,r)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(t,n){let o=n&&n.viewContainerRef&&n.viewContainerRef.injector,r=He.create({parent:o||this._injector,providers:[{provide:Pi,useValue:n}]}),s=new _i(this.snackBarContainerComponent,n.viewContainerRef,r),d=t.attach(s);return d.instance.snackBarConfig=n,d.instance}_attach(t,n){let o=Oe(Oe(Oe({},new Pi),this._defaultConfig),n),r=this._createOverlay(o),s=this._attachSnackBarContainer(r,o),d=new jo(s,r);if(t instanceof go){let c=new Si(t,null,{$implicit:o.data,snackBarRef:d});d.instance=s.attachTemplatePortal(c)}else{let c=this._createInjector(o,d),u=new _i(t,void 0,c),p=s.attachComponentPortal(u);d.instance=p.instance}return this._breakpointObserver.observe(Zp.HandsetPortrait).pipe(Ip(r.detachments())).subscribe(c=>{r.overlayElement.classList.toggle(this.handsetCssClass,c.matches)}),o.announcementMessage&&s._onAnnounce.subscribe(()=>{this._live.announce(o.announcementMessage,o.politeness)}),this._animateSnackBar(d,o),this._openedSnackBarRef=d,this._openedSnackBarRef}_animateSnackBar(t,n){t.afterDismissed().subscribe(()=>{this._openedSnackBarRef==t&&(this._openedSnackBarRef=null),n.announcementMessage&&this._live.clear()}),n.duration&&n.duration>0&&t.afterOpened().subscribe(()=>t._dismissAfter(n.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{t.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):t.containerInstance.enter()}_createOverlay(t){let n=new Ti;n.direction=t.direction;let o=ru(this._injector),r=t.direction==="rtl",s=t.horizontalPosition==="left"||t.horizontalPosition==="start"&&!r||t.horizontalPosition==="end"&&r,d=!s&&t.horizontalPosition!=="center";return s?o.left("0"):d?o.right("0"):o.centerHorizontally(),t.verticalPosition==="top"?o.top("0"):o.bottom("0"),n.positionStrategy=o,n.disableAnimations=this._animationsDisabled,au(this._injector,n)}_createInjector(t,n){let o=t&&t.viewContainerRef&&t.viewContainerRef.injector;return He.create({parent:o||this._injector,providers:[{provide:jo,useValue:n},{provide:y0,useValue:t.data}]})}static \u0275fac=function(n){return new(n||i)};static \u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var cs=class i{constructor(e){this.snackBar$=e}error(e,t=5e3){return this.snackBar$.open(e,"error",{duration:t,horizontalPosition:"right",verticalPosition:"bottom",panelClass:["snackbar-error"]})}success(e,t=2e3){return this.snackBar$.open(e,"success",{duration:t,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["snackbar-success"]})}info(e,t=2e3){return this.snackBar$.open(e,"info",{duration:t,horizontalPosition:"right",verticalPosition:"bottom",panelClass:["snackbar-info"]})}static \u0275fac=function(t){return new(t||i)(_t(C0))};static \u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ix=(i,e)=>e.id;function kx(i,e){if(i&1){let t=Kn();de(0,"div",14)(1,"span",15),ht("click",function(){let o=un(t).$implicit,r=ot();return hn(r.selectNote(o))}),pe(2),le(),de(3,"button",16),ht("click",function(){let o=un(t).$implicit,r=ot();return hn(r.onDelete(o.id))}),de(4,"mat-icon"),pe(5,"delete"),le()()()}if(i&2){let t=e.$implicit,n=ot();Yn("selected",t.id===(n.selectedNote==null?null:n.selectedNote.id)),xe(2),Qt(" ",t.title," ")}}function Dx(i,e){i&1&&(de(0,"p"),pe(1,"\uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."),le())}function Bx(i,e){if(i&1&&(de(0,"mat-error"),pe(1),le()),i&2){let t=ot();xe(),ld(t.getErrorMsg("title"))}}function Vx(i,e){if(i&1){let t=Kn();de(0,"button",17),ht("click",function(){un(t);let o=ot();return hn(o.startAddMode())}),pe(1," \uCDE8\uC18C \uBC0F \uC0C8 \uB178\uD2B8 \uC791\uC131 "),le()}}function Mx(i,e){if(i&1&&(de(0,"div",13),pe(1),le()),i&2){let t=ot();xe(),Qt(" ",t.statusMessage," ")}}var us=class i{constructor(e,t,n,o){this.screenService=e;this.eventService=t;this.noteService$=n;this.snackBar$=o;this.isSmallScreen$=this.screenService.isSmallScreen.pipe(Tp({bufferSize:1,refCount:!0})),this.isSmallScreen$.subscribe(r=>{this.isMobile=r,this.isNoteListOpen=!r,console.log("note-mgt",r)}),this.notes$=n.getNotes(),this.eventSubscription=this.eventService.getButtonClickEvent().subscribe(()=>{this.isNoteListOpen=!this.isNoteListOpen,console.log("receive event"),console.log("note-mgt",this.isNoteListOpen)})}isSmallScreen$;isMobile=!1;isNoteListOpen=!1;eventSubscription;notes$;selectedNote=null;noteForm=new _g({title:new Cd("",[yd.required,yd.maxLength(50)]),content:new Cd("")});statusMessage=null;ngOnDestroy(){this.eventSubscription&&this.eventSubscription.unsubscribe()}initForm(e){this.noteForm.get("title")?.setValue(e?.title),this.noteForm.get("content")?.setValue(e?.content)}selectNote(e){this.statusMessage="",this.selectedNote=e,this.isNoteListOpen=!this.isNoteListOpen,this.initForm(e)}startAddMode(){this.selectedNote=null,this.initForm()}onSubmit(){return B(this,null,function*(){if(this.noteForm.invalid){this.noteForm.markAllAsTouched();return}let{title:e,content:t}=this.noteForm.value;try{this.selectedNote&&this.selectedNote.id?(yield this.noteService$.updateNote(this.selectedNote.id,{title:e,content:t}),this.snackBar$.success("\uB178\uD2B8\uAC00 \uC218\uC815\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")):(yield this.noteService$.addNote({title:e,content:t}),this.snackBar$.success("\uC0C8 \uB178\uD2B8\uAC00 \uCD94\uAC00\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")),this.startAddMode()}catch{this.snackBar$.error("\uC0C8 \uB178\uD2B8\uAC00 \uCD94\uAC00\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}})}onDelete(e){return B(this,null,function*(){if(confirm("\uC774 \uB178\uD2B8\uB97C \uC815\uB9D0\uB85C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?"))try{yield this.noteService$.deleteNote(e),this.snackBar$.success("\uB178\uD2B8\uAC00 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),this.selectedNote?.id===e&&this.startAddMode()}catch(t){this.snackBar$.success(`\uC0AD\uC81C \uC911 \uC624\uB958 \uBC1C\uC0DD: ${t}`)}})}getErrorMsg(e){let t=this.noteForm.get(e);var n,o;return t?.hasError("maxlength")&&(n=t.errors?.maxlength.requiredLength),t?.hasError("minlength")&&(n=t.errors?.minlength.requiredLength),t?.hasError("required")?"This field is required ":t?.hasError("pattern")?"This field needs to be at least nine characters, one uppercase letter and at least 1 symbol":t?.hasError("email")?"Not a valid email":t?.hasError("minlength")?`This field must be at least ${o} characters long `:t?.hasError("maxlength")?`This field can be max ${n} characters long.`:""}static \u0275fac=function(t){return new(t||i)(Zn(Xp),Zn($p),Zn(rs),Zn(cs))};static \u0275cmp=Ke({type:i,selectors:[["app-note-mgt"]],decls:31,vars:11,consts:[[1,"top-container"],[1,"note-list-container"],[3,"click"],[1,"note-list-item",3,"selected"],[1,"note-content-container"],[1,"note-form",3,"ngSubmit","formGroup"],["for","title"],["id","title","type","text","formControlName","title","placeholder","\uB178\uD2B8 \uC81C\uBAA9\uC744 \uC785\uB825\uD558\uC138\uC694 (\uD544\uC218)",1,"form-control"],["for","content"],["id","content","formControlName","content","rows","30","placeholder","\uB178\uD2B8 \uB0B4\uC6A9\uC744 \uC785\uB825\uD558\uC138\uC694",1,"form-control"],[1,"button-group"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"btn","btn-secondary"],[1,"alert","alert-danger","validation-error"],[1,"note-list-item"],[1,"note-title",3,"click"],["mat-button","",3,"click"],[1,"btn","btn-secondary",3,"click"]],template:function(t,n){t&1&&(de(0,"div",0)(1,"div",1)(2,"h3")(3,"mat-icon"),pe(4,"event_note"),le(),de(5,"span"),pe(6,"\uB0B4 \uB178\uD2B8 \uBAA9\uB85D"),le()(),de(7,"button",2),ht("click",function(){return n.startAddMode()}),de(8,"mat-icon"),pe(9,"note_add"),le(),de(10,"span"),pe(11,"\uC0C8 \uB178\uD2B8 \uC791\uC131"),le()(),sd(12,kx,6,3,"div",3,Ix,!1,Dx,2,0,"p"),cd(15,"async"),le(),de(16,"div",4)(17,"form",5),ht("ngSubmit",function(){return n.onSubmit()}),de(18,"label",6),pe(19,"\uC81C\uBAA9"),le(),mn(20,"input",7),gn(21,Bx,2,1,"mat-error"),de(22,"label",8),pe(23,"\uB0B4\uC6A9"),le(),de(24,"textarea",9),pe(25,"            "),le(),de(26,"div",10)(27,"button",11),pe(28),le(),gn(29,Vx,2,0,"button",12),gn(30,Mx,2,1,"div",13),le()()()()),t&2&&(xe(),Yn("is-open",n.isNoteListOpen),xe(11),dd(ud(15,9,n.notes$)),xe(5),Br("formGroup",n.noteForm),xe(4),fn(n.noteForm.controls.title.invalid&&(n.noteForm.controls.title.dirty||n.noteForm.controls.title.touched)?21:-1),xe(6),Br("disabled",n.noteForm.invalid),xe(),Qt(" ",n.selectedNote?"\uC218\uC815 \uC0AC\uD56D \uC800\uC7A5":"\uB178\uD2B8 \uCD94\uAC00"," "),xe(),fn(n.selectedNote?29:-1),xe(),fn(n.statusMessage?30:-1))},dependencies:[Fr,bd,Nr,Jp,Yp,kg,Ig,aa,Sg,Ag,yg,Cg,Pg,Eg,Tg,Op],styles:[".top-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100vh}.note-list-container[_ngcontent-%COMP%]{width:280px;border-radius:2px;border-right:1px solid lightgrey;display:flex;flex-direction:column;padding:0 5px}.note-content-container[_ngcontent-%COMP%]{flex-grow:1}@media (max-width: 768px){.note-list-container[_ngcontent-%COMP%]{position:fixed;top:64px;left:10px;height:85vh;z-index:100;background-color:#fff;transform:translate(-120%);transition:transform .3s ease-in-out;flex-shrink:unset}.note-list-container.is-open[_ngcontent-%COMP%]{transform:translate(0)}}.note-list-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px;border-bottom:1px solid #eee;cursor:pointer;transition:background-color .2s}.note-title[_ngcontent-%COMP%]{flex-grow:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding:4px}.note-list-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.note-list-item.selected[_ngcontent-%COMP%]{background-color:#e0f7fa;border-left:5px solid #00bcd4}.note-list-container[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px}.note-list-container[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:10px;border:none;background-color:#007bff;color:#fff;border-radius:4px;cursor:pointer;margin-bottom:5px}.note-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:10px}.note-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:700}.form-control[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:8px;width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;box-sizing:border-box}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.button-group[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:16px}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:disabled{background-color:#a0c9f1;cursor:not-allowed}.validation-error[_ngcontent-%COMP%]{color:#dc3545;font-size:.9em;margin-top:5px}"]})};var lu=(i,e)=>{let t=J(Up),n=J(mg);return bg(n).pipe(Ep(1),uo(o=>o?(console.log("Auth Guard: Access Granted."),!0):(console.log("Auth Guard: Access Denied. Redirecting to login..."),t.navigate(["/auth/login"],{skipLocationChange:!0}),!1)))};var _0=[{path:"",component:xg,children:[{path:"file-viewer",component:sa,canActivate:[lu]},{path:"note-mgt",component:us,canActivate:[lu]}]},{path:"auth",loadChildren:()=>import("./chunk-CBHX4OBN.js").then(i=>i.AuthModule)}];var cu={production:!0,googleMapKey:"AIzaSyBb5jBpNLfyeBqj_tjhB1r4sexvqUVZx6s",firebase:{apiKey:"AIzaSyBduY6Or0tHP8DALAMwrWxpo_tNKpgf7Ls",authDomain:"my-memo-3a2c4.firebaseapp.com",databaseURL:"https://my-memo-3a2c4-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"my-memo-3a2c4",storageBucket:"my-memo-3a2c4.firebasestorage.app",messagingSenderId:"639616505173",appId:"1:639616505173:web:99c36a725a46a2bbf1cbdc",measurementId:"G-1H60CMJSJR"},disableConsoleLog:()=>{cu.production&&(console.log=function(){},console.warn=function(){},console.info=function(){})}};var S0="@firebase/database",E0="1.0.20";var dh="";function Lx(i){dh=i}var bu=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ae(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ur(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var wu=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return gt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var ov=function(i){try{if(typeof window<"u"&&typeof window[i]<"u"){let e=window[i];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new bu(e)}}catch{}return new wu},Ln=ov("localStorage"),xu=ov("sessionStorage");var Bi=new Gr("@firebase/database"),Fx=(function(){let i=1;return function(){return i++}})(),rv=function(i){let e=hg(i),t=new cg;t.update(e);let n=t.digest();return eg.encodeByteArray(n)},tr=function(...i){let e="";for(let t=0;t<i.length;t++){let n=i[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=tr.apply(null,n):typeof n=="object"?e+=Ae(n):e+=n,e+=" "}return e},Fn=null,T0=!0,Rx=function(i,e){M(!e||i===!0||i===!1,"Can't turn on custom loggers persistently."),i===!0?(Bi.logLevel=Ye.VERBOSE,Fn=Bi.log.bind(Bi),e&&xu.set("logging_enabled",!0)):typeof i=="function"?Fn=i:(Fn=null,xu.remove("logging_enabled"))},Ve=function(...i){if(T0===!0&&(T0=!1,Fn===null&&xu.get("logging_enabled")===!0&&Rx(!0)),Fn){let e=tr.apply(null,i);Fn(e)}},nr=function(i){return function(...e){Ve(i,...e)}},Au=function(...i){let e="FIREBASE INTERNAL ERROR: "+tr(...i);Bi.error(e)},Ft=function(...i){let e=`FIREBASE FATAL ERROR: ${tr(...i)}`;throw Bi.error(e),new Error(e)},Ze=function(...i){let e="FIREBASE WARNING: "+tr(...i);Bi.warn(e)},Nx=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ze("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},av=function(i){return typeof i=="number"&&(i!==i||i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY)},Ox=function(i){if(pt()||document.readyState==="complete")i();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,i())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Mi="[MIN_NAME]",Rn="[MAX_NAME]",Hi=function(i,e){if(i===e)return 0;if(i===Mi||e===Rn)return-1;if(e===Mi||i===Rn)return 1;{let t=P0(i),n=P0(e);return t!==null?n!==null?t-n===0?i.length-e.length:t-n:-1:n!==null?1:i<e?-1:1}},zx=function(i,e){return i===e?0:i<e?-1:1},Uo=function(i,e){if(e&&i in e)return e[i];throw new Error("Missing required key ("+i+") in object: "+Ae(e))},lh=function(i){if(typeof i!="object"||i===null)return Ae(i);let e=[];for(let n in i)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=Ae(e[n]),t+=":",t+=lh(i[e[n]]);return t+="}",t},sv=function(i,e){let t=i.length;if(t<=e)return[i];let n=[];for(let o=0;o<t;o+=e)o+e>t?n.push(i.substring(o,t)):n.push(i.substring(o,o+e));return n};function tt(i,e){for(let t in i)i.hasOwnProperty(t)&&e(t,i[t])}var dv=function(i){M(!av(i),"Invalid JSON number");let e=11,t=52,n=(1<<e-1)-1,o,r,s,d,c;i===0?(r=0,s=0,o=1/i===-1/0?1:0):(o=i<0,i=Math.abs(i),i>=Math.pow(2,1-n)?(d=Math.min(Math.floor(Math.log(i)/Math.LN2),n),r=d+n,s=Math.round(i*Math.pow(2,t-d)-Math.pow(2,t))):(r=0,s=Math.round(i/Math.pow(2,1-n-t))));let u=[];for(c=t;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);for(c=e;c;c-=1)u.push(r%2?1:0),r=Math.floor(r/2);u.push(o?1:0),u.reverse();let p=u.join(""),f="";for(c=0;c<64;c+=8){let v=parseInt(p.substr(c,8),2).toString(16);v.length===1&&(v="0"+v),f=f+v}return f.toLowerCase()},Hx=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},jx=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};var Ux=new RegExp("^-?(0*)\\d{1,10}$"),Qx=-2147483648,qx=2147483647,P0=function(i){if(Ux.test(i)){let e=Number(i);if(e>=Qx&&e<=qx)return e}return null},ir=function(i){try{i()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Ze("Exception was thrown by user callback.",t),e},Math.floor(0))}},Gx=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Zo=function(i,e){let t=setTimeout(i,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var yu=class{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Kr(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){Ze(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Cu=class{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(o=>this.auth_=o)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ve("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ze(e)}},Ko=(()=>{class i{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}i.OWNER="owner";return i})(),ps="5",lv="v",cv="s",uv="r",hv="f",pv=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,gv="ls",fv="p",_u="ac",mv="websocket",vv="long_polling";var gs=class{constructor(e,t,n,o,r=!1,s="",d=!1,c=!1,u=null){this.secure=t,this.namespace=n,this.webSocketOnly=o,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=d,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ln.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ln.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function Wx(i){return i.host!==i.internalHost||i.isCustomHost()||i.includeNamespaceInQueryParams}function bv(i,e,t){M(typeof e=="string","typeof type must == string"),M(typeof t=="object","typeof params must == object");let n;if(e===mv)n=(i.secure?"wss://":"ws://")+i.internalHost+"/.ws?";else if(e===vv)n=(i.secure?"https://":"http://")+i.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Wx(i)&&(t.ns=i.namespace);let o=[];return tt(t,(r,s)=>{o.push(r+"="+s)}),n+o.join("&")}var Su=class{constructor(){this.counters_={}}incrementCounter(e,t=1){gt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ng(this.counters_)}};var uu={},hu={};function ch(i){let e=i.toString();return uu[e]||(uu[e]=new Su),uu[e]}function Zx(i,e){let t=i.toString();return hu[t]||(hu[t]=e()),hu[t]}var Eu=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let o=0;o<n.length;++o)n[o]&&ir(()=>{this.onMessage_(n[o])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var I0="start",Kx="close",Yx="pLPCommand",Jx="pRTLPCB",wv="id",xv="pw",Av="ser",Xx="cb",$x="seg",eA="ts",tA="d",nA="dframe",yv=1870,Cv=30,iA=yv-Cv,oA=25e3,rA=3e4,Tu=class i{constructor(e,t,n,o,r,s,d){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=o,this.authToken=r,this.transportSessionId=s,this.lastSessionId=d,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=nr(e),this.stats_=ch(t),this.urlFn=c=>(this.appCheckToken&&(c[_u]=this.appCheckToken),bv(t,vv,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Eu(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(rA)),Ox(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Pu((...r)=>{let[s,d,c,u,p]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,s===I0)this.id=d,this.password=c;else if(s===Kx)d?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(d,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+s)},(...r)=>{let[s,d]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(s,d)},()=>{this.onClosed_()},this.urlFn);let n={};n[I0]="t",n[Av]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[Xx]=this.scriptTagHolder.uniqueCallbackIdentifier),n[lv]=ps,this.transportSessionId&&(n[cv]=this.transportSessionId),this.lastSessionId&&(n[gv]=this.lastSessionId),this.applicationId&&(n[fv]=this.applicationId),this.appCheckToken&&(n[_u]=this.appCheckToken),typeof location<"u"&&location.hostname&&pv.test(location.hostname)&&(n[uv]=hv);let o=this.urlFn(n);this.log_("Connecting via long-poll to "+o),this.scriptTagHolder.addTag(o,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){i.forceAllow_=!0}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){return pt()?!1:i.forceAllow_?!0:!i.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Hx()&&!jx()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=Ae(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=tg(t),o=sv(n,iA);for(let r=0;r<o.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,o.length,o[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(pt())return;this.myDisconnFrame=document.createElement("iframe");let n={};n[nA]="t",n[wv]=e,n[xv]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=Ae(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Pu=class i{constructor(e,t,n,o){if(this.onDisconnect=n,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,pt())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Fx(),window[Yx+this.uniqueCallbackIdentifier]=e,window[Jx+this.uniqueCallbackIdentifier]=t,this.myIFrame=i.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let s="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(d){Ve("frame writing exception"),d.stack&&Ve(d.stack),Ve(d)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ve("No IE domain setting required")}catch{let n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[wv]=this.myID,e[xv]=this.myPW,e[Av]=this.currentSerial;let t=this.urlFn(e),n="",o=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Cv+n.length<=yv;){let s=this.pendingSegs.shift();n=n+"&"+$x+o+"="+s.seg+"&"+eA+o+"="+s.ts+"&"+tA+o+"="+s.d,o++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},o=setTimeout(n,Math.floor(oA)),r=()=>{clearTimeout(o),n()};this.addTag(e,r)}addTag(e,t){pt()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let o=n.readyState;(!o||o==="loaded"||o==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{Ve("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}};var aA=16384,sA=45e3,fs=null;typeof MozWebSocket<"u"?fs=MozWebSocket:typeof WebSocket<"u"&&(fs=WebSocket);var Qo=(()=>{class i{constructor(t,n,o,r,s,d,c){this.connId=t,this.applicationId=o,this.appCheckToken=r,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=nr(this.connId),this.stats_=ch(n),this.connURL=i.connectionURL_(n,d,c,r,o),this.nodeAdmin=n.nodeAdmin}static connectionURL_(t,n,o,r,s){let d={};return d[lv]=ps,!pt()&&typeof location<"u"&&location.hostname&&pv.test(location.hostname)&&(d[uv]=hv),n&&(d[cv]=n),o&&(d[gv]=o),r&&(d[_u]=r),s&&(d[fv]=s),bv(t,mv,d)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ln.set("previous_websocket_failure",!0);try{let o;if(pt()){let r=this.nodeAdmin?"AdminNode":"Node";o={headers:{"User-Agent":`Firebase/${ps}/${dh}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(o.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(o.headers["X-Firebase-AppCheck"]=this.appCheckToken);let s=process.env,d=this.connURL.indexOf("wss://")===0?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;d&&(o.proxy={origin:d})}this.mySock=new fs(this.connURL,[],o)}catch(o){this.log_("Error instantiating WebSocket.");let r=o.message||o.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=o=>{this.handleIncomingFrame(o)},this.mySock.onerror=o=>{this.log_("WebSocket error.  Closing connection.");let r=o.message||o.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let n=/Android ([0-9]{0,}\.[0-9]{0,})/,o=navigator.userAgent.match(n);o&&o.length>1&&parseFloat(o[1])<4.4&&(t=!0)}return!t&&fs!==null&&!i.forceDisallow_}static previouslyFailed(){return Ln.isInMemoryStorage||Ln.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ln.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let n=this.frames.join("");this.frames=null;let o=Ur(n);this.onMessage(o)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(M(this.frames===null,"We already have a frame buffer"),t.length<=6){let n=Number(t);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let n=t.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{let o=this.extractFrameCount_(n);o!==null&&this.appendFrame_(o)}}send(t){this.resetKeepAlive();let n=Ae(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let o=sv(n,aA);o.length>1&&this.sendString_(String(o.length));for(let r=0;r<o.length;r++)this.sendString_(o[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(sA))}sendString_(t){try{this.mySock.send(t)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}i.responsesRequiredToBeHealthy=2,i.healthyTimeout=3e4;return i})(),dA=(()=>{class i{static get ALL_TRANSPORTS(){return[Tu,Qo]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let n=Qo&&Qo.isAvailable(),o=n&&!Qo.previouslyFailed();if(t.webSocketOnly&&(n||Ze("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[Qo];else{let r=this.transports_=[];for(let s of i.ALL_TRANSPORTS)s&&s.isAvailable()&&r.push(s);i.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}i.globalTransportInitialized_=!1;return i})(),lA=6e4,cA=5e3,uA=10*1024,hA=100*1024,pu="t",k0="d",pA="s",D0="r",gA="e",B0="o",V0="a",M0="n",L0="p",fA="h",Iu=class{constructor(e,t,n,o,r,s,d,c,u,p){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=o,this.authToken_=r,this.onMessage_=s,this.onReady_=d,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=p,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=nr("c:"+this.id+":"),this.transportManager_=new dA(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let o=e.healthyTimeout||0;o>0&&(this.healthyTimeout_=Zo(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>hA?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>uA?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(o)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(pu in e){let t=e[pu];t===V0?this.upgradeIfSecondaryHealthy_():t===D0?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===B0&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Uo("t",e),n=Uo("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:L0,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:V0,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:M0,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Uo("t",e),n=Uo("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Uo(pu,e);if(k0 in e){let n=e[k0];if(t===fA){let o=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(o.h=this.repoInfo_.host),this.onHandshake_(o)}else if(t===M0){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let o=0;o<this.pendingDataMessages.length;++o)this.onDataMessage_(this.pendingDataMessages[o]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===pA?this.onConnectionShutdown_(n):t===D0?this.onReset_(n):t===gA?Au("Server Error: "+n):t===B0?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Au("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,o=e.h;this.sessionId=e.s,this.repoInfo_.host=o,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ps!==n&&Ze("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Zo(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(lA))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Zo(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(cA))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:L0,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ln.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var ms=class{put(e,t,n,o){}merge(e,t,n,o){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}};var vs=class{constructor(e){this.allowedEvents_=e,this.listeners_={},M(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let o=0;o<n.length;o++)n[o].callback.apply(n[o].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let o=this.getInitialEvent(e);o&&t.apply(n,o)}off(e,t,n){this.validateEventType_(e);let o=this.listeners_[e]||[];for(let r=0;r<o.length;r++)if(o[r].callback===t&&(!n||n===o[r].context)){o.splice(r,1);return}}validateEventType_(e){M(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var bs=class i extends vs{static getInstance(){return new i}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!xd()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return M(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var F0=32,R0=768,ie=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let o=0;o<this.pieces_.length;o++)this.pieces_[o].length>0&&(this.pieces_[n]=this.pieces_[o],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function te(){return new ie("")}function Z(i){return i.pieceNum_>=i.pieces_.length?null:i.pieces_[i.pieceNum_]}function an(i){return i.pieces_.length-i.pieceNum_}function re(i){let e=i.pieceNum_;return e<i.pieces_.length&&e++,new ie(i.pieces_,e)}function _v(i){return i.pieceNum_<i.pieces_.length?i.pieces_[i.pieces_.length-1]:null}function mA(i){let e="";for(let t=i.pieceNum_;t<i.pieces_.length;t++)i.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(i.pieces_[t])));return e||"/"}function Sv(i,e=0){return i.pieces_.slice(i.pieceNum_+e)}function Ev(i){if(i.pieceNum_>=i.pieces_.length)return null;let e=[];for(let t=i.pieceNum_;t<i.pieces_.length-1;t++)e.push(i.pieces_[t]);return new ie(e,0)}function _e(i,e){let t=[];for(let n=i.pieceNum_;n<i.pieces_.length;n++)t.push(i.pieces_[n]);if(e instanceof ie)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{let n=e.split("/");for(let o=0;o<n.length;o++)n[o].length>0&&t.push(n[o])}return new ie(t,0)}function G(i){return i.pieceNum_>=i.pieces_.length}function $e(i,e){let t=Z(i),n=Z(e);if(t===null)return e;if(t===n)return $e(re(i),re(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+i+")")}function Tv(i,e){if(an(i)!==an(e))return!1;for(let t=i.pieceNum_,n=e.pieceNum_;t<=i.pieces_.length;t++,n++)if(i.pieces_[t]!==e.pieces_[n])return!1;return!0}function lt(i,e){let t=i.pieceNum_,n=e.pieceNum_;if(an(i)>an(e))return!1;for(;t<i.pieces_.length;){if(i.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}var ku=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Sv(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=bo(this.parts_[n]);Pv(this)}};function vA(i,e){i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(e),i.byteLength_+=bo(e),Pv(i)}function bA(i){let e=i.parts_.pop();i.byteLength_-=bo(e),i.parts_.length>0&&(i.byteLength_-=1)}function Pv(i){if(i.byteLength_>R0)throw new Error(i.errorPrefix_+"has a key path longer than "+R0+" bytes ("+i.byteLength_+").");if(i.parts_.length>F0)throw new Error(i.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+F0+") or object contains a cycle "+Mn(i))}function Mn(i){return i.parts_.length===0?"":"in property '"+i.parts_.join(".")+"'"}var Du=class i extends vs{static getInstance(){return new i}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}getInitialEvent(e){return M(e==="visible","Unknown event type: "+e),[this.visible_]}};var qo=1e3,wA=300*1e3,N0=30*1e3,xA=1.3,AA=3e4,yA="server_kill",O0=3,uh=(()=>{class i extends ms{constructor(t,n,o,r,s,d,c,u){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=o,this.onConnectStatus_=r,this.onServerInfoUpdate_=s,this.authTokenProvider_=d,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=i.nextPersistentConnectionId_++,this.log_=nr("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=qo,this.maxReconnectDelay_=wA,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!pt())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Du.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&bs.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,o){let r=++this.requestNumber_,s={r,a:t,b:n};this.log_(Ae(s)),M(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),o&&(this.requestCBHash_[r]=o)}get(t){this.initConnection_();let n=new wd,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:d=>{let c=d.d;d.s==="ok"?n.resolve(c):n.reject(c)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),n.promise}listen(t,n,o,r){this.initConnection_();let s=t._queryIdentifier,d=t._path.toString();this.log_("Listen called for "+d+" "+s),this.listens.has(d)||this.listens.set(d,new Map),M(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),M(!this.listens.get(d).has(s),"listen() called twice for same path/queryId.");let c={onComplete:r,hashFn:n,query:t,tag:o};this.listens.get(d).set(s,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let n=this.outstandingGets_[t];this.sendRequest("g",n.request,o=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(o)})}sendListen_(t){let n=t.query,o=n._path.toString(),r=n._queryIdentifier;this.log_("Listen on "+o+" for "+r);let s={p:o},d="q";t.tag&&(s.q=n._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest(d,s,c=>{let u=c.d,p=c.s;i.warnOnListenWarnings_(u,n),(this.listens.get(o)&&this.listens.get(o).get(r))===t&&(this.log_("listen response",c),p!=="ok"&&this.removeListen_(o,r),t.onComplete&&t.onComplete(p,u))})}static warnOnListenWarnings_(t,n){if(t&&typeof t=="object"&&gt(t,"w")){let o=bn(t,"w");if(Array.isArray(o)&&~o.indexOf("no_index")){let r='".indexOn": "'+n._queryParams.getIndex().toString()+'"',s=n._path.toString();Ze(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||dg(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=N0)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,n=sg(t)?"auth":"gauth",o={cred:t};this.authOverride_===null?o.noauth=!0:typeof this.authOverride_=="object"&&(o.authvar=this.authOverride_),this.sendRequest(n,o,r=>{let s=r.s,d=r.d||"error";this.authToken_===t&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,d))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let n=t.s,o=t.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,o)})}unlisten(t,n){let o=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+o+" "+r),M(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,r)&&this.connected_&&this.sendUnlisten_(o,r,t._queryObject,n)}sendUnlisten_(t,n,o,r){this.log_("Unlisten on "+t+" for "+n);let s={p:t},d="n";r&&(s.q=o,s.t=r),this.sendRequest(d,s)}onDisconnectPut(t,n,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,n,o):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:n,onComplete:o})}onDisconnectMerge(t,n,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,n,o):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:n,onComplete:o})}onDisconnectCancel(t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(t,n,o,r){let s={p:n,d:o};this.log_("onDisconnect "+t,s),this.sendRequest(t,s,d=>{r&&setTimeout(()=>{r(d.s,d.d)},Math.floor(0))})}put(t,n,o,r){this.putInternal("p",t,n,o,r)}merge(t,n,o,r){this.putInternal("m",t,n,o,r)}putInternal(t,n,o,r,s){this.initConnection_();let d={p:n,d:o};s!==void 0&&(d.h=s),this.outstandingPuts_.push({action:t,request:d,onComplete:r}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+n)}sendPut_(t){let n=this.outstandingPuts_[t].action,o=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,o,s=>{this.log_(n+" response",s),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(s.s,s.d)})}reportStats(t){if(this.connected_){let n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,o=>{if(o.s!=="ok"){let s=o.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ae(t));let n=t.r,o=this.requestCBHash_[n];o&&(delete this.requestCBHash_[n],o(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,n){this.log_("handleServerMessage",t,n),t==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):t==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):t==="c"?this.onListenRevoked_(n.p,n.q):t==="ac"?this.onAuthRevoked_(n.s,n.d):t==="apc"?this.onAppCheckRevoked_(n.s,n.d):t==="sd"?this.onSecurityDebugPacket_(n):Au("Unrecognized action received from server: "+Ae(t)+`
Are you using the latest client?`)}onReady_(t,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){M(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=qo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=qo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>AA&&(this.reconnectDelay_=qo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),n=Math.max(0,this.reconnectDelay_-t);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*xA)}this.onConnectStatus_(!1)}establishConnection_(){return B(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),o=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+i.nextConnectionId_++,s=this.lastSessionId,d=!1,c=null,u=function(){c?c.close():(d=!0,o())},p=function(v){M(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(v)};this.realtime_={close:u,sendRequest:p};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[v,_]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);d?Ve("getToken() completed but was canceled"):(Ve("getToken() completed. Creating connection."),this.authToken_=v&&v.accessToken,this.appCheckToken_=_&&_.token,c=new Iu(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,o,T=>{Ze(T+" ("+this.repoInfo_.toString()+")"),this.interrupt(yA)},s))}catch(v){this.log_("Failed to get token: "+v),d||(this.repoInfo_.nodeAdmin&&Ze(v),u())}}})}interrupt(t){Ve("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Ve("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ad(this.interruptReasons_)&&(this.reconnectDelay_=qo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let n=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let n=this.outstandingPuts_[t];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,n){let o;n?o=n.map(s=>lh(s)).join("$"):o="default";let r=this.removeListen_(t,o);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,n){let o=new ie(t).toString(),r;if(this.listens.has(o)){let s=this.listens.get(o);r=s.get(n),s.delete(n),s.size===0&&this.listens.delete(o)}else r=void 0;return r}onAuthRevoked_(t,n){Ve("Auth token revoked: "+t+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=O0&&(this.reconnectDelay_=N0,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,n){Ve("App check token revoked: "+t+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=O0&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let n of t.values())this.sendListen_(n);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},n="js";pt()&&(this.repoInfo_.nodeAdmin?n="admin_node":n="node"),t["sdk."+n+"."+dh.replace(/\./g,"-")]=1,xd()?t["framework.cordova"]=1:og()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=bs.getInstance().currentlyOnline();return Ad(this.interruptReasons_)&&t}}i.nextPersistentConnectionId_=0,i.nextConnectionId_=0;return i})(),K=class i{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new i(e,t)}};var Li=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new K(Mi,e),o=new K(Mi,t);return this.compare(n,o)!==0}minPost(){return K.MIN}};var hs,ws=class extends Li{static get __EMPTY_NODE(){return hs}static set __EMPTY_NODE(e){hs=e}compare(e,t){return Hi(e.name,t.name)}isDefinedOn(e){throw Jn("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return K.MIN}maxPost(){return new K(Rn,hs)}makePost(e,t){return M(typeof e=="string","KeyIndex indexValue must always be a string."),new K(e,hs)}toString(){return".key"}},Vi=new ws;var ki=class{constructor(e,t,n,o,r=null){this.isReverse_=o,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=t?n(e.key,t):1,o&&(s*=-1),s<0)this.isReverse_?e=e.left:e=e.right;else if(s===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},dt=(()=>{class i{constructor(t,n,o,r,s){this.key=t,this.value=n,this.color=o??i.RED,this.left=r??et.EMPTY_NODE,this.right=s??et.EMPTY_NODE}copy(t,n,o,r,s){return new i(t??this.key,n??this.value,o??this.color,r??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,o){let r=this,s=o(t,r.key);return s<0?r=r.copy(null,null,null,r.left.insert(t,n,o),null):s===0?r=r.copy(null,n,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,n,o)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return et.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,n){let o,r;if(o=this,n(t,o.key)<0)!o.left.isEmpty()&&!o.left.isRed_()&&!o.left.left.isRed_()&&(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(t,n),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),!o.right.isEmpty()&&!o.right.isRed_()&&!o.right.left.isRed_()&&(o=o.moveRedRight_()),n(t,o.key)===0){if(o.right.isEmpty())return et.EMPTY_NODE;r=o.right.min_(),o=o.copy(r.key,r.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(t,n))}return o.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return i.RED=!0,i.BLACK=!1,i})(),Bu=class{copy(e,t,n,o,r){return this}insert(e,t,n){return new dt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},et=class i{constructor(e,t=i.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new i(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,dt.BLACK,null,null))}remove(e){return new i(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,dt.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,o=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return o?o.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(o=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ki(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ki(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ki(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ki(this.root_,null,this.comparator_,!0,e)}};et.EMPTY_NODE=new Bu;function CA(i,e){return Hi(i.name,e.name)}function hh(i,e){return Hi(i,e)}var Vu;function _A(i){Vu=i}var Iv=function(i){return typeof i=="number"?"number:"+dv(i):"string:"+i},kv=function(i){if(i.isLeafNode()){let e=i.val();M(typeof e=="string"||typeof e=="number"||typeof e=="object"&&gt(e,".sv"),"Priority must be a string or number.")}else M(i===Vu||i.isEmpty(),"priority of unexpected type.");M(i===Vu||i.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var z0,Fi=(()=>{class i{static set __childrenNodeConstructor(t){z0=t}static get __childrenNodeConstructor(){return z0}constructor(t,n=i.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,M(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),kv(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new i(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return G(t)?this:Z(t)===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,n){return null}updateImmediateChild(t,n){return t===".priority"?this.updatePriority(n):n.isEmpty()&&t!==".priority"?this:i.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){let o=Z(t);return o===null?n:n.isEmpty()&&o!==".priority"?this:(M(o!==".priority"||an(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(o,i.__childrenNodeConstructor.EMPTY_NODE.updateChild(re(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,n){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Iv(this.priorityNode_.val())+":");let n=typeof this.value_;t+=n+":",n==="number"?t+=dv(this.value_):t+=this.value_,this.lazyHash_=rv(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===i.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof i.__childrenNodeConstructor?-1:(M(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let n=typeof t.value_,o=typeof this.value_,r=i.VALUE_TYPE_ORDER.indexOf(n),s=i.VALUE_TYPE_ORDER.indexOf(o);return M(r>=0,"Unknown leaf type: "+n),M(s>=0,"Unknown leaf type: "+o),r===s?o==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let n=t;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}i.VALUE_TYPE_ORDER=["object","boolean","number","string"];return i})(),Dv,Bv;function SA(i){Dv=i}function EA(i){Bv=i}var Mu=class extends Li{compare(e,t){let n=e.node.getPriority(),o=t.node.getPriority(),r=n.compareTo(o);return r===0?Hi(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return K.MIN}maxPost(){return new K(Rn,new Fi("[PRIORITY-POST]",Bv))}makePost(e,t){let n=Dv(e);return new K(t,new Fi("[PRIORITY-POST]",n))}toString(){return".priority"}},Le=new Mu;var TA=Math.log(2),Lu=class{constructor(e){let t=r=>parseInt(Math.log(r)/TA,10),n=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let o=n(this.count);this.bits_=e+1&o}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},xs=function(i,e,t,n){i.sort(e);let o=function(c,u){let p=u-c,f,v;if(p===0)return null;if(p===1)return f=i[c],v=t?t(f):f,new dt(v,f.node,dt.BLACK,null,null);{let _=parseInt(p/2,10)+c,T=o(c,_),k=o(_+1,u);return f=i[_],v=t?t(f):f,new dt(v,f.node,dt.BLACK,T,k)}},r=function(c){let u=null,p=null,f=i.length,v=function(T,k){let I=f-T,H=f;f-=T;let R=o(I+1,H),z=i[I],X=t?t(z):z;_(new dt(X,z.node,k,null,R))},_=function(T){u?(u.left=T,u=T):(p=T,u=T)};for(let T=0;T<c.count;++T){let k=c.nextBitIsOne(),I=Math.pow(2,c.count-(T+1));k?v(I,dt.BLACK):(v(I,dt.BLACK),v(I,dt.RED))}return p},s=new Lu(i.length),d=r(s);return new et(n||e,d)};var gu,Ii={},Ri=class i{static get Default(){return M(Ii&&Le,"ChildrenNode.ts has not been loaded"),gu=gu||new i({".priority":Ii},{".priority":Le}),gu}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=bn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof et?t:null}hasIndex(e){return gt(this.indexSet_,e.toString())}addIndex(e,t){M(e!==Vi,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let n=[],o=!1,r=t.getIterator(K.Wrap),s=r.getNext();for(;s;)o=o||e.isDefinedOn(s.node),n.push(s),s=r.getNext();let d;o?d=xs(n,e.getCompare()):d=Ii;let c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;let p=Object.assign({},this.indexes_);return p[c]=d,new i(p,u)}addToIndexes(e,t){let n=vo(this.indexes_,(o,r)=>{let s=bn(this.indexSet_,r);if(M(s,"Missing index implementation for "+r),o===Ii)if(s.isDefinedOn(e.node)){let d=[],c=t.getIterator(K.Wrap),u=c.getNext();for(;u;)u.name!==e.name&&d.push(u),u=c.getNext();return d.push(e),xs(d,s.getCompare())}else return Ii;else{let d=t.get(e.name),c=o;return d&&(c=c.remove(new K(e.name,d))),c.insert(e,e.node)}});return new i(n,this.indexSet_)}removeFromIndexes(e,t){let n=vo(this.indexes_,o=>{if(o===Ii)return o;{let r=t.get(e.name);return r?o.remove(new K(e.name,r)):o}});return new i(n,this.indexSet_)}};var Go,ce=(()=>{class i{static get EMPTY_NODE(){return Go||(Go=new i(new et(hh),null,Ri.Default))}constructor(t,n,o){this.children_=t,this.priorityNode_=n,this.indexMap_=o,this.lazyHash_=null,this.priorityNode_&&kv(this.priorityNode_),this.children_.isEmpty()&&M(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Go}updatePriority(t){return this.children_.isEmpty()?this:new i(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let n=this.children_.get(t);return n===null?Go:n}}getChild(t){let n=Z(t);return n===null?this:this.getImmediateChild(n).getChild(re(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,n){if(M(n,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(n);{let o=new K(t,n),r,s;n.isEmpty()?(r=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(o,this.children_)):(r=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(o,this.children_));let d=r.isEmpty()?Go:this.priorityNode_;return new i(r,d,s)}}updateChild(t,n){let o=Z(t);if(o===null)return n;{M(Z(t)!==".priority"||an(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(o).updateChild(re(t),n);return this.updateImmediateChild(o,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let n={},o=0,r=0,s=!0;if(this.forEachChild(Le,(d,c)=>{n[d]=c.val(t),o++,s&&i.INTEGER_REGEXP_.test(d)?r=Math.max(r,Number(d)):s=!1}),!t&&s&&r<2*o){let d=[];for(let c in n)d[c]=n[c];return d}else return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+Iv(this.getPriority().val())+":"),this.forEachChild(Le,(n,o)=>{let r=o.hash();r!==""&&(t+=":"+n+":"+r)}),this.lazyHash_=t===""?"":rv(t)}return this.lazyHash_}getPredecessorChildName(t,n,o){let r=this.resolveIndex_(o);if(r){let s=r.getPredecessorKey(new K(t,n));return s?s.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let n=this.resolveIndex_(t);if(n){let o=n.minKey();return o&&o.name}else return this.children_.minKey()}getFirstChild(t){let n=this.getFirstChildName(t);return n?new K(n,this.children_.get(n)):null}getLastChildName(t){let n=this.resolveIndex_(t);if(n){let o=n.maxKey();return o&&o.name}else return this.children_.maxKey()}getLastChild(t){let n=this.getLastChildName(t);return n?new K(n,this.children_.get(n)):null}forEachChild(t,n){let o=this.resolveIndex_(t);return o?o.inorderTraversal(r=>n(r.name,r.node)):this.children_.inorderTraversal(n)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,n){let o=this.resolveIndex_(n);if(o)return o.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,K.Wrap),s=r.peek();for(;s!=null&&n.compare(s,t)<0;)r.getNext(),s=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,n){let o=this.resolveIndex_(n);if(o)return o.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,K.Wrap),s=r.peek();for(;s!=null&&n.compare(s,t)>0;)r.getNext(),s=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===or?-1:0}withIndex(t){if(t===Vi||this.indexMap_.hasIndex(t))return this;{let n=this.indexMap_.addIndex(t,this.children_);return new i(this.children_,this.priorityNode_,n)}}isIndexed(t){return t===Vi||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let n=t;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){let o=this.getIterator(Le),r=n.getIterator(Le),s=o.getNext(),d=r.getNext();for(;s&&d;){if(s.name!==d.name||!s.node.equals(d.node))return!1;s=o.getNext(),d=r.getNext()}return s===null&&d===null}else return!1;else return!1}}resolveIndex_(t){return t===Vi?null:this.indexMap_.get(t.toString())}}return i.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,i})(),Fu=class extends ce{constructor(){super(new et(hh),ce.EMPTY_NODE,Ri.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ce.EMPTY_NODE}isEmpty(){return!1}},or=new Fu;Object.defineProperties(K,{MIN:{value:new K(Mi,ce.EMPTY_NODE)},MAX:{value:new K(Rn,or)}});ws.__EMPTY_NODE=ce.EMPTY_NODE;Fi.__childrenNodeConstructor=ce;_A(or);EA(or);var PA=!0;function Me(i,e=null){if(i===null)return ce.EMPTY_NODE;if(typeof i=="object"&&".priority"in i&&(e=i[".priority"]),M(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof i=="object"&&".value"in i&&i[".value"]!==null&&(i=i[".value"]),typeof i!="object"||".sv"in i){let t=i;return new Fi(t,Me(e))}if(!(i instanceof Array)&&PA){let t=[],n=!1;if(tt(i,(s,d)=>{if(s.substring(0,1)!=="."){let c=Me(d);c.isEmpty()||(n=n||!c.getPriority().isEmpty(),t.push(new K(s,c)))}}),t.length===0)return ce.EMPTY_NODE;let r=xs(t,CA,s=>s.name,hh);if(n){let s=xs(t,Le.getCompare());return new ce(r,Me(e),new Ri({".priority":s},{".priority":Le}))}else return new ce(r,Me(e),Ri.Default)}else{let t=ce.EMPTY_NODE;return tt(i,(n,o)=>{if(gt(i,n)&&n.substring(0,1)!=="."){let r=Me(o);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(n,r))}}),t.updatePriority(Me(e))}}SA(Me);var Ru=class extends Li{constructor(e){super(),this.indexPath_=e,M(!G(e)&&Z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),o=this.extractChild(t.node),r=n.compareTo(o);return r===0?Hi(e.name,t.name):r}makePost(e,t){let n=Me(e),o=ce.EMPTY_NODE.updateChild(this.indexPath_,n);return new K(t,o)}maxPost(){let e=ce.EMPTY_NODE.updateChild(this.indexPath_,or);return new K(Rn,e)}toString(){return Sv(this.indexPath_,0).join("/")}};var Nu=class extends Li{compare(e,t){let n=e.node.compareTo(t.node);return n===0?Hi(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return K.MIN}maxPost(){return K.MAX}makePost(e,t){let n=Me(e);return new K(t,n)}toString(){return".value"}},IA=new Nu;function kA(i){return{type:"value",snapshotNode:i}}function DA(i,e){return{type:"child_added",snapshotNode:e,childName:i}}function BA(i,e){return{type:"child_removed",snapshotNode:e,childName:i}}function H0(i,e,t){return{type:"child_changed",snapshotNode:e,childName:i,oldSnap:t}}function VA(i,e){return{type:"child_moved",snapshotNode:e,childName:i}}var Ou=class i{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Le}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return M(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return M(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Mi}hasEnd(){return this.endSet_}getIndexEndValue(){return M(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return M(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Rn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return M(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Le}copy(){let e=new i;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function j0(i){let e={};if(i.isDefault())return e;let t;if(i.index_===Le?t="$priority":i.index_===IA?t="$value":i.index_===Vi?t="$key":(M(i.index_ instanceof Ru,"Unrecognized index type!"),t=i.index_.toString()),e.orderBy=Ae(t),i.startSet_){let n=i.startAfterSet_?"startAfter":"startAt";e[n]=Ae(i.indexStartValue_),i.startNameSet_&&(e[n]+=","+Ae(i.indexStartName_))}if(i.endSet_){let n=i.endBeforeSet_?"endBefore":"endAt";e[n]=Ae(i.indexEndValue_),i.endNameSet_&&(e[n]+=","+Ae(i.indexEndName_))}return i.limitSet_&&(i.isViewFromLeft()?e.limitToFirst=i.limit_:e.limitToLast=i.limit_),e}function U0(i){let e={};if(i.startSet_&&(e.sp=i.indexStartValue_,i.startNameSet_&&(e.sn=i.indexStartName_),e.sin=!i.startAfterSet_),i.endSet_&&(e.ep=i.indexEndValue_,i.endNameSet_&&(e.en=i.indexEndName_),e.ein=!i.endBeforeSet_),i.limitSet_){e.l=i.limit_;let t=i.viewFrom_;t===""&&(i.isViewFromLeft()?t="l":t="r"),e.vf=t}return i.index_!==Le&&(e.i=i.index_.toString()),e}var zu=class i extends ms{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(M(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,o){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=o,this.log_=nr("p:rest:"),this.listens_={}}listen(e,t,n,o){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=i.getListenId_(e,n),d={};this.listens_[s]=d;let c=j0(e._queryParams);this.restRequest_(r+".json",c,(u,p)=>{let f=p;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(r,f,!1,n),bn(this.listens_,s)===d){let v;u?u===401?v="permission_denied":v="rest_error:"+u:v="ok",o(v,null)}})}unlisten(e,t){let n=i.getListenId_(e,t);delete this.listens_[n]}get(e){let t=j0(e._queryParams),n=e._path.toString(),o=new wd;return this.restRequest_(n+".json",t,(r,s)=>{let d=s;r===404&&(d=null,r=null),r===null?(this.onDataUpdate_(n,d,!1,null),o.resolve(d)):o.reject(new Error(d))}),o.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([o,r])=>{o&&o.accessToken&&(t.auth=o.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+lg(t);this.log_("Sending REST request for "+s);let d=new XMLHttpRequest;d.onreadystatechange=()=>{if(n&&d.readyState===4){this.log_("REST Response for "+s+" received. status:",d.status,"response:",d.responseText);let c=null;if(d.status>=200&&d.status<300){try{c=Ur(d.responseText)}catch{Ze("Failed to parse JSON response for "+s+": "+d.responseText)}n(null,c)}else d.status!==401&&d.status!==404&&Ze("Got unsuccessful REST response for "+s+" Status: "+d.status),n(d.status);n=null}},d.open("GET",s,!0),d.send()})}};var Hu=class{constructor(){this.rootNode_=ce.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function As(){return{value:null,children:new Map}}function Vv(i,e,t){if(G(e))i.value=t,i.children.clear();else if(i.value!==null)i.value=i.value.updateChild(e,t);else{let n=Z(e);i.children.has(n)||i.children.set(n,As());let o=i.children.get(n);e=re(e),Vv(o,e,t)}}function ju(i,e,t){i.value!==null?t(e,i.value):MA(i,(n,o)=>{let r=new ie(e.toString()+"/"+n);ju(o,r,t)})}function MA(i,e){i.children.forEach((t,n)=>{e(n,t)})}var Uu=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&tt(this.last_,(n,o)=>{t[n]=t[n]-o}),this.last_=e,t}};var Q0=10*1e3,LA=30*1e3,FA=300*1e3,Qu=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Uu(e);let n=Q0+(LA-Q0)*Math.random();Zo(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;tt(e,(o,r)=>{r>0&&gt(this.statsToReport_,o)&&(t[o]=r,n=!0)}),n&&this.server_.reportStats(t),Zo(this.reportStats_.bind(this),Math.floor(Math.random()*2*FA))}};var Lt=(function(i){return i[i.OVERWRITE=0]="OVERWRITE",i[i.MERGE=1]="MERGE",i[i.ACK_USER_WRITE=2]="ACK_USER_WRITE",i[i.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",i})(Lt||{});function Mv(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Lv(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Fv(i){return{fromUser:!1,fromServer:!0,queryId:i,tagged:!0}}var qu=class i{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Lt.ACK_USER_WRITE,this.source=Mv()}operationForChild(e){if(G(this.path)){if(this.affectedTree.value!=null)return M(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ie(e));return new i(te(),t,this.revert)}}else return M(Z(this.path)===e,"operationForChild called for unrelated child."),new i(re(this.path),this.affectedTree,this.revert)}};var Ni=class i{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Lt.OVERWRITE}operationForChild(e){return G(this.path)?new i(this.source,te(),this.snap.getImmediateChild(e)):new i(this.source,re(this.path),this.snap)}};var ys=class i{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Lt.MERGE}operationForChild(e){if(G(this.path)){let t=this.children.subtree(new ie(e));return t.isEmpty()?null:t.value?new Ni(this.source,te(),t.value):new i(this.source,te(),t)}else return M(Z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new i(this.source,re(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Xo=class{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(G(e))return this.isFullyInitialized()&&!this.filtered_;let t=Z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};function RA(i,e,t,n){let o=[],r=[];return e.forEach(s=>{s.type==="child_changed"&&i.index_.indexedValueChanged(s.oldSnap,s.snapshotNode)&&r.push(VA(s.childName,s.snapshotNode))}),Wo(i,o,"child_removed",e,n,t),Wo(i,o,"child_added",e,n,t),Wo(i,o,"child_moved",r,n,t),Wo(i,o,"child_changed",e,n,t),Wo(i,o,"value",e,n,t),o}function Wo(i,e,t,n,o,r){let s=n.filter(d=>d.type===t);s.sort((d,c)=>OA(i,d,c)),s.forEach(d=>{let c=NA(i,d,r);o.forEach(u=>{u.respondsTo(d.type)&&e.push(u.createEvent(c,i.query_))})})}function NA(i,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,i.index_)),e}function OA(i,e,t){if(e.childName==null||t.childName==null)throw Jn("Should only compare child_ events.");let n=new K(e.childName,e.snapshotNode),o=new K(t.childName,t.snapshotNode);return i.index_.compare(n,o)}function Rv(i,e){return{eventCache:i,serverCache:e}}function Yo(i,e,t,n){return Rv(new Xo(e,t,n),i.serverCache)}function Nv(i,e,t,n){return Rv(i.eventCache,new Xo(e,t,n))}function Gu(i){return i.eventCache.isFullyInitialized()?i.eventCache.getNode():null}function Nn(i){return i.serverCache.isFullyInitialized()?i.serverCache.getNode():null}var fu,zA=()=>(fu||(fu=new et(zx)),fu),Ue=class i{static fromObject(e){let t=new i(null);return tt(e,(n,o)=>{t=t.set(new ie(n),o)}),t}constructor(e,t=zA()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:te(),value:this.value};if(G(e))return null;{let n=Z(e),o=this.children.get(n);if(o!==null){let r=o.findRootMostMatchingPathAndValue(re(e),t);return r!=null?{path:_e(new ie(n),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(G(e))return this;{let t=Z(e),n=this.children.get(t);return n!==null?n.subtree(re(e)):new i(null)}}set(e,t){if(G(e))return new i(t,this.children);{let n=Z(e),r=(this.children.get(n)||new i(null)).set(re(e),t),s=this.children.insert(n,r);return new i(this.value,s)}}remove(e){if(G(e))return this.children.isEmpty()?new i(null):new i(null,this.children);{let t=Z(e),n=this.children.get(t);if(n){let o=n.remove(re(e)),r;return o.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,o),this.value===null&&r.isEmpty()?new i(null):new i(this.value,r)}else return this}}get(e){if(G(e))return this.value;{let t=Z(e),n=this.children.get(t);return n?n.get(re(e)):null}}setTree(e,t){if(G(e))return t;{let n=Z(e),r=(this.children.get(n)||new i(null)).setTree(re(e),t),s;return r.isEmpty()?s=this.children.remove(n):s=this.children.insert(n,r),new i(this.value,s)}}fold(e){return this.fold_(te(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((o,r)=>{n[o]=r.fold_(_e(e,o),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,te(),t)}findOnPath_(e,t,n){let o=this.value?n(t,this.value):!1;if(o)return o;if(G(e))return null;{let r=Z(e),s=this.children.get(r);return s?s.findOnPath_(re(e),_e(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,te(),t)}foreachOnPath_(e,t,n){if(G(e))return this;{this.value&&n(t,this.value);let o=Z(e),r=this.children.get(o);return r?r.foreachOnPath_(re(e),_e(t,o),n):new i(null)}}foreach(e){this.foreach_(te(),e)}foreach_(e,t){this.children.inorderTraversal((n,o)=>{o.foreach_(_e(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}};var ct=class i{constructor(e){this.writeTree_=e}static empty(){return new i(new Ue(null))}};function Jo(i,e,t){if(G(e))return new ct(new Ue(t));{let n=i.writeTree_.findRootMostValueAndPath(e);if(n!=null){let o=n.path,r=n.value,s=$e(o,e);return r=r.updateChild(s,t),new ct(i.writeTree_.set(o,r))}else{let o=new Ue(t),r=i.writeTree_.setTree(e,o);return new ct(r)}}}function q0(i,e,t){let n=i;return tt(t,(o,r)=>{n=Jo(n,_e(e,o),r)}),n}function G0(i,e){if(G(e))return ct.empty();{let t=i.writeTree_.setTree(e,new Ue(null));return new ct(t)}}function Wu(i,e){return On(i,e)!=null}function On(i,e){let t=i.writeTree_.findRootMostValueAndPath(e);return t!=null?i.writeTree_.get(t.path).getChild($e(t.path,e)):null}function W0(i){let e=[],t=i.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Le,(n,o)=>{e.push(new K(n,o))}):i.writeTree_.children.inorderTraversal((n,o)=>{o.value!=null&&e.push(new K(n,o.value))}),e}function rn(i,e){if(G(e))return i;{let t=On(i,e);return t!=null?new ct(new Ue(t)):new ct(i.writeTree_.subtree(e))}}function Zu(i){return i.writeTree_.isEmpty()}function Oi(i,e){return Ov(te(),i.writeTree_,e)}function Ov(i,e,t){if(e.value!=null)return t.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((o,r)=>{o===".priority"?(M(r.value!==null,"Priority writes must always be leaf nodes"),n=r.value):t=Ov(_e(i,o),r,t)}),!t.getChild(i).isEmpty()&&n!==null&&(t=t.updateChild(_e(i,".priority"),n)),t}}function zv(i,e){return qv(e,i)}function HA(i,e,t,n,o){M(n>i.lastWriteId,"Stacking an older write on top of newer ones"),o===void 0&&(o=!0),i.allWrites.push({path:e,snap:t,writeId:n,visible:o}),o&&(i.visibleWrites=Jo(i.visibleWrites,e,t)),i.lastWriteId=n}function jA(i,e){for(let t=0;t<i.allWrites.length;t++){let n=i.allWrites[t];if(n.writeId===e)return n}return null}function UA(i,e){let t=i.allWrites.findIndex(d=>d.writeId===e);M(t>=0,"removeWrite called with nonexistent writeId.");let n=i.allWrites[t];i.allWrites.splice(t,1);let o=n.visible,r=!1,s=i.allWrites.length-1;for(;o&&s>=0;){let d=i.allWrites[s];d.visible&&(s>=t&&QA(d,n.path)?o=!1:lt(n.path,d.path)&&(r=!0)),s--}if(o){if(r)return qA(i),!0;if(n.snap)i.visibleWrites=G0(i.visibleWrites,n.path);else{let d=n.children;tt(d,c=>{i.visibleWrites=G0(i.visibleWrites,_e(n.path,c))})}return!0}else return!1}function QA(i,e){if(i.snap)return lt(i.path,e);for(let t in i.children)if(i.children.hasOwnProperty(t)&&lt(_e(i.path,t),e))return!0;return!1}function qA(i){i.visibleWrites=Hv(i.allWrites,GA,te()),i.allWrites.length>0?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1}function GA(i){return i.visible}function Hv(i,e,t){let n=ct.empty();for(let o=0;o<i.length;++o){let r=i[o];if(e(r)){let s=r.path,d;if(r.snap)lt(t,s)?(d=$e(t,s),n=Jo(n,d,r.snap)):lt(s,t)&&(d=$e(s,t),n=Jo(n,te(),r.snap.getChild(d)));else if(r.children){if(lt(t,s))d=$e(t,s),n=q0(n,d,r.children);else if(lt(s,t))if(d=$e(s,t),G(d))n=q0(n,te(),r.children);else{let c=bn(r.children,Z(d));if(c){let u=c.getChild(re(d));n=Jo(n,te(),u)}}}else throw Jn("WriteRecord should have .snap or .children")}}return n}function jv(i,e,t,n,o){if(!n&&!o){let r=On(i.visibleWrites,e);if(r!=null)return r;{let s=rn(i.visibleWrites,e);if(Zu(s))return t;if(t==null&&!Wu(s,te()))return null;{let d=t||ce.EMPTY_NODE;return Oi(s,d)}}}else{let r=rn(i.visibleWrites,e);if(!o&&Zu(r))return t;if(!o&&t==null&&!Wu(r,te()))return null;{let s=function(u){return(u.visible||o)&&(!n||!~n.indexOf(u.writeId))&&(lt(u.path,e)||lt(e,u.path))},d=Hv(i.allWrites,s,e),c=t||ce.EMPTY_NODE;return Oi(d,c)}}}function WA(i,e,t){let n=ce.EMPTY_NODE,o=On(i.visibleWrites,e);if(o)return o.isLeafNode()||o.forEachChild(Le,(r,s)=>{n=n.updateImmediateChild(r,s)}),n;if(t){let r=rn(i.visibleWrites,e);return t.forEachChild(Le,(s,d)=>{let c=Oi(rn(r,new ie(s)),d);n=n.updateImmediateChild(s,c)}),W0(r).forEach(s=>{n=n.updateImmediateChild(s.name,s.node)}),n}else{let r=rn(i.visibleWrites,e);return W0(r).forEach(s=>{n=n.updateImmediateChild(s.name,s.node)}),n}}function ZA(i,e,t,n,o){M(n||o,"Either existingEventSnap or existingServerSnap must exist");let r=_e(e,t);if(Wu(i.visibleWrites,r))return null;{let s=rn(i.visibleWrites,r);return Zu(s)?o.getChild(t):Oi(s,o.getChild(t))}}function KA(i,e,t,n){let o=_e(e,t),r=On(i.visibleWrites,o);if(r!=null)return r;if(n.isCompleteForChild(t)){let s=rn(i.visibleWrites,o);return Oi(s,n.getNode().getImmediateChild(t))}else return null}function YA(i,e){return On(i.visibleWrites,e)}function JA(i,e,t,n,o,r,s){let d,c=rn(i.visibleWrites,e),u=On(c,te());if(u!=null)d=u;else if(t!=null)d=Oi(c,t);else return[];if(d=d.withIndex(s),!d.isEmpty()&&!d.isLeafNode()){let p=[],f=s.getCompare(),v=r?d.getReverseIteratorFrom(n,s):d.getIteratorFrom(n,s),_=v.getNext();for(;_&&p.length<o;)f(_,n)!==0&&p.push(_),_=v.getNext();return p}else return[]}function XA(){return{visibleWrites:ct.empty(),allWrites:[],lastWriteId:-1}}function Ku(i,e,t,n){return jv(i.writeTree,i.treePath,e,t,n)}function Uv(i,e){return WA(i.writeTree,i.treePath,e)}function Z0(i,e,t,n){return ZA(i.writeTree,i.treePath,e,t,n)}function Cs(i,e){return YA(i.writeTree,_e(i.treePath,e))}function $A(i,e,t,n,o,r){return JA(i.writeTree,i.treePath,e,t,n,o,r)}function ph(i,e,t){return KA(i.writeTree,i.treePath,e,t)}function Qv(i,e){return qv(_e(i.treePath,e),i.writeTree)}function qv(i,e){return{treePath:i,writeTree:e}}var Yu=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;M(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),M(n!==".priority","Only non-priority child changes can be tracked.");let o=this.changeMap.get(n);if(o){let r=o.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(n,H0(n,e.snapshotNode,o.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(n,BA(n,o.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(n,DA(n,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(n,H0(n,e.snapshotNode,o.oldSnap));else throw Jn("Illegal combination of changes: "+e+" occurred after "+o)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}};var Ju=class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}},Gv=new Ju,$o=class{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let n=this.optCompleteServerCache_!=null?new Xo(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ph(this.writes_,e,n)}}getChildAfterChild(e,t,n){let o=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Nn(this.viewCache_),r=$A(this.writes_,o,t,1,n,e);return r.length===0?null:r[0]}};function ey(i,e){M(e.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),M(e.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed")}function ty(i,e,t,n,o){let r=new Yu,s,d;if(t.type===Lt.OVERWRITE){let u=t;u.source.fromUser?s=Xu(i,e,u.path,u.snap,n,o,r):(M(u.source.fromServer,"Unknown source."),d=u.source.tagged||e.serverCache.isFiltered()&&!G(u.path),s=_s(i,e,u.path,u.snap,n,o,d,r))}else if(t.type===Lt.MERGE){let u=t;u.source.fromUser?s=iy(i,e,u.path,u.children,n,o,r):(M(u.source.fromServer,"Unknown source."),d=u.source.tagged||e.serverCache.isFiltered(),s=$u(i,e,u.path,u.children,n,o,d,r))}else if(t.type===Lt.ACK_USER_WRITE){let u=t;u.revert?s=ay(i,e,u.path,n,o,r):s=oy(i,e,u.path,u.affectedTree,n,o,r)}else if(t.type===Lt.LISTEN_COMPLETE)s=ry(i,e,t.path,n,r);else throw Jn("Unknown operation type: "+t.type);let c=r.getChanges();return ny(e,s,c),{viewCache:s,changes:c}}function ny(i,e,t){let n=e.eventCache;if(n.isFullyInitialized()){let o=n.getNode().isLeafNode()||n.getNode().isEmpty(),r=Gu(i);(t.length>0||!i.eventCache.isFullyInitialized()||o&&!n.getNode().equals(r)||!n.getNode().getPriority().equals(r.getPriority()))&&t.push(kA(Gu(e)))}}function Wv(i,e,t,n,o,r){let s=e.eventCache;if(Cs(n,t)!=null)return e;{let d,c;if(G(t))if(M(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=Nn(e),p=u instanceof ce?u:ce.EMPTY_NODE,f=Uv(n,p);d=i.filter.updateFullNode(e.eventCache.getNode(),f,r)}else{let u=Ku(n,Nn(e));d=i.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let u=Z(t);if(u===".priority"){M(an(t)===1,"Can't have a priority with additional path components");let p=s.getNode();c=e.serverCache.getNode();let f=Z0(n,t,p,c);f!=null?d=i.filter.updatePriority(p,f):d=s.getNode()}else{let p=re(t),f;if(s.isCompleteForChild(u)){c=e.serverCache.getNode();let v=Z0(n,t,s.getNode(),c);v!=null?f=s.getNode().getImmediateChild(u).updateChild(p,v):f=s.getNode().getImmediateChild(u)}else f=ph(n,u,e.serverCache);f!=null?d=i.filter.updateChild(s.getNode(),u,f,p,o,r):d=s.getNode()}}return Yo(e,d,s.isFullyInitialized()||G(t),i.filter.filtersNodes())}}function _s(i,e,t,n,o,r,s,d){let c=e.serverCache,u,p=s?i.filter:i.filter.getIndexedFilter();if(G(t))u=p.updateFullNode(c.getNode(),n,null);else if(p.filtersNodes()&&!c.isFiltered()){let _=c.getNode().updateChild(t,n);u=p.updateFullNode(c.getNode(),_,null)}else{let _=Z(t);if(!c.isCompleteForPath(t)&&an(t)>1)return e;let T=re(t),I=c.getNode().getImmediateChild(_).updateChild(T,n);_===".priority"?u=p.updatePriority(c.getNode(),I):u=p.updateChild(c.getNode(),_,I,T,Gv,null)}let f=Nv(e,u,c.isFullyInitialized()||G(t),p.filtersNodes()),v=new $o(o,f,r);return Wv(i,f,t,o,v,d)}function Xu(i,e,t,n,o,r,s){let d=e.eventCache,c,u,p=new $o(o,e,r);if(G(t))u=i.filter.updateFullNode(e.eventCache.getNode(),n,s),c=Yo(e,u,!0,i.filter.filtersNodes());else{let f=Z(t);if(f===".priority")u=i.filter.updatePriority(e.eventCache.getNode(),n),c=Yo(e,u,d.isFullyInitialized(),d.isFiltered());else{let v=re(t),_=d.getNode().getImmediateChild(f),T;if(G(v))T=n;else{let k=p.getCompleteChild(f);k!=null?_v(v)===".priority"&&k.getChild(Ev(v)).isEmpty()?T=k:T=k.updateChild(v,n):T=ce.EMPTY_NODE}if(_.equals(T))c=e;else{let k=i.filter.updateChild(d.getNode(),f,T,v,p,s);c=Yo(e,k,d.isFullyInitialized(),i.filter.filtersNodes())}}}return c}function K0(i,e){return i.eventCache.isCompleteForChild(e)}function iy(i,e,t,n,o,r,s){let d=e;return n.foreach((c,u)=>{let p=_e(t,c);K0(e,Z(p))&&(d=Xu(i,d,p,u,o,r,s))}),n.foreach((c,u)=>{let p=_e(t,c);K0(e,Z(p))||(d=Xu(i,d,p,u,o,r,s))}),d}function Y0(i,e,t){return t.foreach((n,o)=>{e=e.updateChild(n,o)}),e}function $u(i,e,t,n,o,r,s,d){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;G(t)?u=n:u=new Ue(null).setTree(t,n);let p=e.serverCache.getNode();return u.children.inorderTraversal((f,v)=>{if(p.hasChild(f)){let _=e.serverCache.getNode().getImmediateChild(f),T=Y0(i,_,v);c=_s(i,c,new ie(f),T,o,r,s,d)}}),u.children.inorderTraversal((f,v)=>{let _=!e.serverCache.isCompleteForChild(f)&&v.value===null;if(!p.hasChild(f)&&!_){let T=e.serverCache.getNode().getImmediateChild(f),k=Y0(i,T,v);c=_s(i,c,new ie(f),k,o,r,s,d)}}),c}function oy(i,e,t,n,o,r,s){if(Cs(o,t)!=null)return e;let d=e.serverCache.isFiltered(),c=e.serverCache;if(n.value!=null){if(G(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return _s(i,e,t,c.getNode().getChild(t),o,r,d,s);if(G(t)){let u=new Ue(null);return c.getNode().forEachChild(Vi,(p,f)=>{u=u.set(new ie(p),f)}),$u(i,e,t,u,o,r,d,s)}else return e}else{let u=new Ue(null);return n.foreach((p,f)=>{let v=_e(t,p);c.isCompleteForPath(v)&&(u=u.set(p,c.getNode().getChild(v)))}),$u(i,e,t,u,o,r,d,s)}}function ry(i,e,t,n,o){let r=e.serverCache,s=Nv(e,r.getNode(),r.isFullyInitialized()||G(t),r.isFiltered());return Wv(i,s,t,n,Gv,o)}function ay(i,e,t,n,o,r){let s;if(Cs(n,t)!=null)return e;{let d=new $o(n,e,o),c=e.eventCache.getNode(),u;if(G(t)||Z(t)===".priority"){let p;if(e.serverCache.isFullyInitialized())p=Ku(n,Nn(e));else{let f=e.serverCache.getNode();M(f instanceof ce,"serverChildren would be complete if leaf node"),p=Uv(n,f)}p=p,u=i.filter.updateFullNode(c,p,r)}else{let p=Z(t),f=ph(n,p,e.serverCache);f==null&&e.serverCache.isCompleteForChild(p)&&(f=c.getImmediateChild(p)),f!=null?u=i.filter.updateChild(c,p,f,re(t),d,r):e.eventCache.getNode().hasChild(p)?u=i.filter.updateChild(c,p,ce.EMPTY_NODE,re(t),d,r):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(s=Ku(n,Nn(e)),s.isLeafNode()&&(u=i.filter.updateFullNode(u,s,r)))}return s=e.serverCache.isFullyInitialized()||Cs(n,te())!=null,Yo(e,u,s,i.filter.filtersNodes())}}function sy(i,e){let t=Nn(i.viewCache_);return t&&(i.query._queryParams.loadsAllData()||!G(e)&&!t.getImmediateChild(Z(e)).isEmpty())?t.getChild(e):null}function J0(i,e,t,n){e.type===Lt.MERGE&&e.source.queryId!==null&&(M(Nn(i.viewCache_),"We should always have a full cache before handling merges"),M(Gu(i.viewCache_),"Missing event cache, even though we have a server cache"));let o=i.viewCache_,r=ty(i.processor_,o,e,t,n);return ey(i.processor_,r.viewCache),M(r.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),i.viewCache_=r.viewCache,dy(i,r.changes,r.viewCache.eventCache.getNode(),null)}function dy(i,e,t,n){let o=n?[n]:i.eventRegistrations_;return RA(i.eventGenerator_,e,t,o)}var X0;function ly(i){M(!X0,"__referenceConstructor has already been defined"),X0=i}function gh(i,e,t,n){let o=e.source.queryId;if(o!==null){let r=i.views.get(o);return M(r!=null,"SyncTree gave us an op for an invalid query."),J0(r,e,t,n)}else{let r=[];for(let s of i.views.values())r=r.concat(J0(s,e,t,n));return r}}function fh(i,e){let t=null;for(let n of i.views.values())t=t||sy(n,e);return t}var $0;function cy(i){M(!$0,"__referenceConstructor has already been defined"),$0=i}var Ss=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ue(null),this.pendingWriteTree_=XA(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function uy(i,e,t,n,o){return HA(i.pendingWriteTree_,e,t,n,o),o?Ts(i,new Ni(Mv(),e,t)):[]}function Di(i,e,t=!1){let n=jA(i.pendingWriteTree_,e);if(UA(i.pendingWriteTree_,e)){let r=new Ue(null);return n.snap!=null?r=r.set(te(),!0):tt(n.children,s=>{r=r.set(new ie(s),!0)}),Ts(i,new qu(n.path,r,t))}else return[]}function Es(i,e,t){return Ts(i,new Ni(Lv(),e,t))}function hy(i,e,t){let n=Ue.fromObject(t);return Ts(i,new ys(Lv(),e,n))}function py(i,e,t,n){let o=Jv(i,n);if(o!=null){let r=Xv(o),s=r.path,d=r.queryId,c=$e(s,e),u=new Ni(Fv(d),c,t);return $v(i,s,u)}else return[]}function gy(i,e,t,n){let o=Jv(i,n);if(o){let r=Xv(o),s=r.path,d=r.queryId,c=$e(s,e),u=Ue.fromObject(t),p=new ys(Fv(d),c,u);return $v(i,s,p)}else return[]}function Zv(i,e,t){let o=i.pendingWriteTree_,r=i.syncPointTree_.findOnPath(e,(s,d)=>{let c=$e(s,e),u=fh(d,c);if(u)return u});return jv(o,e,r,t,!0)}function Ts(i,e){return Kv(e,i.syncPointTree_,null,zv(i.pendingWriteTree_,te()))}function Kv(i,e,t,n){if(G(i.path))return Yv(i,e,t,n);{let o=e.get(te());t==null&&o!=null&&(t=fh(o,te()));let r=[],s=Z(i.path),d=i.operationForChild(s),c=e.children.get(s);if(c&&d){let u=t?t.getImmediateChild(s):null,p=Qv(n,s);r=r.concat(Kv(d,c,u,p))}return o&&(r=r.concat(gh(o,i,n,t))),r}}function Yv(i,e,t,n){let o=e.get(te());t==null&&o!=null&&(t=fh(o,te()));let r=[];return e.children.inorderTraversal((s,d)=>{let c=t?t.getImmediateChild(s):null,u=Qv(n,s),p=i.operationForChild(s);p&&(r=r.concat(Yv(p,d,c,u)))}),o&&(r=r.concat(gh(o,i,n,t))),r}function Jv(i,e){return i.tagToQueryMap.get(e)}function Xv(i){let e=i.indexOf("$");return M(e!==-1&&e<i.length-1,"Bad queryKey."),{queryId:i.substr(e+1),path:new ie(i.substr(0,e))}}function $v(i,e,t){let n=i.syncPointTree_.get(e);M(n,"Missing sync point for query tag that we're tracking");let o=zv(i.pendingWriteTree_,e);return gh(n,t,o,null)}var eh=class i{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new i(t)}node(){return this.node_}},th=class i{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=_e(this.path_,e);return new i(this.syncTree_,t)}node(){return Zv(this.syncTree_,this.path_)}},fy=function(i){return i=i||{},i.timestamp=i.timestamp||new Date().getTime(),i},ev=function(i,e,t){if(!i||typeof i!="object")return i;if(M(".sv"in i,"Unexpected leaf node or priority contents"),typeof i[".sv"]=="string")return my(i[".sv"],e,t);if(typeof i[".sv"]=="object")return vy(i[".sv"],e);M(!1,"Unexpected server value: "+JSON.stringify(i,null,2))},my=function(i,e,t){switch(i){case"timestamp":return t.timestamp;default:M(!1,"Unexpected server value: "+i)}},vy=function(i,e,t){i.hasOwnProperty("increment")||M(!1,"Unexpected server value: "+JSON.stringify(i,null,2));let n=i.increment;typeof n!="number"&&M(!1,"Unexpected increment value: "+n);let o=e.node();if(M(o!==null&&typeof o<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return n;let s=o.getValue();return typeof s!="number"?n:s+n},by=function(i,e,t,n){return mh(e,new th(t,i),n)},wy=function(i,e,t){return mh(i,new eh(e),t)};function mh(i,e,t){let n=i.getPriority().val(),o=ev(n,e.getImmediateChild(".priority"),t),r;if(i.isLeafNode()){let s=i,d=ev(s.getValue(),e,t);return d!==s.getValue()||o!==s.getPriority().val()?new Fi(d,Me(o)):i}else{let s=i;return r=s,o!==s.getPriority().val()&&(r=r.updatePriority(new Fi(o))),s.forEachChild(Le,(d,c)=>{let u=mh(c,e.getImmediateChild(d),t);u!==c&&(r=r.updateImmediateChild(d,u))}),r}}var er=class{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}};function vh(i,e){let t=e instanceof ie?e:new ie(e),n=i,o=Z(t);for(;o!==null;){let r=bn(n.node.children,o)||{children:{},childCount:0};n=new er(o,n,r),t=re(t),o=Z(t)}return n}function ji(i){return i.node.value}function eb(i,e){i.node.value=e,nh(i)}function tb(i){return i.node.childCount>0}function xy(i){return ji(i)===void 0&&!tb(i)}function Ps(i,e){tt(i.node.children,(t,n)=>{e(new er(t,i,n))})}function nb(i,e,t,n){t&&!n&&e(i),Ps(i,o=>{nb(o,e,!0,n)}),t&&n&&e(i)}function Ay(i,e,t){let n=t?i:i.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function rr(i){return new ie(i.parent===null?i.name:rr(i.parent)+"/"+i.name)}function nh(i){i.parent!==null&&yy(i.parent,i.name,i)}function yy(i,e,t){let n=xy(t),o=gt(i.node.children,e);n&&o?(delete i.node.children[e],i.node.childCount--,nh(i)):!n&&!o&&(i.node.children[e]=t.node,i.node.childCount++,nh(i))}var Cy=/[\[\].#$\/\u0000-\u001F\u007F]/,_y=/[\[\].#$\u0000-\u001F\u007F]/,mu=10*1024*1024,ib=function(i){return typeof i=="string"&&i.length!==0&&!Cy.test(i)},Sy=function(i){return typeof i=="string"&&i.length!==0&&!_y.test(i)},Ey=function(i){return i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),Sy(i)};var ob=function(i,e,t){let n=t instanceof ie?new ku(t,i):t;if(e===void 0)throw new Error(i+"contains undefined "+Mn(n));if(typeof e=="function")throw new Error(i+"contains a function "+Mn(n)+" with contents = "+e.toString());if(av(e))throw new Error(i+"contains "+e.toString()+" "+Mn(n));if(typeof e=="string"&&e.length>mu/3&&bo(e)>mu)throw new Error(i+"contains a string greater than "+mu+" utf8 bytes "+Mn(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let o=!1,r=!1;if(tt(e,(s,d)=>{if(s===".value")o=!0;else if(s!==".priority"&&s!==".sv"&&(r=!0,!ib(s)))throw new Error(i+" contains an invalid key ("+s+") "+Mn(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);vA(n,s),ob(i,d,n),bA(n)}),o&&r)throw new Error(i+' contains ".value" child '+Mn(n)+" in addition to actual children.")}};var Ty=function(i,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ib(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Ey(t))throw new Error(ug(i,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var ih=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Py(i,e){let t=null;for(let n=0;n<e.length;n++){let o=e[n],r=o.getPath();t!==null&&!Tv(r,t.path)&&(i.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(o)}t&&i.eventLists_.push(t)}function zn(i,e,t){Py(i,t),Iy(i,n=>lt(n,e)||lt(e,n))}function Iy(i,e){i.recursionDepth_++;let t=!0;for(let n=0;n<i.eventLists_.length;n++){let o=i.eventLists_[n];if(o){let r=o.path;e(r)?(ky(i.eventLists_[n]),i.eventLists_[n]=null):t=!1}}t&&(i.eventLists_=[]),i.recursionDepth_--}function ky(i){for(let e=0;e<i.events.length;e++){let t=i.events[e];if(t!==null){i.events[e]=null;let n=t.getEventRunner();Fn&&Ve("event: "+t.toString()),ir(n)}}}var Dy="repo_interrupt",By=25,oh=class{constructor(e,t,n,o){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=o,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ih,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=As(),this.transactionQueueTree_=new er,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Vy(i,e,t){if(i.stats_=ch(i.repoInfo_),i.forceRestClient_||Gx())i.server_=new zu(i.repoInfo_,(n,o,r,s)=>{tv(i,n,o,r,s)},i.authTokenProvider_,i.appCheckProvider_),setTimeout(()=>nv(i,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ae(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}i.persistentConnection_=new uh(i.repoInfo_,e,(n,o,r,s)=>{tv(i,n,o,r,s)},n=>{nv(i,n)},n=>{Ly(i,n)},i.authTokenProvider_,i.appCheckProvider_,t),i.server_=i.persistentConnection_}i.authTokenProvider_.addTokenChangeListener(n=>{i.server_.refreshAuthToken(n)}),i.appCheckProvider_.addTokenChangeListener(n=>{i.server_.refreshAppCheckToken(n.token)}),i.statsReporter_=Zx(i.repoInfo_,()=>new Qu(i.stats_,i.server_)),i.infoData_=new Hu,i.infoSyncTree_=new Ss({startListening:(n,o,r,s)=>{let d=[],c=i.infoData_.getNode(n._path);return c.isEmpty()||(d=Es(i.infoSyncTree_,n._path,c),setTimeout(()=>{s("ok")},0)),d},stopListening:()=>{}}),bh(i,"connected",!1),i.serverSyncTree_=new Ss({startListening:(n,o,r,s)=>(i.server_.listen(n,r,o,(d,c)=>{let u=s(d,c);zn(i.eventQueue_,n._path,u)}),[]),stopListening:(n,o)=>{i.server_.unlisten(n,o)}})}function My(i){let t=i.infoData_.getNode(new ie(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function rb(i){return fy({timestamp:My(i)})}function tv(i,e,t,n,o){i.dataUpdateCount++;let r=new ie(e);t=i.interceptServerDataCallback_?i.interceptServerDataCallback_(e,t):t;let s=[];if(o)if(n){let c=vo(t,u=>Me(u));s=gy(i.serverSyncTree_,r,c,o)}else{let c=Me(t);s=py(i.serverSyncTree_,r,c,o)}else if(n){let c=vo(t,u=>Me(u));s=hy(i.serverSyncTree_,r,c)}else{let c=Me(t);s=Es(i.serverSyncTree_,r,c)}let d=r;s.length>0&&(d=xh(i,r)),zn(i.eventQueue_,d,s)}function nv(i,e){bh(i,"connected",e),e===!1&&Ry(i)}function Ly(i,e){tt(e,(t,n)=>{bh(i,t,n)})}function bh(i,e,t){let n=new ie("/.info/"+e),o=Me(t);i.infoData_.updateSnapshot(n,o);let r=Es(i.infoSyncTree_,n,o);zn(i.eventQueue_,n,r)}function Fy(i){return i.nextWriteId_++}function Ry(i){ab(i,"onDisconnectEvents");let e=rb(i),t=As();ju(i.onDisconnect_,te(),(o,r)=>{let s=by(o,r,i.serverSyncTree_,e);Vv(t,o,s)});let n=[];ju(t,te(),(o,r)=>{n=n.concat(Es(i.serverSyncTree_,o,r));let s=Hy(i,o);xh(i,s)}),i.onDisconnect_=As(),zn(i.eventQueue_,te(),n)}function Ny(i){i.persistentConnection_&&i.persistentConnection_.interrupt(Dy)}function ab(i,...e){let t="";i.persistentConnection_&&(t=i.persistentConnection_.id+":"),Ve(t,...e)}function sb(i,e,t){return Zv(i.serverSyncTree_,e,t)||ce.EMPTY_NODE}function wh(i,e=i.transactionQueueTree_){if(e||Is(i,e),ji(e)){let t=lb(i,e);M(t.length>0,"Sending zero length transaction queue"),t.every(o=>o.status===0)&&Oy(i,rr(e),t)}else tb(e)&&Ps(e,t=>{wh(i,t)})}function Oy(i,e,t){let n=t.map(u=>u.currentWriteId),o=sb(i,e,n),r=o,s=o.hash();for(let u=0;u<t.length;u++){let p=t[u];M(p.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++;let f=$e(e,p.path);r=r.updateChild(f,p.currentOutputSnapshotRaw)}let d=r.val(!0),c=e;i.server_.put(c.toString(),d,u=>{ab(i,"transaction put response",{path:c.toString(),status:u});let p=[];if(u==="ok"){let f=[];for(let v=0;v<t.length;v++)t[v].status=2,p=p.concat(Di(i.serverSyncTree_,t[v].currentWriteId)),t[v].onComplete&&f.push(()=>t[v].onComplete(null,!0,t[v].currentOutputSnapshotResolved)),t[v].unwatcher();Is(i,vh(i.transactionQueueTree_,e)),wh(i,i.transactionQueueTree_),zn(i.eventQueue_,e,p);for(let v=0;v<f.length;v++)ir(f[v])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{Ze("transaction at "+c.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}xh(i,e)}},s)}function xh(i,e){let t=db(i,e),n=rr(t),o=lb(i,t);return zy(i,o,n),n}function zy(i,e,t){if(e.length===0)return;let n=[],o=[],s=e.filter(d=>d.status===0).map(d=>d.currentWriteId);for(let d=0;d<e.length;d++){let c=e[d],u=$e(t,c.path),p=!1,f;if(M(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)p=!0,f=c.abortReason,o=o.concat(Di(i.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=By)p=!0,f="maxretry",o=o.concat(Di(i.serverSyncTree_,c.currentWriteId,!0));else{let v=sb(i,c.path,s);c.currentInputSnapshot=v;let _=e[d].update(v.val());if(_!==void 0){ob("transaction failed: Data returned ",_,c.path);let T=Me(_);typeof _=="object"&&_!=null&&gt(_,".priority")||(T=T.updatePriority(v.getPriority()));let I=c.currentWriteId,H=rb(i),R=wy(T,v,H);c.currentOutputSnapshotRaw=T,c.currentOutputSnapshotResolved=R,c.currentWriteId=Fy(i),s.splice(s.indexOf(I),1),o=o.concat(uy(i.serverSyncTree_,c.path,R,c.currentWriteId,c.applyLocally)),o=o.concat(Di(i.serverSyncTree_,I,!0))}else p=!0,f="nodata",o=o.concat(Di(i.serverSyncTree_,c.currentWriteId,!0))}zn(i.eventQueue_,t,o),o=[],p&&(e[d].status=2,(function(v){setTimeout(v,Math.floor(0))})(e[d].unwatcher),e[d].onComplete&&(f==="nodata"?n.push(()=>e[d].onComplete(null,!1,e[d].currentInputSnapshot)):n.push(()=>e[d].onComplete(new Error(f),!1,null))))}Is(i,i.transactionQueueTree_);for(let d=0;d<n.length;d++)ir(n[d]);wh(i,i.transactionQueueTree_)}function db(i,e){let t,n=i.transactionQueueTree_;for(t=Z(e);t!==null&&ji(n)===void 0;)n=vh(n,t),e=re(e),t=Z(e);return n}function lb(i,e){let t=[];return cb(i,e,t),t.sort((n,o)=>n.order-o.order),t}function cb(i,e,t){let n=ji(e);if(n)for(let o=0;o<n.length;o++)t.push(n[o]);Ps(e,o=>{cb(i,o,t)})}function Is(i,e){let t=ji(e);if(t){let n=0;for(let o=0;o<t.length;o++)t[o].status!==2&&(t[n]=t[o],n++);t.length=n,eb(e,t.length>0?t:void 0)}Ps(e,n=>{Is(i,n)})}function Hy(i,e){let t=rr(db(i,e)),n=vh(i.transactionQueueTree_,e);return Ay(n,o=>{vu(i,o)}),vu(i,n),nb(n,o=>{vu(i,o)}),t}function vu(i,e){let t=ji(e);if(t){let n=[],o=[],r=-1;for(let s=0;s<t.length;s++)t[s].status===3||(t[s].status===1?(M(r===s-1,"All SENT items should be at beginning of queue."),r=s,t[s].status=3,t[s].abortReason="set"):(M(t[s].status===0,"Unexpected transaction status in abort"),t[s].unwatcher(),o=o.concat(Di(i.serverSyncTree_,t[s].currentWriteId,!0)),t[s].onComplete&&n.push(t[s].onComplete.bind(null,new Error("set"),!1,null))));r===-1?eb(e,void 0):t.length=r+1,zn(i.eventQueue_,rr(e),o);for(let s=0;s<n.length;s++)ir(n[s])}}function jy(i){let e="",t=i.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let o=t[n];try{o=decodeURIComponent(o.replace(/\+/g," "))}catch{}e+="/"+o}return e}function Uy(i){let e={};i.charAt(0)==="?"&&(i=i.substring(1));for(let t of i.split("&")){if(t.length===0)continue;let n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Ze(`Invalid query segment '${t}' in query '${i}'`)}return e}var iv=function(i,e){let t=Qy(i),n=t.namespace;t.domain==="firebase.com"&&Ft(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&Ft("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Nx();let o=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new gs(t.host,t.secure,n,o,e,"",n!==t.subdomain),path:new ie(t.pathString)}},Qy=function(i){let e="",t="",n="",o="",r="",s=!0,d="https",c=443;if(typeof i=="string"){let u=i.indexOf("//");u>=0&&(d=i.substring(0,u-1),i=i.substring(u+2));let p=i.indexOf("/");p===-1&&(p=i.length);let f=i.indexOf("?");f===-1&&(f=i.length),e=i.substring(0,Math.min(p,f)),p<f&&(o=jy(i.substring(p,f)));let v=Uy(i.substring(Math.min(i.length,f)));u=e.indexOf(":"),u>=0?(s=d==="https"||d==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;let _=e.slice(0,u);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let T=e.indexOf(".");n=e.substring(0,T).toLowerCase(),t=e.substring(T+1),r=n}"ns"in v&&(r=v.ns)}return{host:e,port:c,domain:t,subdomain:n,secure:s,scheme:d,pathString:o,namespace:r}};var rh=class i{constructor(e,t,n,o){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=o}get key(){return G(this._path)?null:_v(this._path)}get ref(){return new zi(this._repo,this._path)}get _queryIdentifier(){let e=U0(this._queryParams),t=lh(e);return t==="{}"?"default":t}get _queryObject(){return U0(this._queryParams)}isEqual(e){if(e=je(e),!(e instanceof i))return!1;let t=this._repo===e._repo,n=Tv(this._path,e._path),o=this._queryIdentifier===e._queryIdentifier;return t&&n&&o}toJSON(){return this.toString()}toString(){return this._repo.toString()+mA(this._path)}};var zi=class i extends rh{constructor(e,t){super(e,t,new Ou,!1)}get parent(){let e=Ev(this._path);return e===null?null:new i(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}};ly(zi);cy(zi);var qy="FIREBASE_DATABASE_EMULATOR_HOST",ah={},Gy=!1;function Wy(i,e,t,n){let o=e.lastIndexOf(":"),r=e.substring(0,o),s=Xn(r);i.repoInfo_=new gs(e,s,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams,!0,t),n&&(i.authTokenProvider_=n)}function Zy(i,e,t,n,o){let r=n||i.options.databaseURL;r===void 0&&(i.options.projectId||Ft("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ve("Using default host for project ",i.options.projectId),r=`${i.options.projectId}-default-rtdb.firebaseio.com`);let s=iv(r,o),d=s.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[qy]),u?(c=!0,r=`http://${u}?ns=${d.namespace}`,s=iv(r,o),d=s.repoInfo):c=!s.repoInfo.secure;let p=o&&c?new Ko(Ko.OWNER):new Cu(i.name,i.options,e);Ty("Invalid Firebase Database URL",s),G(s.path)||Ft("Database URL must point to the root of a Firebase Database (not including a child path).");let f=Yy(d,i,p,new yu(i,t));return new sh(f,i)}function Ky(i,e){let t=ah[e];(!t||t[i.key]!==i)&&Ft(`Database ${e}(${i.repoInfo_}) has already been deleted.`),Ny(i),delete t[i.key]}function Yy(i,e,t,n){let o=ah[e.name];o||(o={},ah[e.name]=o);let r=o[i.toURLString()];return r&&Ft("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new oh(i,Gy,t,n),o[i.toURLString()]=r,r}var sh=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Vy(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new zi(this._repo,te())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Ky(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Ft("Cannot call "+e+" on a deleted database.")}};function ub(i=Jr(),e){let t=Zr(i,"database").getImmediate({identifier:e});if(!t._instanceStarted){let n=Or("database");n&&hb(t,...n)}return t}function hb(i,e,t,n={}){i=je(i),i._checkNotDeleted("useEmulator");let o=`${e}:${t}`,r=i._repoInternal;if(i._instanceStarted){if(o===i._repoInternal.repoInfo_.host&&Qr(n,r.repoInfo_.emulatorOptions))return;Ft("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let s;if(r.repoInfo_.nodeAdmin)n.mockUserToken&&Ft('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Ko(Ko.OWNER);else if(n.mockUserToken){let d=typeof n.mockUserToken=="string"?n.mockUserToken:Hr(n.mockUserToken,i.app.options.projectId);s=new Ko(d)}Xn(e)&&(zr(e),jr("Database",!0)),Wy(r,o,n,s)}function Jy(i){Lx(Yr),Wr(new qr("database",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate(),o=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Zy(n,o,r,t)},"PUBLIC").setMultipleInstances(!0)),ft(S0,E0,i),ft(S0,E0,"esm2017")}uh.prototype.simpleListen=function(i,e){this.sendRequest("q",{p:i},e)};uh.prototype.echo=function(i,e){this.sendRequest("echo",{d:i},e)};Jy();var ar=class{constructor(e){return e}},pb="database",Ah=class{constructor(){return ea(pb)}};var yh=new Ut("angularfire2.database-instances");function Xy(i,e){let t=$r(pb,i,e);return t&&new ar(t)}function $y(i){return(e,t)=>{let n=e.runOutsideAngular(()=>i(t));return new ar(n)}}var e2={provide:Ah,deps:[[new ut,yh]]},t2={provide:ar,useFactory:Xy,deps:[[new ut,yh],na]};function gb(i,...e){return ft("angularfire",Xr.full,"rtdb"),Er([t2,e2,{provide:yh,useFactory:$y(i),multi:!0,deps:[it,He,ta,ia,[new ut,ra],[new ut,oa],...e]}])}var fb=rt(ub,!0);var sr=(function(i){return i[i.DISABLE=0]="DISABLE",i[i.ENABLE=1]="ENABLE",i[i.ENABLE_FORMS=2]="ENABLE_FORMS",i[i.ENABLE_STORAGE=3]="ENABLE_STORAGE",i})(sr||{});var Rt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},n2=typeof window>"u"?!1:!!globalThis.MSInputMethodContext&&!!document.documentMode,i2=typeof navigator>"u"||/Edge\/\d./i.test(navigator.userAgent),o2=typeof ReadableStream>"u"||typeof Promise.allSettled>"u",r2="5.4.905",a2="5.4.923";function Ui(i){return i?.includes("bleeding-edge")?a2:r2}function Nt(i,e=""){return i.includes("://")?i:`./${i+e}`}function s2(){return typeof process<"u"&&typeof process.env<"u"&&(process.env.JEST_WORKER_ID!==void 0||process.env.VITEST!==void 0)}function d2(){if(typeof window>"u"||typeof document>"u"||s2())return 4096;let i=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),e=/Android|iPhone|iPad|iPod/.test(navigator.userAgent);return i||e?5242880:33554432}var Fe={needsES5:n2||i2||o2,annotationEditorMode:0,annotationMode:sr.ENABLE_FORMS,defaultZoomDelay:400,cursorToolOnLoad:0,defaultUrl:"",defaultZoomValue:"",disableHistory:!1,disablePageLabels:!1,enablePermissions:!1,docBaseUrl:"",enablePrintAutoRotate:!0,enableSignatureEditor:!1,externalLinkRel:"noopener noreferrer nofollow",externalLinkTarget:0,findController:void 0,historyUpdateUrl:!1,ignoreDestinationZoom:!1,imageResourcesPath:"./images/",maxCanvasPixels:d2(),forcePageColors:!1,pageColorsBackground:"Canvas",pageColorsForeground:"CanvasText",pdfBugEnabled:!1,printResolution:150,rangeChunkSize:65536,removePageBorders:!1,enableXfa:!0,fontExtraProperties:!1,sidebarViewOnLoad:-1,scrollModeOnLoad:-1,spreadModeOnLoad:-1,textLayerMode:1,viewOnLoad:0,cMapPacked:!0,cMapUrl:function(){return`${Nt(Fe.assetsFolder,"/..")}/cmaps/`},disableAutoFetch:!1,disableFontFace:!1,disableRange:!1,disableStream:!0,isEvalSupported:!0,isOffscreenCanvasSupported:!0,maxImageSize:-1,pdfBug:!1,verbosity:1,workerPort:null,assetsFolder:"assets",_internalFilenameSuffix:".min",sandboxBundleSrc:function(){return Fe.needsES5?`./pdf.sandbox-${Ui(Nt(Fe.assetsFolder))}-es5.mjs`:`./pdf.sandbox-${Ui(Nt(Fe.assetsFolder))}${Fe._internalFilenameSuffix}.mjs`},workerSrc:function(){return Fe.needsES5?`${Nt(Fe.assetsFolder)}/pdf.worker-${Ui(Nt(Fe.assetsFolder))}-es5.mjs`:`${Nt(Fe.assetsFolder)}/pdf.worker-${Ui(Nt(Fe.assetsFolder))}${Fe._internalFilenameSuffix}.mjs`},standardFontDataUrl:()=>`${Nt(Fe.assetsFolder,"/..")}/standard_fonts/`,wasmUrl:()=>`${Nt(Fe.assetsFolder,"/..")}/wasm/`,doubleTapZoomFactor:"page-width",doubleTapZoomsInHandMode:!0,doubleTapZoomsInTextSelectionMode:!1,doubleTapResetsZoomOnSecondDoubleTap:!1,enableScripting:!1,enableCatalogAAJavaScript:!1,enableOpenActionJavaScript:!1,defaultCacheSize:50,passwordPrompt:void 0,enableHWA:!0,positionPopupDialogsWithJavaScript:!0,enablePageReordering:!1,pdfBackgroundColor:""},l2=(()=>{class i{static DOORHANGER_OFFSET=17;static TOOLBAR_MARGIN=4;positionPopupBelowItsButton(t,n){Fe.positionPopupDialogsWithJavaScript&&setTimeout(()=>{let o=this.findVisibleButton(t),r=this.getPopupElement(n);!o||!r||this.applyPopupPositioning(o,r)})}findVisibleButton(t){let n=o=>Array.from(document.querySelectorAll(`#${o}`)).find(r=>r.offsetParent!==null);return n(t)||n("secondaryToolbarToggle")||null}getPopupElement(t){let n=document.querySelector(`#${t}`);return n?.offsetParent?n:null}applyPopupPositioning(t,n){let o=n.offsetParent,r=t.getBoundingClientRect(),s=o.getBoundingClientRect(),d=document.documentElement.getAttribute("dir")==="rtl",c=d;n.classList.contains("doorHangerRight")&&(c=!d),this.setBasicPopupStyles(n,c),this.setHorizontalPosition(n,r,s,c),this.setVerticalPosition(n,s)}setBasicPopupStyles(t,n){Object.assign(t.style,{position:"absolute",display:"block",transformOrigin:n?"top right":"top left"})}setHorizontalPosition(t,n,o,r){let s=n.width/2-i.DOORHANGER_OFFSET;r?(t.style.right=`${o.right-n.right+s}px`,t.style.left=""):(t.style.left=`${n.left-o.left+s}px`,t.style.right="")}setVerticalPosition(t,n){let o=document.querySelector("#toolbarContainer");if(!o)return;let s=o.getBoundingClientRect().bottom-n.top+i.TOOLBAR_MARGIN;t.style.top=`${s}px`}}return i})();var c2=(()=>{class i{onPDFJSInitSignal=Pr(void 0);pdfjsVersion=Ui(Fe.assetsFolder);constructor(){hd(()=>{this.onPDFJSInitSignal()&&(this.pdfjsVersion=Ui(Fe.assetsFolder))})}static \u0275fac=function(n){return new(n||i)};static \u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),u2=(()=>{class i{rendererFactory;ngxExtendedPdfViewerInitialized=!1;secondaryMenuIsEmpty=!1;renderer;PDFViewerApplication;constructor(t,n){this.rendererFactory=t,this.renderer=this.rendererFactory.createRenderer(null,null),hd(()=>{this.PDFViewerApplication=n.onPDFJSInitSignal()})}find(t,n={}){if(this.ngxExtendedPdfViewerInitialized){if(!n.useSecondaryFindcontroller){let d=document.getElementById("findHighlightAll");d&&(d.checked=n.highlightAll??!1);let c=document.getElementById("findMatchCase");c&&(c.checked=n.matchCase??!1);let u=document.getElementById("findMultiple");u&&(u.checked=n.findMultiple??!1);let p=document.getElementById("findEntireWord");p&&(p.checked=n.wholeWords??!1);let f=document.getElementById("findMatchDiacritics");f&&(f.checked=n.matchDiacritics??!1);let v=document.getElementById("matchRegExp");v&&(v.checked=n.regexp??!1,v.checked&&(u&&(u.checked=!1),p&&(p.checked=!1),f&&(f.checked=!1)),u&&(u.disabled=v.checked),p&&(p.disabled=v.checked),f&&(f.disabled=v.checked));let _=document.getElementById("findInput");_&&typeof t=="string"&&(_.value=t)}let o={caseSensitive:n.matchCase??!1,entireWord:n.wholeWords??!1,highlightAll:n.highlightAll??!1,matchDiacritics:n.matchDiacritics??!1,findMultiple:n.findMultiple,matchRegExp:n.regexp??!1,findPrevious:!1,query:t,source:null,type:"find",dontScrollIntoView:n.dontScrollIntoView??!1};return(n.useSecondaryFindcontroller?this.PDFViewerApplication?.customFindController:this.PDFViewerApplication?.findController)?.ngxFind(o)}else{console.error("The PDF viewer hasn't finished initializing. Please call find() later.");return}}findNext(t=!1){return this.ngxExtendedPdfViewerInitialized?((t?this.PDFViewerApplication?.customFindController:this.PDFViewerApplication?.findController)?.ngxFindNext(),!0):(console.error("The PDF viewer hasn't finished initializing. Please call findNext() later."),!1)}findPrevious(t=!1){return this.ngxExtendedPdfViewerInitialized?((t?this.PDFViewerApplication?.customFindController:this.PDFViewerApplication?.findController)?.ngxFindPrevious(),!0):(console.error("The PDF viewer hasn't finished initializing. Please call findPrevious() later."),!1)}print(t){this.PDFViewerApplication&&(this.PDFViewerApplication?.PDFPrintServiceFactory?.isInPDFPrintRange!==void 0||(t||(t={}),this.setPrintRange(t),this.PDFViewerApplication?.printPdf(),this.PDFViewerApplication?.eventBus.on("afterprint",this.removePrintRange.bind(this),{once:!0})))}removePrintRange(){this.PDFViewerApplication?.PDFPrintServiceFactory&&(delete this.PDFViewerApplication.PDFPrintServiceFactory.isInPDFPrintRange,delete this.PDFViewerApplication.PDFPrintServiceFactory.filteredPageCount)}setPrintRange(t){if(!this.PDFViewerApplication?.PDFPrintServiceFactory){console.error("The print service hasn't been initialized yet.");return}this.PDFViewerApplication.PDFPrintServiceFactory.isInPDFPrintRange=n=>this.isInPDFPrintRange(n,t),this.PDFViewerApplication.PDFPrintServiceFactory.filteredPageCount=this.filteredPageCount(this.PDFViewerApplication?.pagesCount,t)}filteredPageCount(t,n){let o=0;for(let r=0;r<t;r++)this.isInPDFPrintRange(r,n)&&o++;return o}isInPDFPrintRange(t,n){let o=t+1;return!(n.from&&o<n.from||n.to&&o>n.to||n.excluded&&n.excluded.some(r=>r===o)||n.included&&!n.included.some(r=>r===o))}getPageAsLines(t){return B(this,null,function*(){if(this.PDFViewerApplication){let s=(yield(yield(this.PDFViewerApplication?.pdfDocument).getPage(t)).getTextContent()).items.filter(k=>!k.type),d=Number.MAX_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,f=0,v=0,_="",T=new Array;for(let k=0;k<s.length;k++){let I=s[k];if(!I.hasEOL){let R=I.transform[4],z=-I.transform[5],X=I.width,ge=I.height;d=Math.min(d,R),c=Math.min(c,z),u=Math.max(u,R+X),p=Math.max(p,z+ge),_+=I.str,I.dir==="rtl"&&v++,I.dir==="ltr"&&f++}if(k===s.length-1||I.hasEOL){let R;f>0&&v>0?R="both":f>0?R="ltr":v>0&&(R="rtl");let z={direction:R,x:d,y:c,width:u-d,height:p-c,text:_.trim()};T.push(z),d=Number.MAX_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,f=0,v=0,_=""}}return T}return[]})}getPageAsText(t){return B(this,null,function*(){if(!this.PDFViewerApplication)return"";let r=(yield(yield(this.PDFViewerApplication?.pdfDocument).getPage(t)).getTextContent()).items;return this.convertTextInfoToText(r)})}convertTextInfoToText(t){return t?t.filter(n=>!n.type).map(n=>n.hasEOL?n.str+`
`:n.str).join(""):""}getPageAsCanvas(d,c,u){return B(this,arguments,function*(t,n,o,r="#FFFFFF",s=sr.ENABLE){if(!this.PDFViewerApplication)return Promise.resolve(void 0);let f=yield this.PDFViewerApplication.pdfDocument.getPage(t);return this.draw(f,n,o,r,s)})}getPageAsImage(d,c,u){return B(this,arguments,function*(t,n,o,r="#FFFFFF",s=sr.ENABLE){return(yield this.getPageAsCanvas(t,n,o,r,s))?.toDataURL()})}draw(d,c,u){return B(this,arguments,function*(t,n,o,r="#FFFFFF",s=sr.ENABLE){let p=1;n.scale?p=n.scale:n.width?p=n.width/t.getViewport({scale:1}).width:n.height&&(p=n.height/t.getViewport({scale:1}).height);let f=t.getViewport({scale:p}),{ctx:v,canvas:_}=this.getPageDrawContext(f.width,f.height),T=f.clone(),k={canvasContext:v,viewport:T,background:o,backgroundColorToReplace:r,annotationMode:s},I=t.render(k),H=()=>Promise.resolve(_);return I.promise.then(H)})}getPageDrawContext(t,n){let o=document.createElement("canvas"),r=o.getContext("2d",{alpha:!0});if(!r)throw new Error("Couldn't create the 2d context");return o.width=t,o.height=n,this.renderer.setStyle(o,"width",`${t}px`),this.renderer.setStyle(o,"height",`${n}px`),{ctx:r,canvas:o}}getCurrentDocumentAsBlob(){return B(this,null,function*(){return(yield this.PDFViewerApplication?.export())||void 0})}getFormData(t=!0){return B(this,null,function*(){if(!this.PDFViewerApplication)return[];let n=this.PDFViewerApplication?.pdfDocument,o=96/72,r=[];for(let s=1;s<=n?.numPages;s++){let d=yield n.getPage(s);(yield d.getAnnotations()).filter(u=>u.subtype==="Widget").map(u=>Oe({},u)).forEach(u=>{let p=d.getViewport({scale:o}).convertToViewportRectangle(u.rect);if(t&&u.fieldName)try{if(u.exportValue){let f=this.PDFViewerApplication?.pdfDocument.annotationStorage.getValue(u.id,u.fieldName+"/"+u.exportValue,"");u.value=f?.value}else if(u.radioButton){let f=this.PDFViewerApplication?.pdfDocument.annotationStorage.getValue(u.id,u.fieldName+"/"+u.fieldValue,"");u.value=f?.value}else{let f=this.PDFViewerApplication?.pdfDocument.annotationStorage.getValue(u.id,u.fieldName,"");u.value=f?.value}}catch{}r.push({fieldAnnotation:u,fieldRect:p,pageNumber:s})})}return r})}addPageToRenderQueue(t){return this.PDFViewerApplication?.pdfViewer.addPageToRenderQueue(t)??!1}isRenderQueueEmpty(){return this.PDFViewerApplication?!this.PDFViewerApplication.pdfViewer.renderingQueue.getHighestPriority(this.PDFViewerApplication?.pdfViewer._getVisiblePages(),this.PDFViewerApplication?.pdfViewer._pages,!0,!1):!0}hasPageBeenRendered(t){if(!this.PDFViewerApplication)return!1;let n=this.PDFViewerApplication?.pdfViewer._pages;return n.length>t&&t>=0?n[t].renderingState===3:!1}sleep(t){return new Promise(n=>setTimeout(n,t))}renderPage(t){return B(this,null,function*(){if(!this.hasPageBeenRendered(t))for(yield this.addPageToRenderQueue(t);!this.hasPageBeenRendered(t);)yield this.sleep(7)})}currentlyRenderedPages(){return this.PDFViewerApplication?(this.PDFViewerApplication?.pdfViewer._pages).filter(n=>n.renderingState===3).map(n=>n.id):[]}numberOfPages(){return this.PDFViewerApplication?(this.PDFViewerApplication?.pdfViewer._pages).length:0}getCurrentlyVisiblePageNumbers(){let t=this.PDFViewerApplication;return t?t.pdfViewer._getVisiblePages().views?.map(o=>o.id):[]}listLayers(){return B(this,null,function*(){if(!this.PDFViewerApplication)return[];let t=yield this.PDFViewerApplication?.pdfViewer.optionalContentConfigPromise;if(t)return t.getOrder().filter(r=>typeof r!="object").map(r=>{let s=t.getGroup(r);return{layerId:r,name:s.name,visible:s.visible}})})}toggleLayer(t){return B(this,null,function*(){if(!this.PDFViewerApplication)return;let n=yield this.PDFViewerApplication?.pdfViewer.optionalContentConfigPromise;if(n){let o=n.getGroup(t).visible,r=document.querySelector(`input[id='${t}']`);r&&(o=r.checked,r.checked=!o),n.setVisibility(t,!o),this.PDFViewerApplication?.eventBus.dispatch("optionalcontentconfig",{source:this,promise:Promise.resolve(n)})}})}scrollPageIntoView(t,n){this.PDFViewerApplication?.pdfViewer?.scrollPagePosIntoView(t,n)}getSerializedAnnotations(){return this.PDFViewerApplication?.pdfViewer.getSerializedAnnotations()}addEditorAnnotation(t){return B(this,null,function*(){yield this.PDFViewerApplication?.pdfViewer.addEditorAnnotation(t)})}removeEditorAnnotations(t){this.PDFViewerApplication?.pdfViewer.removeEditorAnnotations(t)}loadImageAsDataURL(t){return B(this,null,function*(){if(t.startsWith("data:"))return t;let n=yield fetch(t);if(!n.ok)throw new Error(`Failed to fetch the image from ${t}: ${n.statusText}`);return yield n.blob()})}addImageToAnnotationLayer(u){return B(this,arguments,function*({urlOrDataUrl:t,page:n,left:o,bottom:r,right:s,top:d,rotation:c}){if(!this.PDFViewerApplication){console.error("The PDF viewer has not been initialized yet.");return}let p;n!==void 0?(n!==this.currentPageIndex()&&(yield this.renderPage(n)),p=n):p=this.currentPageIndex()??0;let f=this.PDFViewerApplication.pdfViewer.annotationEditorMode;this.switchAnnotationEdtorMode(13);let v=yield this.loadImageAsDataURL(t),_=this.PDFViewerApplication.pdfViewer._pages[p].pdfPage.view,T=_[0],k=_[1],I=_[2],H=_[3],R=I-T,z=H-k,X=this.PDFViewerApplication?.pdfViewer._pages[p].div.clientWidth,ge=this.PDFViewerApplication?.pdfViewer._pages[p].div.clientHeight,Y=this.convertToPDFCoordinates(o,R,0,X),A=this.convertToPDFCoordinates(r,z,0,ge),m=this.convertToPDFCoordinates(s,R,R,X),b=this.convertToPDFCoordinates(d,z,z,ge),x={annotationType:13,pageIndex:p,bitmapUrl:v,rect:[Y,A,m,b],rotation:c??0,isCopy:!0};this.addEditorAnnotation(x),yield this.sleep(10),this.switchAnnotationEdtorMode(f)})}addHighlightToAnnotationLayer(t,n,o,r,s,d,c=12,u=0,p=.5){return B(this,null,function*(){if(!this.PDFViewerApplication){console.error("The PDF viewer has not been initialized yet.");return}let f;n!==void 0?(n!==this.currentPageIndex()&&(yield this.renderPage(n)),f=n):f=this.currentPageIndex()??0;let v=this.PDFViewerApplication.pdfViewer.annotationEditorMode;this.switchAnnotationEdtorMode(9);let _=this.PDFViewerApplication.pdfViewer._pages[f].pdfPage.view,T=_[0],k=_[1],I=_[2],H=_[3],R=I-T,z=H-k,X=this.PDFViewerApplication?.pdfViewer._pages[f].div.clientWidth,ge=this.PDFViewerApplication?.pdfViewer._pages[f].div.clientHeight,Y=this.convertToPDFCoordinates(o,R,0,X),A=this.convertToPDFCoordinates(r,z,0,ge),m=this.convertToPDFCoordinates(s,R,R,X),b=this.convertToPDFCoordinates(d,z,z,ge),x={};x[0]=Y,x[1]=b,x[2]=m,x[3]=b,x[4]=Y,x[5]=A,x[6]=m,x[7]=A;let y={annotationType:9,color:t,opacity:p,thickness:c,quadPoints:x,outlines:[[Y,A,Y,b,m,b,m,A]],pageIndex:f,rect:[Y,A,m,b],rotation:u,isCopy:!0};this.addEditorAnnotation(y),yield this.sleep(10),this.switchAnnotationEdtorMode(v)})}currentPageIndex(){let t=this.PDFViewerApplication?.pdfViewer;if(t)return t.currentPageNumber-1}convertToPDFCoordinates(t,n,o,r){return t?typeof t=="string"?t.endsWith("%")?parseInt(t,10)/100*n:t.endsWith("px")?parseInt(t,10)*(n/r):parseInt(t,10):t:o}switchAnnotationEdtorMode(t){this.PDFViewerApplication?.eventBus.dispatch("switchannotationeditormode",{mode:t})}set editorFontSize(t){this.setEditorProperty(Rt.FREETEXT_SIZE,t)}set editorFontColor(t){this.setEditorProperty(Rt.FREETEXT_COLOR,t)}set editorInkColor(t){this.setEditorProperty(Rt.INK_COLOR,t)}set editorInkOpacity(t){this.setEditorProperty(Rt.INK_OPACITY,t)}set editorInkThickness(t){this.setEditorProperty(Rt.INK_THICKNESS,t)}set editorHighlightColor(t){this.setEditorProperty(Rt.HIGHLIGHT_COLOR,t)}set editorHighlightDefaultColor(t){this.setEditorProperty(Rt.HIGHLIGHT_DEFAULT_COLOR,t)}set editorHighlightShowAll(t){this.setEditorProperty(Rt.HIGHLIGHT_SHOW_ALL,t)}set editorHighlightThickness(t){this.setEditorProperty(Rt.HIGHLIGHT_THICKNESS,t)}setEditorProperty(t,n){this.PDFViewerApplication?.eventBus.dispatch("switchannotationeditorparams",{type:t,value:n}),this.PDFViewerApplication?.eventBus.dispatch("annotationeditorparamschanged",{details:[[t,n]]})}getCurrentPage(){return this.PDFViewerApplication?this.PDFViewerApplication.page??1:1}getPageCount(){return this.PDFViewerApplication?this.PDFViewerApplication.pagesCount??0:0}movePage(t,n){if(!this.PDFViewerApplication){console.error("PDF viewer not initialized");return}if(!globalThis.pdfDefaultOptions?.enablePageReordering){console.error("Page reordering is not enabled. Set pdfDefaultOptions.enablePageReordering = true");return}let r=this.getPageCount();if(t<1||t>r||n<1||n>r){console.error(`Invalid page indices. fromIndex: ${t}, toIndex: ${n}, pageCount: ${r}`);return}if(t!==n)try{this.PDFViewerApplication.movePage?this.PDFViewerApplication.movePage(t,n):console.error("movePage function not available in PDF viewer application")}catch(s){console.error("Error moving page:",s)}}static \u0275fac=function(n){return new(n||i)(_t(Wn),_t(c2))};static \u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();Promise.allSettled||window.Zone&&!window["__zone_symbol__Promise.allSettled"]&&console.error("Please update zone.js to version 0.10.3 or higher. Otherwise, you'll run the slow ECMAScript 5 version even on modern browser that can run the fast ESMAScript 2015 version.");var mb=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=fo({type:i});static \u0275inj=ho({providers:[u2,l2],imports:[Fr,aa]})}return i})();var vb={providers:[Dp(),Fp({eventCoalescing:!0}),Qp(_0),Hp(),pg(()=>gg(cu.firebase)),h0(()=>Qc()),gb(()=>fb()),vg(()=>fg()),kp(mb)]};var ks=class i{title=Pr("bbs-note");static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Ke({type:i,selectors:[["app-root"]],decls:1,vars:0,template:function(t,n){t&1&&mn(0,"router-outlet")},dependencies:[jp],encapsulation:2})};zp(ks,vb).catch(i=>console.error(i));
